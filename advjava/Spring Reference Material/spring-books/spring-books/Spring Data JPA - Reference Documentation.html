<!DOCTYPE html>
<!-- saved from url=(0077)https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#reference -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.2">
<meta name="author" content="Oliver Gierke, Thomas Darimont, Christoph Strobl, Mark Paluch, Jay Bryant">
<title>Spring Data JPA - Reference Documentation</title>
<link rel="stylesheet" href="./Spring Data JPA - Reference Documentation_files/spring.css">
<link rel="stylesheet" href="./Spring Data JPA - Reference Documentation_files/font-awesome.min.css">
</head>
<body class="book toc2 toc-left is-position-fixed"><div><div id="header-spring">
<h1>
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0" y="0" viewBox="0 0 245.8 45.3" style="enable-background:new 0 0 245.8 45.3;" xml:space="preserve">
<g id="logos">
<g>
<path class="st0" d="M39.4,3.7c-0.6,1.5-1.4,2.8-2.3,4c-3.9-4-9.3-6.4-15.2-6.4c-11.7,0-21.3,9.5-21.3,21.3
c0,6.2,2.6,11.7,6.8,15.6l0.8,0.7c3.7,3.1,8.5,5,13.7,5c11.2,0,20.4-8.7,21.2-19.8C43.7,18.7,42.1,11.8,39.4,3.7z M10.5,38.3
c-0.6,0.8-1.8,0.9-2.6,0.3C7.1,37.9,7,36.8,7.6,36c0.6-0.8,1.8-0.9,2.6-0.3C11,36.4,11.1,37.5,10.5,38.3z M39.3,31.9
c-5.2,7-16.5,4.6-23.6,5c0,0-1.3,0.1-2.6,0.3c0,0,0.5-0.2,1.1-0.4c5-1.7,7.4-2.1,10.5-3.7c5.8-3,11.5-9.4,12.7-16.1
c-2.2,6.4-8.9,12-14.9,14.2c-4.2,1.5-11.7,3-11.7,3c0,0-0.3-0.2-0.3-0.2c-5.1-2.5-5.3-13.6,4-17.1c4.1-1.6,8-0.7,12.4-1.8
C31.6,14.1,37,10.6,39.2,6C41.7,13.3,44.7,24.8,39.3,31.9z"></path>
<g>
<path class="st0" d="M55.2,30.9c-0.5-0.3-0.9-0.9-0.9-1.6c0-1.1,0.8-1.9,1.9-1.9c0.4,0,0.7,0.1,1,0.3c2,1.3,4.1,2,5.9,2
c2,0,3.2-0.9,3.2-2.2v-0.1c0-1.6-2.2-2.2-4.6-2.9c-3-0.9-6.5-2.1-6.5-6.1v-0.1c0-3.9,3.2-6.3,7.4-6.3c2.2,0,4.5,0.6,6.5,1.7
c0.7,0.4,1.1,1,1.1,1.8c0,1.1-0.9,1.9-2,1.9c-0.4,0-0.6-0.1-0.9-0.2c-1.7-0.9-3.4-1.4-4.9-1.4c-1.8,0-2.9,0.9-2.9,2v0.1
c0,1.5,2.2,2.2,4.7,2.9c3,0.9,6.4,2.3,6.4,6v0.1c0,4.3-3.4,6.5-7.7,6.5C60.4,33.3,57.6,32.5,55.2,30.9z"></path>
<path class="st0" d="M72.5,14.3c0-1.3,1-2.4,2.3-2.4c1.3,0,2.4,1.1,2.4,2.4v1.4c1.5-2.2,3.7-3.9,7-3.9c4.8,0,9.6,3.8,9.6,10.7
v0.1c0,6.8-4.7,10.7-9.6,10.7c-3.4,0-5.6-1.7-7-3.6V37c0,1.3-1.1,2.4-2.4,2.4c-1.3,0-2.3-1-2.3-2.4V14.3z M89.1,22.7L89.1,22.7
c0-4.1-2.7-6.7-5.9-6.7c-3.2,0-6,2.7-6,6.6v0.1c0,4,2.8,6.6,6,6.6C86.4,29.3,89.1,26.7,89.1,22.7z"></path>
<path class="st0" d="M95.7,14.3c0-1.3,1-2.4,2.3-2.4c1.3,0,2.4,1.1,2.4,2.4v1.1c0.2-1.8,3.1-3.5,5.2-3.5c1.5,0,2.3,1,2.3,2.3
c0,1.3-0.8,2.1-1.9,2.3c-3.4,0.6-5.7,3.5-5.7,7.6V31c0,1.3-1.1,2.3-2.4,2.3c-1.3,0-2.3-1-2.3-2.3V14.3z"></path>
<path class="st0" d="M109.7,14.3c0-1.3,1-2.4,2.3-2.4c1.3,0,2.4,1.1,2.4,2.4V31c0,1.3-1.1,2.3-2.4,2.3c-1.3,0-2.3-1-2.3-2.3V14.3
z"></path>
<path class="st0" d="M116.9,14.3c0-1.3,1-2.4,2.3-2.4c1.3,0,2.4,1.1,2.4,2.4v1c1.3-1.9,3.2-3.4,6.5-3.4c4.7,0,7.4,3.1,7.4,7.9V31
c0,1.3-1,2.3-2.3,2.3c-1.3,0-2.4-1-2.4-2.3v-9.7c0-3.2-1.6-5-4.4-5c-2.7,0-4.7,1.9-4.7,5.1V31c0,1.3-1.1,2.3-2.4,2.3
c-1.3,0-2.3-1-2.3-2.3V14.3z"></path>
<path class="st0" d="M156.2,11.9c-1.3,0-2.4,1.1-2.4,2.4v1.4c-1.5-2.2-3.7-3.9-7-3.9c-4.9,0-9.6,3.8-9.6,10.7v0.1
c0,6.8,4.7,10.7,9.6,10.7c3.4,0,5.6-1.7,7-3.6c-0.2,3.7-2.5,5.7-6.5,5.7c-2.4,0-4.5-0.6-6.3-1.6c-0.2-0.1-0.5-0.2-0.9-0.2
c-1.1,0-2,0.9-2,2c0,0.9,0.5,1.6,1.3,1.9c2.5,1.2,5.1,1.8,8,1.8c3.7,0,6.6-0.9,8.5-2.8c1.7-1.7,2.7-4.3,2.7-7.8V14.3
C158.5,13,157.5,11.9,156.2,11.9z M147.9,29.2c-3.2,0-5.9-2.5-5.9-6.6v-0.1c0-4,2.7-6.6,5.9-6.6c3.2,0,6,2.7,6,6.6v0.1
C153.9,26.6,151.1,29.2,147.9,29.2z"></path>
<path class="st0" d="M114.5,6.3c0,1.3-1.1,2.4-2.4,2.4c-1.3,0-2.4-1.1-2.4-2.4c0-1.3,1.1-2.4,2.4-2.4
C113.4,3.9,114.5,4.9,114.5,6.3z"></path>
</g>
</g>
<g class="st1">
<g>
<g>
<g>
<path class="st2" d="M200.1,21.1H198V19h2.1V21.1z M200.1,32.9H198V22.6h2.1V32.9z"></path>
</g>
<g>
<g>
<path class="st2" d="M212.5,22.6l-3,8.9c-0.5,1.5-1.4,1.6-2.2,1.6c-1.1,0-1.8-0.5-2.2-1.6l-2.5-7.4h-1v-1.5h2.6l2.6,8.3
c0.1,0.4,0.2,0.6,0.5,0.6c0.3,0,0.4-0.2,0.5-0.6l2.6-8.3H212.5z"></path>
<path class="st2" d="M217.8,22.6c2.8,0,4.7,1.8,4.7,4.5v1.6c0,2.6-1.9,4.5-4.7,4.5c-2.8,0-4.7-1.8-4.7-4.5v-1.6
C213,24.4,215,22.6,217.8,22.6 M217.8,31.4c1.7,0,2.7-1.3,2.7-2.8v-1.6c0-1.5-1-2.8-2.7-2.8c-1.8,0-2.7,1.3-2.7,2.8v1.6
C215.1,30.2,216,31.4,217.8,31.4"></path>
<path class="st2" d="M239.6,22.9c-1.1-0.3-2.7-0.5-4-0.5c-2.8,0-4.6,1.8-4.6,4.6v1.1c0,2.9,1.7,4.7,4.6,4.7c0.1,0,0.6,0,0.8,0
v-1.7c-0.1,0-0.7,0-0.8,0c-1.5,0-2.6-1.2-2.6-2.9v-1.1c0-1.8,1-2.9,2.6-2.9c0.7,0,1.7,0.1,2.1,0.1l0.1,0l0,8.6h2.1v-9.6
C240,23.1,240,23,239.6,22.9"></path>
<rect x="242.1" y="19" class="st2" width="2.1" height="13.9"></rect>
<path class="st2" d="M190.5,19h-3.8v13.9h2.2V20.9h1.3c0.3,0,0.5,0,0.8,0c1.9,0,2.9,0.8,2.9,2.3c0,0.1,0,0.1,0,0.2
c0,1.4-0.8,2.3-2.9,2.3c-0.2,0-0.4,0-0.6,0c0,0.5,0,1.5,0,1.9c0.2,0,0.4,0,0.6,0c3,0,5.2-1.2,5.2-4.2c0-0.1,0-0.1,0-0.2
C196.2,20.2,193.9,19,190.5,19"></path>
<path class="st2" d="M226.3,20.4v2.2h3.5v1.7h-3.5v6c0,0.9,0.6,1,1.5,1h2v1.7H227c-2,0-2.9-0.8-2.9-2.6v-9.6L226.3,20.4z"></path>
</g>
</g>
</g>
</g>
<g>
<path class="st2" d="M167.7,32.9v-10h1.1v3.8c0.6-0.8,1.5-1.3,2.4-1.3c1.9,0,3.2,1.5,3.2,3.8c0,2.4-1.3,3.8-3.2,3.8
c-1,0-1.9-0.5-2.4-1.3v1.1H167.7z M171,32.1c1.5,0,2.3-1.2,2.3-2.8c0-1.6-0.9-2.8-2.3-2.8c-0.9,0-1.8,0.5-2.2,1.2v3.3
C169.2,31.6,170.1,32.1,171,32.1z"></path>
<path class="st2" d="M175.9,34.7c0.2,0.1,0.4,0.1,0.6,0.1c0.5,0,0.8-0.2,1.1-0.8l0.5-1.1l-3-7.3h1.2l2.4,5.9l2.4-5.9h1.2
l-3.6,8.7c-0.4,1-1.2,1.5-2.1,1.5c-0.2,0-0.6,0-0.8-0.1L175.9,34.7z"></path>
</g>
</g>
</g>
</svg>

</h1>
</div></div>
<div id="header">
<h1>Spring Data JPA - Reference Documentation</h1>
<div class="details">
<span id="author" class="author">Oliver Gierke</span><br>
<span id="author2" class="author">Thomas Darimont</span><br>
<span id="author3" class="author">Christoph Strobl</span><br>
<span id="author4" class="author">Mark Paluch</span><br>
<span id="author5" class="author">Jay Bryant</span><br>
<span id="revnumber">version 2.4.0,</span>
<span id="revdate">2020-10-28</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="mobile-toc">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#preface">1. Preface</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#project">1.1. Project Metadata</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#new-features">2. New &amp; Noteworthy</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#new-features.1-11-0">2.1. What’s New in Spring Data JPA 1.11</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#new-features.1-10-0">2.2. What’s New in Spring Data JPA 1.10</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#dependencies">3. Dependencies</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#dependencies.spring-boot">3.1. Dependency Management with Spring Boot</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#dependencies.spring-framework">3.2. Spring Framework</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories">4. Working with Spring Data Repositories</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.core-concepts">4.1. Core concepts</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods">4.2. Query Methods</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.definition">4.3. Defining Repository Interfaces</a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.definition-tuning">4.3.1. Fine-tuning Repository Definition</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.multiple-modules">4.3.2. Using Repositories with Multiple Spring Data Modules</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.details">4.4. Defining Query Methods</a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.query-lookup-strategies">4.4.1. Query Lookup Strategies</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.query-creation">4.4.2. Query Creation</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.query-property-expressions">4.4.3. Property Expressions</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.special-parameters">4.4.4. Special parameter handling</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.paging-and-sorting">Paging and Sorting</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.limit-query-result">4.4.5. Limiting Query Results</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.collections-and-iterables">4.4.6. Repository Methods Returning Collections or Iterables</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.collections-and-iterables.streamable">Using Streamable as Query Method Return Type</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.collections-and-iterables.streamable-wrapper">Returning Custom Streamable Wrapper Types</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.collections-and-iterables.vavr">Support for Vavr Collections</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.nullability">4.4.7. Null Handling of Repository Methods</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.nullability.annotations">Nullability Annotations</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.nullability.kotlin">Nullability in Kotlin-based Repositories</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-streaming">4.4.8. Streaming Query Results</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-async">4.4.9. Asynchronous Query Results</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances">4.5. Creating Repository Instances</a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances.spring">4.5.1. XML Configuration</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.using-filters">Using Filters</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances.java-config">4.5.2. Java Configuration</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances.standalone">4.5.3. Standalone Usage</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.custom-implementations">4.6. Custom Implementations for Spring Data Repositories</a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.single-repository-behavior">4.6.1. Customizing Individual Repositories</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.configuration">Configuration</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.customize-base-repository">4.6.2. Customize the Base Repository</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.domain-events">4.7. Publishing Events from Aggregate Roots</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.extensions">4.8. Spring Data Extensions</a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.extensions.querydsl">4.8.1. Querydsl Extension</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web">4.8.2. Web support</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web.basic">Basic Web Support</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web.pageables">Hypermedia Support for Pageables</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web.binding">Web Databinding Support</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web.type-safe">Querydsl Web Support</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.repository-populators">4.8.3. Repository Populators</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#reference">5. Reference Documentation</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.repositories">6. JPA Repositories</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.introduction">6.1. Introduction</a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.namespace">6.1.1. Spring Namespace</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#">Custom Namespace Attributes</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.java-config">6.1.2. Annotation-based Configuration</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.bootstrap-mode">6.1.3. Bootstrap Mode</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#">Recommendations</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.entity-persistence">6.2. Persisting Entities</a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.entity-persistence.saving-entites">6.2.1. Saving Entities</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.entity-persistence.saving-entites.strategies">Entity State-detection Strategies</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods">6.3. Query Methods</a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.sample-app.finders.strategies">6.3.1. Query Lookup Strategies</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#">Declared Queries</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.query-creation">6.3.2. Query Creation</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.named-queries">6.3.3. Using JPA Named Queries</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#">XML Named Query Definition</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#">Annotation-based Configuration</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#">Declaring Interfaces</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.at-query">6.3.4. Using <code>@Query</code></a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#">Using Advanced <code>LIKE</code> Expressions</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#">Native Queries</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.sorting">6.3.5. Using Sort</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.named-parameters">6.3.6. Using Named Parameters</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query.spel-expressions">6.3.7. Using SpEL Expressions</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.modifying-queries">6.3.8. Modifying Queries</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.modifying-queries.derived-delete">Derived Delete Queries</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-hints">6.3.9. Applying Query Hints</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.entity-graph">6.3.10. Configuring Fetch- and LoadGraphs</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#projections">6.3.11. Projections</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#projections.interfaces">Interface-based Projections</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#projections.dtos">Class-based Projections (DTOs)</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#projection.dynamic">Dynamic Projections</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.stored-procedures">6.4. Stored Procedures</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#specifications">6.5. Specifications</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#query-by-example">6.6. Query by Example</a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#query-by-example.introduction">6.6.1. Introduction</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#query-by-example.usage">6.6.2. Usage</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#query-by-example.matchers">6.6.3. Example Matchers</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#query-by-example.running">6.6.4. Running an Example</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#transactions">6.7. Transactionality</a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#transactional-query-methods">6.7.1. Transactional query methods</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#locking">6.8. Locking</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#auditing">6.9. Auditing</a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#auditing.basics">6.9.1. Basics</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#auditing.annotations">Annotation-based Auditing Metadata</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#auditing.interfaces">Interface-based Auditing Metadata</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#auditing.auditor-aware"><code>AuditorAware</code></a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#auditing.reactive-auditor-aware"><code>ReactiveAuditorAware</code></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.auditing">6.9.2. JPA Auditing</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.auditing.configuration">General Auditing Configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.misc">6.10. Miscellaneous Considerations</a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.misc.jpa-context">6.10.1. Using <code>JpaContext</code> in Custom Implementations</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.misc.merging-persistence-units">6.10.2. Merging persistence units</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.misc.entity-scanning">Classpath Scanning for @Entity Classes and JPA Mapping Files</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpd.misc.cdi-integration">6.10.3. CDI Integration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#appendix">7. Appendix</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.namespace-reference">Appendix A: Namespace reference</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#populator.namespace-dao-config">The <code>&lt;repositories /&gt;</code> Element</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#populator.namespace-reference">Appendix B: Populators namespace reference</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#namespace-dao-config">The &lt;populator /&gt; element</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repository-query-keywords">Appendix C: Repository query keywords</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#">Supported query keywords</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repository-query-return-types">Appendix D: Repository query return types</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#">Supported Query Return Types</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#faq">Appendix E: Frequently Asked Questions</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#">Common</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#">Infrastructure</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#">Auditing</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#glossary">Appendix F: Glossary</a></li>
</ul>
<div id="tocbot" class="js-toc desktop-toc"><ol class="toc-list "><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#preface" class="toc-link node-name--H2 ">1. Preface</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#project" class="toc-link node-name--H3 ">1.1. Project Metadata</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#new-features" class="toc-link node-name--H2 ">2. New &amp; Noteworthy</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#new-features.1-11-0" class="toc-link node-name--H3 ">2.1. What’s New in Spring Data JPA 1.11</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#new-features.1-10-0" class="toc-link node-name--H3 ">2.2. What’s New in Spring Data JPA 1.10</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#dependencies" class="toc-link node-name--H2 ">3. Dependencies</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#dependencies.spring-boot" class="toc-link node-name--H3 ">3.1. Dependency Management with Spring Boot</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#dependencies.spring-framework" class="toc-link node-name--H3 ">3.2. Spring Framework</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories" class="toc-link node-name--H2 ">4. Working with Spring Data Repositories</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.core-concepts" class="toc-link node-name--H3 ">4.1. Core concepts</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods" class="toc-link node-name--H3 ">4.2. Query Methods</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.definition" class="toc-link node-name--H3 ">4.3. Defining Repository Interfaces</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.definition-tuning" class="toc-link node-name--H4 ">4.3.1. Fine-tuning Repository Definition</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.multiple-modules" class="toc-link node-name--H4 ">4.3.2. Using Repositories with Multiple Spring Data Modules</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.details" class="toc-link node-name--H3 ">4.4. Defining Query Methods</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.query-lookup-strategies" class="toc-link node-name--H4 ">4.4.1. Query Lookup Strategies</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.query-creation" class="toc-link node-name--H4 ">4.4.2. Query Creation</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.query-property-expressions" class="toc-link node-name--H4 ">4.4.3. Property Expressions</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.special-parameters" class="toc-link node-name--H4 ">4.4.4. Special parameter handling</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.paging-and-sorting" class="toc-link node-name--H5 ">Paging and Sorting</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.limit-query-result" class="toc-link node-name--H4 ">4.4.5. Limiting Query Results</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.collections-and-iterables" class="toc-link node-name--H4 ">4.4.6. Repository Methods Returning Collections or Iterables</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.collections-and-iterables.streamable" class="toc-link node-name--H5 ">Using Streamable as Query Method Return Type</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.collections-and-iterables.streamable-wrapper" class="toc-link node-name--H5 ">Returning Custom Streamable Wrapper Types</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.collections-and-iterables.vavr" class="toc-link node-name--H5 ">Support for Vavr Collections</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.nullability" class="toc-link node-name--H4 ">4.4.7. Null Handling of Repository Methods</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.nullability.annotations" class="toc-link node-name--H5 ">Nullability Annotations</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.nullability.kotlin" class="toc-link node-name--H5 ">Nullability in Kotlin-based Repositories</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-streaming" class="toc-link node-name--H4 ">4.4.8. Streaming Query Results</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-async" class="toc-link node-name--H4 ">4.4.9. Asynchronous Query Results</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances" class="toc-link node-name--H3 ">4.5. Creating Repository Instances</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances.spring" class="toc-link node-name--H4 ">4.5.1. XML Configuration</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.using-filters" class="toc-link node-name--H5 ">Using Filters</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances.java-config" class="toc-link node-name--H4 ">4.5.2. Java Configuration</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances.standalone" class="toc-link node-name--H4 ">4.5.3. Standalone Usage</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.custom-implementations" class="toc-link node-name--H3 ">4.6. Custom Implementations for Spring Data Repositories</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.single-repository-behavior" class="toc-link node-name--H4 ">4.6.1. Customizing Individual Repositories</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.configuration" class="toc-link node-name--H5 ">Configuration</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.customize-base-repository" class="toc-link node-name--H4 ">4.6.2. Customize the Base Repository</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.domain-events" class="toc-link node-name--H3 ">4.7. Publishing Events from Aggregate Roots</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.extensions" class="toc-link node-name--H3 ">4.8. Spring Data Extensions</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.extensions.querydsl" class="toc-link node-name--H4 ">4.8.1. Querydsl Extension</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web" class="toc-link node-name--H4 ">4.8.2. Web support</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web.basic" class="toc-link node-name--H5 ">Basic Web Support</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web.pageables" class="toc-link node-name--H5 ">Hypermedia Support for Pageables</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web.binding" class="toc-link node-name--H5 ">Web Databinding Support</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web.type-safe" class="toc-link node-name--H5 ">Querydsl Web Support</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.repository-populators" class="toc-link node-name--H4 ">4.8.3. Repository Populators</a></li></ol></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#reference" class="toc-link node-name--H2 ">5. Reference Documentation</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.repositories" class="toc-link node-name--H2 ">6. JPA Repositories</a><ol class="toc-list  is-collapsible"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.introduction" class="toc-link node-name--H3 ">6.1. Introduction</a><ol class="toc-list  is-collapsible"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.namespace" class="toc-link node-name--H4 ">6.1.1. Spring Namespace</a><ol class="toc-list  is-collapsible"><li class="toc-list-item is-active-li"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#" class="toc-link node-name--H5  is-active-link">Custom Namespace Attributes</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.java-config" class="toc-link node-name--H4 ">6.1.2. Annotation-based Configuration</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.bootstrap-mode" class="toc-link node-name--H4 ">6.1.3. Bootstrap Mode</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#" class="toc-link node-name--H5 ">Recommendations</a></li></ol></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.entity-persistence" class="toc-link node-name--H3 ">6.2. Persisting Entities</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.entity-persistence.saving-entites" class="toc-link node-name--H4 ">6.2.1. Saving Entities</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.entity-persistence.saving-entites.strategies" class="toc-link node-name--H5 ">Entity State-detection Strategies</a></li></ol></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods" class="toc-link node-name--H3 ">6.3. Query Methods</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.sample-app.finders.strategies" class="toc-link node-name--H4 ">6.3.1. Query Lookup Strategies</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#" class="toc-link node-name--H5 ">Declared Queries</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.query-creation" class="toc-link node-name--H4 ">6.3.2. Query Creation</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.named-queries" class="toc-link node-name--H4 ">6.3.3. Using JPA Named Queries</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#" class="toc-link node-name--H5 ">XML Named Query Definition</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#" class="toc-link node-name--H5 ">Annotation-based Configuration</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#" class="toc-link node-name--H5 ">Declaring Interfaces</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.at-query" class="toc-link node-name--H4 ">6.3.4. Using @Query</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#" class="toc-link node-name--H5 ">Using Advanced LIKE Expressions</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#" class="toc-link node-name--H5 ">Native Queries</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.sorting" class="toc-link node-name--H4 ">6.3.5. Using Sort</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.named-parameters" class="toc-link node-name--H4 ">6.3.6. Using Named Parameters</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query.spel-expressions" class="toc-link node-name--H4 ">6.3.7. Using SpEL Expressions</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.modifying-queries" class="toc-link node-name--H4 ">6.3.8. Modifying Queries</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.modifying-queries.derived-delete" class="toc-link node-name--H5 ">Derived Delete Queries</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-hints" class="toc-link node-name--H4 ">6.3.9. Applying Query Hints</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.entity-graph" class="toc-link node-name--H4 ">6.3.10. Configuring Fetch- and LoadGraphs</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#projections" class="toc-link node-name--H4 ">6.3.11. Projections</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#projections.interfaces" class="toc-link node-name--H5 ">Interface-based Projections</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#projections.dtos" class="toc-link node-name--H5 ">Class-based Projections (DTOs)</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#projection.dynamic" class="toc-link node-name--H5 ">Dynamic Projections</a></li></ol></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.stored-procedures" class="toc-link node-name--H3 ">6.4. Stored Procedures</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#specifications" class="toc-link node-name--H3 ">6.5. Specifications</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#query-by-example" class="toc-link node-name--H3 ">6.6. Query by Example</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#query-by-example.introduction" class="toc-link node-name--H4 ">6.6.1. Introduction</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#query-by-example.usage" class="toc-link node-name--H4 ">6.6.2. Usage</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#query-by-example.matchers" class="toc-link node-name--H4 ">6.6.3. Example Matchers</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#query-by-example.running" class="toc-link node-name--H4 ">6.6.4. Running an Example</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#transactions" class="toc-link node-name--H3 ">6.7. Transactionality</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#transactional-query-methods" class="toc-link node-name--H4 ">6.7.1. Transactional query methods</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#locking" class="toc-link node-name--H3 ">6.8. Locking</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#auditing" class="toc-link node-name--H3 ">6.9. Auditing</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#auditing.basics" class="toc-link node-name--H4 ">6.9.1. Basics</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#auditing.annotations" class="toc-link node-name--H5 ">Annotation-based Auditing Metadata</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#auditing.interfaces" class="toc-link node-name--H5 ">Interface-based Auditing Metadata</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#auditing.auditor-aware" class="toc-link node-name--H5 ">AuditorAware</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#auditing.reactive-auditor-aware" class="toc-link node-name--H5 ">ReactiveAuditorAware</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.auditing" class="toc-link node-name--H4 ">6.9.2. JPA Auditing</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.auditing.configuration" class="toc-link node-name--H5 ">General Auditing Configuration</a></li></ol></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.misc" class="toc-link node-name--H3 ">6.10. Miscellaneous Considerations</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.misc.jpa-context" class="toc-link node-name--H4 ">6.10.1. Using JpaContext in Custom Implementations</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.misc.merging-persistence-units" class="toc-link node-name--H4 ">6.10.2. Merging persistence units</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.misc.entity-scanning" class="toc-link node-name--H5 ">Classpath Scanning for @Entity Classes and JPA Mapping Files</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpd.misc.cdi-integration" class="toc-link node-name--H4 ">6.10.3. CDI Integration</a></li></ol></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#appendix" class="toc-link node-name--H2 ">7. Appendix</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.namespace-reference" class="toc-link node-name--H2 ">Appendix A: Namespace reference</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#populator.namespace-dao-config" class="toc-link node-name--H3 ">The &lt;repositories /&gt; Element</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#populator.namespace-reference" class="toc-link node-name--H2 ">Appendix B: Populators namespace reference</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#namespace-dao-config" class="toc-link node-name--H3 ">The &lt;populator /&gt; element</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repository-query-keywords" class="toc-link node-name--H2 ">Appendix C: Repository query keywords</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#" class="toc-link node-name--H3 ">Supported query keywords</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repository-query-return-types" class="toc-link node-name--H2 ">Appendix D: Repository query return types</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#" class="toc-link node-name--H3 ">Supported Query Return Types</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#faq" class="toc-link node-name--H2 ">Appendix E: Frequently Asked Questions</a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#" class="toc-link node-name--H3 ">Common</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#" class="toc-link node-name--H3 ">Infrastructure</a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#" class="toc-link node-name--H3 ">Auditing</a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#glossary" class="toc-link node-name--H2 ">Appendix F: Glossary</a></li></ol></div></div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>© 2008-2020 The original authors.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preface"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#preface"></a>1. Preface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Data JPA provides repository support for the Java Persistence API (JPA). It eases development of applications that need to access JPA data sources.</p>
</div>
<div class="sect2">
<h3 id="project"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#project"></a>1.1. Project Metadata</h3>
<div class="ulist">
<ul>
<li>
<p>Version control: <a href="https://github.com/spring-projects/spring-data-jpa" class="bare">https://github.com/spring-projects/spring-data-jpa</a></p>
</li>
<li>
<p>Bugtracker: <a href="https://jira.spring.io/browse/DATAJPA" class="bare">https://jira.spring.io/browse/DATAJPA</a></p>
</li>
<li>
<p>Release repository: <a href="https://repo.spring.io/libs-release" class="bare">https://repo.spring.io/libs-release</a></p>
</li>
<li>
<p>Milestone repository: <a href="https://repo.spring.io/libs-milestone" class="bare">https://repo.spring.io/libs-milestone</a></p>
</li>
<li>
<p>Snapshot repository: <a href="https://repo.spring.io/libs-snapshot" class="bare">https://repo.spring.io/libs-snapshot</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="new-features"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#new-features"></a>2. New &amp; Noteworthy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="new-features.1-11-0"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#new-features.1-11-0"></a>2.1. What’s New in Spring Data JPA 1.11</h3>
<div class="paragraph">
<p>Spring Data JPA 1.11 added the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Improved compatibility with Hibernate 5.2.</p>
</li>
<li>
<p>Support any-match mode for <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#query-by-example">Query by Example</a>.</p>
</li>
<li>
<p>Paged query optimizations.</p>
</li>
<li>
<p>Support for the <code>exists</code> projection in repository query derivation.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="new-features.1-10-0"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#new-features.1-10-0"></a>2.2. What’s New in Spring Data JPA 1.10</h3>
<div class="paragraph">
<p>Spring Data JPA 1.10 added the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support for <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#projections">Projections</a> in repository query methods.</p>
</li>
<li>
<p>Support for <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#query-by-example">Query by Example</a>.</p>
</li>
<li>
<p>The following annotations have been enabled to build on composed annotations: <code>@EntityGraph</code>, <code>@Lock</code>, <code>@Modifying</code>, <code>@Query</code>, <code>@QueryHints</code>, and <code>@Procedure</code>.</p>
</li>
<li>
<p>Support for the <code>Contains</code> keyword on collection expressions.</p>
</li>
<li>
<p><code>AttributeConverter</code> implementations for <code>ZoneId</code> of JSR-310 and ThreeTenBP.</p>
</li>
<li>
<p>Upgrade to Querydsl 4, Hibernate 5, OpenJPA 2.4, and EclipseLink 2.6.1.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dependencies"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#dependencies"></a>3. Dependencies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Due to the different inception dates of individual Spring Data modules, most of them carry different major and minor version numbers. The easiest way to find compatible ones is to rely on the Spring Data Release Train BOM that we ship with the compatible versions defined. In a Maven project, you would declare this dependency in the <code>&lt;dependencyManagement /&gt;</code> section of your POM as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Using the Spring Data release train BOM</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.data<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-data-bom<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2020.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div id="dependencies.train-version" class="paragraph">
<p>The current release train version is <code>2020.0.0</code>. The train version uses <a href="https://calver.org/">calver</a> with the pattern <code>YYYY.MINOR.MICRO</code>.
The version name follows <code>${calver}</code> for GA releases and service releases and the following pattern for all other versions: <code>${calver}-${modifier}</code>, where <code>modifier</code> can be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SNAPSHOT</code>: Current snapshots</p>
</li>
<li>
<p><code>M1</code>, <code>M2</code>, and so on: Milestones</p>
</li>
<li>
<p><code>RC1</code>, <code>RC2</code>, and so on: Release candidates</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find a working example of using the BOMs in our <a href="https://github.com/spring-projects/spring-data-examples/tree/master/bom">Spring Data examples repository</a>. With that in place, you can declare the Spring Data modules you would like to use without a version in the <code>&lt;dependencies /&gt;</code> block, as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. Declaring a dependency to a Spring Data module</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.data<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dependencies.spring-boot"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#dependencies.spring-boot"></a>3.1. Dependency Management with Spring Boot</h3>
<div class="paragraph">
<p>Spring Boot selects a recent version of Spring Data modules for you. If you still want to upgrade to a newer version, set
the <code>spring-data-releasetrain.version</code> property to the <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#dependencies.train-version">train version and iteration</a> you would like to use.</p>
</div>
</div>
<div class="sect2">
<h3 id="dependencies.spring-framework"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#dependencies.spring-framework"></a>3.2. Spring Framework</h3>
<div class="paragraph">
<p>The current version of Spring Data modules require Spring Framework 5.3.0 or better. The modules might also work with an older bugfix version of that minor version. However, using the most recent version within that generation is highly recommended.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="repositories"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories"></a>4. Working with Spring Data Repositories</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The goal of the Spring Data repository abstraction is to significantly reduce the amount of boilerplate code required to implement data access layers for various persistence stores.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>Spring Data repository documentation and your module</em></p>
</div>
<div class="paragraph">
<p>This chapter explains the core concepts and interfaces of Spring Data repositories. The information in this chapter is pulled from the Spring Data Commons module. It uses the configuration and code samples for the Java Persistence API (JPA) module. You should adapt the XML namespace declaration and the types to be extended to the equivalents of the particular module that you use. “<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.namespace-reference">Namespace reference</a>” covers XML configuration, which is supported across all Spring Data modules that support the repository API. “<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repository-query-keywords">Repository query keywords</a>” covers the query method keywords supported by the repository abstraction in general. For detailed information on the specific features of your module, see the chapter on that module of this document.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="repositories.core-concepts"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.core-concepts"></a>4.1. Core concepts</h3>
<div class="paragraph">
<p>The central interface in the Spring Data repository abstraction is <code>Repository</code>. It takes the domain class to manage as well as the ID type of the domain class as type arguments. This interface acts primarily as a marker interface to capture the types to work with and to help you to discover interfaces that extend this one. The <a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/CrudRepository.html"><code>CrudRepository</code></a> interface provides sophisticated CRUD functionality for the entity class that is being managed.</p>
</div>
<div id="repositories.repository" class="exampleblock">
<div class="title">Example 3. <code>CrudRepository</code> Interface</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; </span>{

  &lt;S extends T&gt; <span class="hljs-function">S <span class="hljs-title">save</span><span class="hljs-params">(S entity)</span></span>;      <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>

  <span class="hljs-function">Optional&lt;T&gt; <span class="hljs-title">findById</span><span class="hljs-params">(ID primaryKey)</span></span>; <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>

  <span class="hljs-function">Iterable&lt;T&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;               <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>

  <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">count</span><span class="hljs-params">()</span></span>;                        <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b>

  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(T entity)</span></span>;               <i class="conum" data-value="5"></i><b>(<span class="hljs-number">5</span>)</b>

  <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">existsById</span><span class="hljs-params">(ID primaryKey)</span></span>;   <i class="conum" data-value="6"></i><b>(<span class="hljs-number">6</span>)</b>

  <span class="hljs-comment">// … more functionality omitted.</span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Saves the given entity.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Returns the entity identified by the given ID.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Returns all entities.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Returns the number of entities.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Deletes the given entity.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Indicates whether an entity with the given ID exists.</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We also provide persistence technology-specific abstractions, such as <code>JpaRepository</code> or <code>MongoRepository</code>. Those interfaces extend <code>CrudRepository</code> and expose the capabilities of the underlying persistence technology in addition to the rather generic persistence technology-agnostic interfaces such as <code>CrudRepository</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>On top of the <code>CrudRepository</code>, there is a <a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/PagingAndSortingRepository.html"><code>PagingAndSortingRepository</code></a> abstraction that adds additional methods to ease paginated access to entities:</p>
</div>
<div class="exampleblock">
<div class="title">Example 4. <code>PagingAndSortingRepository</code> interface</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PagingAndSortingRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; </span>{

  <span class="hljs-function">Iterable&lt;T&gt; <span class="hljs-title">findAll</span><span class="hljs-params">(Sort sort)</span></span>;

  <span class="hljs-function">Page&lt;T&gt; <span class="hljs-title">findAll</span><span class="hljs-params">(Pageable pageable)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To access the second page of <code>User</code> by a page size of 20, you could do something like the following:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">PagingAndSortingRepository&lt;User, Long&gt; repository = <span class="hljs-comment">// … get access to a bean</span>
Page&lt;User&gt; users = repository.findAll(PageRequest.of(<span class="hljs-number">1</span>, <span class="hljs-number">20</span>));</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In addition to query methods, query derivation for both count and delete queries is available. The following list shows the interface definition for a derived count query:</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. Derived Count Query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{

  <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">countByLastname</span><span class="hljs-params">(String lastname)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following listing shows the interface definition for a derived delete query:</p>
</div>
<div class="exampleblock">
<div class="title">Example 6. Derived Delete Query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{

  <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">deleteByLastname</span><span class="hljs-params">(String lastname)</span></span>;

  <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">removeByLastname</span><span class="hljs-params">(String lastname)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repositories.query-methods"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods"></a>4.2. Query Methods</h3>
<div class="paragraph">
<p>Standard CRUD functionality repositories usually have queries on the underlying datastore. With Spring Data, declaring those queries becomes a four-step process:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Declare an interface extending Repository or one of its subinterfaces and type it to the domain class and ID type that it should handle, as shown in the following example:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Declare query methods on the interface.</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Set up Spring to create proxy instances for those interfaces, either with <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances.java-config">JavaConfig</a> or with <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances">XML configuration</a>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>To use Java configuration, create a class similar to the following:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.config.EnableJpaRepositories;

<span class="hljs-meta">@EnableJpaRepositories</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>{ … }</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>To use XML configuration, define a bean similar to the following:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
   <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
   <span class="hljs-attr">xmlns:jpa</span>=<span class="hljs-string">"http://www.springframework.org/schema/data/jpa"</span>
   <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans
     https://www.springframework.org/schema/beans/spring-beans.xsd
     http://www.springframework.org/schema/data/jpa
     https://www.springframework.org/schema/data/jpa/spring-jpa.xsd"</span>&gt;</span>

   <span class="hljs-tag">&lt;<span class="hljs-name">jpa:repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repositories"</span>/&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The JPA namespace is used in this example. If you use the repository abstraction for any other store, you need to change this to the appropriate namespace declaration of your store module. In other words, you should exchange <code>jpa</code> in favor of, for example, <code>mongodb</code>.</p>
</div>
<div class="paragraph">
<p>Also, note that the JavaConfig variant does not configure a package explicitly, because the package of the annotated class is used by default. To customize the package to scan, use one of the <code>basePackage…</code> attributes of the data-store-specific repository’s <code>@Enable${store}Repositories</code>-annotation.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Inject the repository instance and use it, as shown in the following example:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeClient</span> </span>{

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> PersonRepository repository;

  SomeClient(PersonRepository repository) {
    <span class="hljs-keyword">this</span>.repository = repository;
  }

  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span> </span>{
    List&lt;Person&gt; persons = repository.findByLastname(<span class="hljs-string">"Matthews"</span>);
  }
}</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The sections that follow explain each step in detail:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.definition">Defining Repository Interfaces</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.details">Defining Query Methods</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances">Creating Repository Instances</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.custom-implementations">Custom Implementations for Spring Data Repositories</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="repositories.definition"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.definition"></a>4.3. Defining Repository Interfaces</h3>
<div class="paragraph">
<p>To define a repository interface, you first need to define a domain class-specific repository interface. The interface must extend <code>Repository</code> and be typed to the domain class and an ID type. If you want to expose CRUD methods for that domain type, extend <code>CrudRepository</code> instead of <code>Repository</code>.</p>
</div>
<div class="sect3">
<h4 id="repositories.definition-tuning"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.definition-tuning"></a>4.3.1. Fine-tuning Repository Definition</h4>
<div class="paragraph">
<p>Typically, your repository interface extends <code>Repository</code>, <code>CrudRepository</code>, or <code>PagingAndSortingRepository</code>. Alternatively, if you do not want to extend Spring Data interfaces, you can also annotate your repository interface with <code>@RepositoryDefinition</code>. Extending <code>CrudRepository</code> exposes a complete set of methods to manipulate your entities. If you prefer to be selective about the methods being exposed, copy the methods you want to expose from <code>CrudRepository</code> into your domain repository.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Doing so lets you define your own abstractions on top of the provided Spring Data Repositories functionality.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The following example shows how to selectively expose CRUD methods (<code>findById</code> and <code>save</code>, in this case):</p>
</div>
<div class="exampleblock">
<div class="title">Example 7. Selectively exposing CRUD methods</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@NoRepositoryBean</span>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MyBaseRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; </span>{

  <span class="hljs-function">Optional&lt;T&gt; <span class="hljs-title">findById</span><span class="hljs-params">(ID id)</span></span>;

  &lt;S extends T&gt; <span class="hljs-function">S <span class="hljs-title">save</span><span class="hljs-params">(S entity)</span></span>;
}

<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MyBaseRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{
  <span class="hljs-function">User <span class="hljs-title">findByEmailAddress</span><span class="hljs-params">(EmailAddress emailAddress)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the prior example, you defined a common base interface for all your domain repositories and exposed <code>findById(…)</code> as well as <code>save(…)</code>.These methods are routed into the base repository implementation of the store of your choice provided by Spring Data (for example, if you use JPA, the implementation is <code>SimpleJpaRepository</code>), because they match the method signatures in <code>CrudRepository</code>. So the <code>UserRepository</code> can now save users, find individual users by ID, and trigger a query to find <code>Users</code> by email address.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The intermediate repository interface is annotated with <code>@NoRepositoryBean</code>. Make sure you add that annotation to all repository interfaces for which Spring Data should not create instances at runtime.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="repositories.multiple-modules"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.multiple-modules"></a>4.3.2. Using Repositories with Multiple Spring Data Modules</h4>
<div class="paragraph">
<p>Using a unique Spring Data module in your application makes things simple, because all repository interfaces in the defined scope are bound to the Spring Data module. Sometimes, applications require using more than one Spring Data module. In such cases, a repository definition must distinguish between persistence technologies. When it detects multiple repository factories on the class path, Spring Data enters strict repository configuration mode. Strict configuration uses details on the repository or the domain class to decide about Spring Data module binding for a repository definition:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the repository definition <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.multiple-modules.types">extends the module-specific repository</a>, it is a valid candidate for the particular Spring Data module.</p>
</li>
<li>
<p>If the domain class is <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.multiple-modules.annotations">annotated with the module-specific type annotation</a>, it is a valid candidate for the particular Spring Data module. Spring Data modules accept either third-party annotations (such as JPA’s <code>@Entity</code>) or provide their own annotations (such as <code>@Document</code> for Spring Data MongoDB and Spring Data Elasticsearch).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following example shows a repository that uses module-specific interfaces (JPA in this case):</p>
</div>
<div id="repositories.multiple-modules.types" class="exampleblock">
<div class="title">Example 8. Repository definitions using module-specific interfaces</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MyRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{ }

<span class="hljs-meta">@NoRepositoryBean</span>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MyBaseRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; </span>{ … }

<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MyBaseRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>MyRepository</code> and <code>UserRepository</code> extend <code>JpaRepository</code> in their type hierarchy. They are valid candidates for the Spring Data JPA module.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example shows a repository that uses generic interfaces:</p>
</div>
<div class="exampleblock">
<div class="title">Example 9. Repository definitions using generic interfaces</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AmbiguousRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }

<span class="hljs-meta">@NoRepositoryBean</span>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MyBaseRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; </span>{ … }

<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AmbiguousUserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MyBaseRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>AmbiguousRepository</code> and <code>AmbiguousUserRepository</code> extend only <code>Repository</code> and <code>CrudRepository</code> in their type hierarchy. While this is fine when using a unique Spring Data module, multiple modules cannot distinguish to which particular Spring Data these repositories should be bound.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example shows a repository that uses domain classes with annotations:</p>
</div>
<div id="repositories.multiple-modules.annotations" class="exampleblock">
<div class="title">Example 10. Repository definitions using domain classes with annotations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }

<span class="hljs-meta">@Entity</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{ … }

<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }

<span class="hljs-meta">@Document</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{ … }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>PersonRepository</code> references <code>Person</code>, which is annotated with the JPA <code>@Entity</code> annotation, so this repository clearly belongs to Spring Data JPA. <code>UserRepository</code> references <code>User</code>, which is annotated with Spring Data MongoDB’s <code>@Document</code> annotation.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The following bad example shows a repository that uses domain classes with mixed annotations:</p>
</div>
<div class="exampleblock">
<div class="title">Example 11. Repository definitions using domain classes with mixed annotations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">JpaPersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }

<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MongoDBPersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Document</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{ … }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows a domain class using both JPA and Spring Data MongoDB annotations. It defines two repositories, <code>JpaPersonRepository</code> and <code>MongoDBPersonRepository</code>. One is intended for JPA and the other for MongoDB usage. Spring Data is no longer able to tell the repositories apart, which leads to undefined behavior.</p>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.multiple-modules.types">Repository type details</a> and <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.multiple-modules.annotations">distinguishing domain class annotations</a> are used for strict repository configuration to identify repository candidates for a particular Spring Data module. Using multiple persistence technology-specific annotations on the same domain type is possible and enables reuse of domain types across multiple persistence technologies. However, Spring Data can then no longer determine a unique module with which to bind the repository.</p>
</div>
<div class="paragraph">
<p>The last way to distinguish repositories is by scoping repository base packages. Base packages define the starting points for scanning for repository interface definitions, which implies having repository definitions located in the appropriate packages. By default, annotation-driven configuration uses the package of the configuration class. The <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances.spring">base package in XML-based configuration</a> is mandatory.</p>
</div>
<div class="paragraph">
<p>The following example shows annotation-driven configuration of base packages:</p>
</div>
<div class="exampleblock">
<div class="title">Example 12. Annotation-driven configuration of base packages</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@EnableJpaRepositories</span>(basePackages = <span class="hljs-string">"com.acme.repositories.jpa"</span>)
<span class="hljs-meta">@EnableMongoRepositories</span>(basePackages = <span class="hljs-string">"com.acme.repositories.mongo"</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Configuration</span> </span>{ … }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repositories.query-methods.details"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.details"></a>4.4. Defining Query Methods</h3>
<div class="paragraph">
<p>The repository proxy has two ways to derive a store-specific query from the method name:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By deriving the query from the method name directly.</p>
</li>
<li>
<p>By using a manually defined query.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Available options depend on the actual store. However, there must be a strategy that decides what actual query is created. The next section describes the available options.</p>
</div>
<div class="sect3">
<h4 id="repositories.query-methods.query-lookup-strategies"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.query-lookup-strategies"></a>4.4.1. Query Lookup Strategies</h4>
<div class="paragraph">
<p>The following strategies are available for the repository infrastructure to resolve the query. With XML configuration, you can configure the strategy at the namespace through the <code>query-lookup-strategy</code> attribute. For Java configuration, you can use the <code>queryLookupStrategy</code> attribute of the <code>Enable${store}Repositories</code> annotation. Some strategies may not be supported for particular datastores.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CREATE</code> attempts to construct a store-specific query from the query method name. The general approach is to remove a given set of well known prefixes from the method name and parse the rest of the method. You can read more about query construction in “<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.query-creation">Query Creation</a>”.</p>
</li>
<li>
<p><code>USE_DECLARED_QUERY</code> tries to find a declared query and throws an exception if it cannot find one. The query can be defined by an annotation somewhere or declared by other means. See the documentation of the specific store to find available options for that store. If the repository infrastructure does not find a declared query for the method at bootstrap time, it fails.</p>
</li>
<li>
<p><code>CREATE_IF_NOT_FOUND</code> (the default) combines <code>CREATE</code> and <code>USE_DECLARED_QUERY</code>. It looks up a declared query first, and, if no declared query is found, it creates a custom method name-based query. This is the default lookup strategy and, thus, is used if you do not configure anything explicitly. It allows quick query definition by method names but also custom-tuning of these queries by introducing declared queries as needed.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="repositories.query-methods.query-creation"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.query-creation"></a>4.4.2. Query Creation</h4>
<div class="paragraph">
<p>The query builder mechanism built into the Spring Data repository infrastructure is useful for building constraining queries over entities of the repository. The mechanism strips the <code>find…By</code>, <code>read…By</code>, <code>query…By</code>, <code>count…By</code>, and <code>get…By</code> prefixes from the method and starts parsing the rest of it. The introducing clause can contain further expressions, such as a <code>Distinct</code> to set a distinct flag on the query to be created. However, the first <code>By</code> acts as a delimiter to indicate the start of the actual criteria. At a very basic level, you can define conditions on entity properties and concatenate them with <code>And</code> and <code>Or</code>. The following example shows how to create a number of queries:</p>
</div>
<div class="exampleblock">
<div class="title">Example 13. Query creation from method names</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{

  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByEmailAddressAndLastname</span><span class="hljs-params">(EmailAddress emailAddress, String lastname)</span></span>;

  <span class="hljs-comment">// Enables the distinct flag for the query</span>
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findDistinctPeopleByLastnameOrFirstname</span><span class="hljs-params">(String lastname, String firstname)</span></span>;
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findPeopleDistinctByLastnameOrFirstname</span><span class="hljs-params">(String lastname, String firstname)</span></span>;

  <span class="hljs-comment">// Enabling ignoring case for an individual property</span>
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByLastnameIgnoreCase</span><span class="hljs-params">(String lastname)</span></span>;
  <span class="hljs-comment">// Enabling ignoring case for all suitable properties</span>
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByLastnameAndFirstnameAllIgnoreCase</span><span class="hljs-params">(String lastname, String firstname)</span></span>;

  <span class="hljs-comment">// Enabling static ORDER BY for a query</span>
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByLastnameOrderByFirstnameAsc</span><span class="hljs-params">(String lastname)</span></span>;
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByLastnameOrderByFirstnameDesc</span><span class="hljs-params">(String lastname)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The actual result of parsing the method depends on the persistence store for which you create the query. However, there are some general things to notice:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The expressions are usually property traversals combined with operators that can be concatenated. You can combine property expressions with <code>AND</code> and <code>OR</code>. You also get support for operators such as <code>Between</code>, <code>LessThan</code>, <code>GreaterThan</code>, and <code>Like</code> for the property expressions. The supported operators can vary by datastore, so consult the appropriate part of your reference documentation.</p>
</li>
<li>
<p>The method parser supports setting an <code>IgnoreCase</code> flag for individual properties (for example, <code>findByLastnameIgnoreCase(…)</code>) or for all properties of a type that supports ignoring case (usually <code>String</code> instances — for example, <code>findByLastnameAndFirstnameAllIgnoreCase(…)</code>). Whether ignoring cases is supported may vary by store, so consult the relevant sections in the reference documentation for the store-specific query method.</p>
</li>
<li>
<p>You can apply static ordering by appending an <code>OrderBy</code> clause to the query method that references a property and by providing a sorting direction (<code>Asc</code> or <code>Desc</code>). To create a query method that supports dynamic sorting, see “<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.special-parameters">Special parameter handling</a>”.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="repositories.query-methods.query-property-expressions"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.query-property-expressions"></a>4.4.3. Property Expressions</h4>
<div class="paragraph">
<p>Property expressions can refer only to a direct property of the managed entity, as shown in the preceding example. At query creation time, you already make sure that the parsed property is a property of the managed domain class. However, you can also define constraints by traversing nested properties. Consider the following method signature:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByAddressZipCode</span><span class="hljs-params">(ZipCode zipCode)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Assume a <code>Person</code> has an <code>Address</code> with a <code>ZipCode</code>. In that case, the method creates the <code>x.address.zipCode</code> property traversal. The resolution algorithm starts by interpreting the entire part (<code>AddressZipCode</code>) as the property and checks the domain class for a property with that name (uncapitalized). If the algorithm succeeds, it uses that property. If not, the algorithm splits up the source at the camel-case parts from the right side into a head and a tail and tries to find the corresponding property — in our example, <code>AddressZip</code> and <code>Code</code>. If the algorithm finds a property with that head, it takes the tail and continues building the tree down from there, splitting the tail up in the way just described. If the first split does not match, the algorithm moves the split point to the left (<code>Address</code>, <code>ZipCode</code>) and continues.</p>
</div>
<div class="paragraph">
<p>Although this should work for most cases, it is possible for the algorithm to select the wrong property. Suppose the <code>Person</code> class has an <code>addressZip</code> property as well. The algorithm would match in the first split round already, choose the wrong property, and fail (as the type of <code>addressZip</code> probably has no <code>code</code> property).</p>
</div>
<div class="paragraph">
<p>To resolve this ambiguity you can use <code>_</code> inside your method name to manually define traversal points. So our method name would be as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByAddress_ZipCode</span><span class="hljs-params">(ZipCode zipCode)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Because we treat the underscore character as a reserved character, we strongly advise following standard Java naming conventions (that is, not using underscores in property names but using camel case instead).</p>
</div>
</div>
<div class="sect3">
<h4 id="repositories.special-parameters"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.special-parameters"></a>4.4.4. Special parameter handling</h4>
<div class="paragraph">
<p>To handle parameters in your query, define method parameters as already seen in the preceding examples. Besides that, the infrastructure recognizes certain specific types like <code>Pageable</code> and <code>Sort</code>, to apply pagination and sorting to your queries dynamically. The following example demonstrates these features:</p>
</div>
<div class="exampleblock">
<div class="title">Example 14. Using <code>Pageable</code>, <code>Slice</code>, and <code>Sort</code> in query methods</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function">Page&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;

<span class="hljs-function">Slice&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;

<span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname, Sort sort)</span></span>;

<span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
APIs taking <code>Sort</code> and <code>Pageable</code> expect non-<code>null</code> values to be handed into methods.
If you do not want to apply any sorting or pagination, use <code>Sort.unsorted()</code> and <code>Pageable.unpaged()</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The first method lets you pass an <code>org.springframework.data.domain.Pageable</code> instance to the query method to dynamically add paging to your statically defined query. A <code>Page</code> knows about the total number of elements and pages available. It does so by the infrastructure triggering a count query to calculate the overall number. As this might be expensive (depending on the store used), you can instead return a <code>Slice</code>. A <code>Slice</code> knows only about whether a next <code>Slice</code> is available, which might be sufficient when walking through a larger result set.</p>
</div>
<div class="paragraph">
<p>Sorting options are handled through the <code>Pageable</code> instance, too. If you need only sorting, add an <code>org.springframework.data.domain.Sort</code> parameter to your method. As you can see, returning a <code>List</code> is also possible. In this case, the additional metadata required to build the actual <code>Page</code> instance is not created (which, in turn, means that the additional count query that would have been necessary is not issued). Rather, it restricts the query to look up only the given range of entities.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To find out how many pages you get for an entire query, you have to trigger an additional count query. By default, this query is derived from the query you actually trigger.
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="repositories.paging-and-sorting"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.paging-and-sorting"></a>Paging and Sorting</h5>
<div class="paragraph">
<p>You can define simple sorting expressions by using property names.
You can concatenate expressions to collect multiple criteria into one expression.</p>
</div>
<div class="exampleblock">
<div class="title">Example 15. Defining sort expressions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Sort sort = Sort.by(<span class="hljs-string">"firstname"</span>).ascending()
  .and(Sort.by(<span class="hljs-string">"lastname"</span>).descending());</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For a more type-safe way to define sort expressions, start with the type for which to define the sort expression and use method references to define the properties on which to sort.</p>
</div>
<div class="exampleblock">
<div class="title">Example 16. Defining sort expressions by using the type-safe API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">TypedSort&lt;Person&gt; person = Sort.sort(Person.class);

Sort sort = person.by(Person::getFirstname).ascending()
  .and(person.by(Person::getLastname).descending());</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>TypedSort.by(…)</code> makes use of runtime proxies by (typically) using CGlib, which may interfere with native image compilation when using tools such as Graal VM Native.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If your store implementation supports Querydsl, you can also use the generated metamodel types to define sort expressions:</p>
</div>
<div class="exampleblock">
<div class="title">Example 17. Defining sort expressions by using the Querydsl API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">QSort sort = QSort.by(QPerson.firstname.asc())
  .and(QSort.by(QPerson.lastname.desc()));</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="repositories.limit-query-result"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.limit-query-result"></a>4.4.5. Limiting Query Results</h4>
<div class="paragraph">
<p>You can limit the results of query methods by using the <code>first</code> or <code>top</code> keywords, which you can use interchangeably. You can append an optional numeric value to <code>top</code> or <code>first</code> to specify the maximum result size to be returned.
If the number is left out, a result size of 1 is assumed. The following example shows how to limit the query size:</p>
</div>
<div class="exampleblock">
<div class="title">Example 18. Limiting the result size of a query with <code>Top</code> and <code>First</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function">User <span class="hljs-title">findFirstByOrderByLastnameAsc</span><span class="hljs-params">()</span></span>;

<span class="hljs-function">User <span class="hljs-title">findTopByOrderByAgeDesc</span><span class="hljs-params">()</span></span>;

<span class="hljs-function">Page&lt;User&gt; <span class="hljs-title">queryFirst10ByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;

<span class="hljs-function">Slice&lt;User&gt; <span class="hljs-title">findTop3ByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;

<span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findFirst10ByLastname</span><span class="hljs-params">(String lastname, Sort sort)</span></span>;

<span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findTop10ByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The limiting expressions also support the <code>Distinct</code> keyword. Also, for the queries that limit the result set to one instance, wrapping the result into with the <code>Optional</code> keyword is supported.</p>
</div>
<div class="paragraph">
<p>If pagination or slicing is applied to a limiting query pagination (and the calculation of the number of available pages), it is applied within the limited result.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Limiting the results in combination with dynamic sorting by using a <code>Sort</code> parameter lets you express query methods for the 'K' smallest as well as for the 'K' biggest elements.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="repositories.collections-and-iterables"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.collections-and-iterables"></a>4.4.6. Repository Methods Returning Collections or Iterables</h4>
<div class="paragraph">
<p>Query methods that return multiple results can use standard Java <code>Iterable</code>, <code>List</code>, and <code>Set</code>.
Beyond that, we support returning Spring Data’s <code>Streamable</code>, a custom extension of <code>Iterable</code>, as well as collection types provided by <a href="https://www.vavr.io/">Vavr</a>.</p>
</div>
<div class="sect4">
<h5 id="repositories.collections-and-iterables.streamable"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.collections-and-iterables.streamable"></a>Using Streamable as Query Method Return Type</h5>
<div class="paragraph">
<p>You can use <code>Streamable</code> as alternative to <code>Iterable</code> or any collection type.
It provides convenience methods to access a non-parallel <code>Stream</code> (missing from <code>Iterable</code>) and the ability to directly <code>….filter(…)</code> and <code>….map(…)</code> over the elements and concatenate the <code>Streamable</code> to others:</p>
</div>
<div class="exampleblock">
<div class="title">Example 19. Using Streamable to combine query method results</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{
  <span class="hljs-function">Streamable&lt;Person&gt; <span class="hljs-title">findByFirstnameContaining</span><span class="hljs-params">(String firstname)</span></span>;
  <span class="hljs-function">Streamable&lt;Person&gt; <span class="hljs-title">findByLastnameContaining</span><span class="hljs-params">(String lastname)</span></span>;
}

Streamable&lt;Person&gt; result = repository.findByFirstnameContaining(<span class="hljs-string">"av"</span>)
  .and(repository.findByLastnameContaining(<span class="hljs-string">"ea"</span>));</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="repositories.collections-and-iterables.streamable-wrapper"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.collections-and-iterables.streamable-wrapper"></a>Returning Custom Streamable Wrapper Types</h5>
<div class="paragraph">
<p>Providing dedicated wrapper types for collections is a commonly used pattern to provide an API for a query result that returns multiple elements.
Usually, these types are used by invoking a repository method returning a collection-like type and creating an instance of the wrapper type manually.
You can avoid that additional step as Spring Data lets you use these wrapper types as query method return types if they meet the following criteria:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The type implements <code>Streamable</code>.</p>
</li>
<li>
<p>The type exposes either a constructor or a static factory method named <code>of(…)</code> or <code>valueOf(…)</code> that takes <code>Streamable</code> as an argument.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following listing shows an example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Product</span> </span>{ <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
  <span class="hljs-function">MonetaryAmount <span class="hljs-title">getPrice</span><span class="hljs-params">()</span> </span>{ … }
}

<span class="hljs-meta">@RequiredArgConstructor</span>(staticName = <span class="hljs-string">"of"</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Products</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Streamable</span>&lt;<span class="hljs-title">Product</span>&gt; </span>{ <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>

  <span class="hljs-keyword">private</span> Streamable&lt;Product&gt; streamable;

  <span class="hljs-function"><span class="hljs-keyword">public</span> MonetaryAmount <span class="hljs-title">getTotal</span><span class="hljs-params">()</span> </span>{ <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>
    <span class="hljs-keyword">return</span> streamable.stream() <span class="hljs-comment">//</span>
      .map(Priced::getPrice)
      .reduce(Money.of(<span class="hljs-number">0</span>), MonetaryAmount::add);
  }
}

<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ProductRepository</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Product</span>, <span class="hljs-title">Long</span>&gt; </span>{
  <span class="hljs-function">Products <span class="hljs-title">findAllByDescriptionContaining</span><span class="hljs-params">(String text)</span></span>; <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A <code>Product</code> entity that exposes API to access the product’s price.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A wrapper type for a <code>Streamable&lt;Product&gt;</code> that can be constructed by using <code>Products.of(…)</code> (factory method created with the Lombok annotation).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The wrapper type exposes an additional API, calculating new values on the <code>Streamable&lt;Product&gt;</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>That wrapper type can be used as a query method return type directly. You need not return <code>Streamable&lt;Product&gt;</code> and manually wrap it in the repository client.</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="repositories.collections-and-iterables.vavr"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.collections-and-iterables.vavr"></a>Support for Vavr Collections</h5>
<div class="paragraph">
<p><a href="https://www.vavr.io/">Vavr</a> is a library that embraces functional programming concepts in Java.
It ships with a custom set of collection types that you can use as query method return types, as the following table shows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Vavr collection type</th>
<th class="tableblock halign-left valign-top">Used Vavr implementation type</th>
<th class="tableblock halign-left valign-top">Valid Java source types</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.Seq</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.List</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Iterable</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.Set</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.LinkedHashSet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Iterable</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.Map</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.LinkedHashMap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Map</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can use the types in the first column (or subtypes thereof) as query method return types and get the types in the second column used as implementation type, depending on the Java type of the actual query result (third column).
Alternatively, you can declare <code>Traversable</code> (the Vavr <code>Iterable</code> equivalent), and we then derive the implementation class from the actual return value. That is, a <code>java.util.List</code> is turned into a Vavr <code>List</code> or <code>Seq</code>, a <code>java.util.Set</code> becomes a Vavr <code>LinkedHashSet</code> <code>Set</code>, and so on.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="repositories.nullability"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.nullability"></a>4.4.7. Null Handling of Repository Methods</h4>
<div class="paragraph">
<p>As of Spring Data 2.0, repository CRUD methods that return an individual aggregate instance use Java 8’s <code>Optional</code> to indicate the potential absence of a value.
Besides that, Spring Data supports returning the following wrapper types on query methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>com.google.common.base.Optional</code></p>
</li>
<li>
<p><code>scala.Option</code></p>
</li>
<li>
<p><code>io.vavr.control.Option</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alternatively, query methods can choose not to use a wrapper type at all.
The absence of a query result is then indicated by returning <code>null</code>.
Repository methods returning collections, collection alternatives, wrappers, and streams are guaranteed never to return <code>null</code> but rather the corresponding empty representation.
See “<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repository-query-return-types">Repository query return types</a>” for details.</p>
</div>
<div class="sect4">
<h5 id="repositories.nullability.annotations"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.nullability.annotations"></a>Nullability Annotations</h5>
<div class="paragraph">
<p>You can express nullability constraints for repository methods by using <a href="https://docs.spring.io/spring/docs/5.3.0/spring-framework-reference/core.html#null-safety">Spring Framework’s nullability annotations</a>.
They provide a tooling-friendly approach and opt-in <code>null</code> checks during runtime, as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.3.0/javadoc-api/org/springframework/lang/NonNullApi.html"><code>@NonNullApi</code></a>: Used on the package level to declare that the default behavior for parameters and return values is, respectively, neither to accept nor to produce <code>null</code> values.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.3.0/javadoc-api/org/springframework/lang/NonNull.html"><code>@NonNull</code></a>: Used on a parameter or return value that must not be <code>null</code> (not needed on a parameter and return value where <code>@NonNullApi</code> applies).</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.3.0/javadoc-api/org/springframework/lang/Nullable.html"><code>@Nullable</code></a>: Used on a parameter or return value that can be <code>null</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Spring annotations are meta-annotated with <a href="https://jcp.org/en/jsr/detail?id=305">JSR 305</a> annotations (a dormant but widely used JSR). JSR 305 meta-annotations let tooling vendors (such as <a href="https://www.jetbrains.com/help/idea/nullable-and-notnull-annotations.html">IDEA</a>, <a href="https://help.eclipse.org/oxygen/index.jsp?topic=/org.eclipse.jdt.doc.user/tasks/task-using_external_null_annotations.htm">Eclipse</a>, and <a href="https://kotlinlang.org/docs/reference/java-interop.html#null-safety-and-platform-types">Kotlin</a>) provide null-safety support in a generic way, without having to hard-code support for Spring annotations.
To enable runtime checking of nullability constraints for query methods, you need to activate non-nullability on the package level by using Spring’s <code>@NonNullApi</code> in <code>package-info.java</code>, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 20. Declaring Non-nullability in <code>package-info.java</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@org</span>.springframework.lang.NonNullApi
<span class="hljs-keyword">package</span> com.acme;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once non-null defaulting is in place, repository query method invocations get validated at runtime for nullability constraints.
If a query result violates the defined constraint, an exception is thrown. This happens when the method would return <code>null</code> but is declared as non-nullable (the default with the annotation defined on the package in which the repository resides).
If you want to opt-in to nullable results again, selectively use <code>@Nullable</code> on individual methods.
Using the result wrapper types mentioned at the start of this section continues to work as expected: an empty result is translated into the value that represents absence.</p>
</div>
<div class="paragraph">
<p>The following example shows a number of the techniques just described:</p>
</div>
<div class="exampleblock">
<div class="title">Example 21. Using different nullability constraints</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">package</span> com.acme;                                                       <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>

<span class="hljs-keyword">import</span> org.springframework.lang.Nullable;

<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{

  <span class="hljs-function">User <span class="hljs-title">getByEmailAddress</span><span class="hljs-params">(EmailAddress emailAddress)</span></span>;                    <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>

  <span class="hljs-meta">@Nullable</span>
  <span class="hljs-function">User <span class="hljs-title">findByEmailAddress</span><span class="hljs-params">(@Nullable EmailAddress emailAdress)</span></span>;          <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>

  <span class="hljs-function">Optional&lt;User&gt; <span class="hljs-title">findOptionalByEmailAddress</span><span class="hljs-params">(EmailAddress emailAddress)</span></span>; <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The repository resides in a package (or sub-package) for which we have defined non-null behavior.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Throws an <code>EmptyResultDataAccessException</code> when the query does not produce a result. Throws an <code>IllegalArgumentException</code> when the <code>emailAddress</code> handed to the method is <code>null</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Returns <code>null</code> when the query does not produce a result. Also accepts <code>null</code> as the value for <code>emailAddress</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Returns <code>Optional.empty()</code> when the query does not produce a result. Throws an <code>IllegalArgumentException</code> when the <code>emailAddress</code> handed to the method is <code>null</code>.</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="repositories.nullability.kotlin"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.nullability.kotlin"></a>Nullability in Kotlin-based Repositories</h5>
<div class="paragraph">
<p>Kotlin has the definition of <a href="https://kotlinlang.org/docs/reference/null-safety.html">nullability constraints</a> baked into the language.
Kotlin code compiles to bytecode, which does not express nullability constraints through method signatures but rather through compiled-in metadata. Make sure to include the <code>kotlin-reflect</code> JAR in your project to enable introspection of Kotlin’s nullability constraints.
Spring Data repositories use the language mechanism to define those constraints to apply the same runtime checks, as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 22. Using nullability constraints on Kotlin repositories</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> : <span class="hljs-type">Repository</span>&lt;<span class="hljs-type">User, String</span>&gt; </span>{

  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">findByUsername</span><span class="hljs-params">(username: <span class="hljs-type">String</span>)</span></span>: User     <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>

  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">findByFirstname</span><span class="hljs-params">(firstname: <span class="hljs-type">String</span>?)</span></span>: User? <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method defines both the parameter and the result as non-nullable (the Kotlin default). The Kotlin compiler rejects method invocations that pass <code>null</code> to the method. If the query yields an empty result, an <code>EmptyResultDataAccessException</code> is thrown.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This method accepts <code>null</code> for the <code>firstname</code> parameter and returns <code>null</code> if the query does not produce a result.</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="repositories.query-streaming"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-streaming"></a>4.4.8. Streaming Query Results</h4>
<div class="paragraph">
<p>You can process the results of query methods incrementally by using a Java 8 <code>Stream&lt;T&gt;</code> as the return type. Instead of wrapping the query results in a <code>Stream</code>, data store-specific methods are used to perform the streaming, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 23. Stream the result of a query with Java 8 <code>Stream&lt;T&gt;</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Query</span>(<span class="hljs-string">"select u from User u"</span>)
<span class="hljs-function">Stream&lt;User&gt; <span class="hljs-title">findAllByCustomQueryAndStream</span><span class="hljs-params">()</span></span>;

<span class="hljs-function">Stream&lt;User&gt; <span class="hljs-title">readAllByFirstnameNotNull</span><span class="hljs-params">()</span></span>;

<span class="hljs-meta">@Query</span>(<span class="hljs-string">"select u from User u"</span>)
<span class="hljs-function">Stream&lt;User&gt; <span class="hljs-title">streamAllPaged</span><span class="hljs-params">(Pageable pageable)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A <code>Stream</code> potentially wraps underlying data store-specific resources and must, therefore, be closed after usage. You can either manually close the <code>Stream</code> by using the <code>close()</code> method or by using a Java 7 <code>try-with-resources</code> block, as shown in the following example:
</td>
</tr>
</tbody></table>
</div>
<div class="exampleblock">
<div class="title">Example 24. Working with a <code>Stream&lt;T&gt;</code> result in a <code>try-with-resources</code> block</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">try</span> (Stream&lt;User&gt; stream = repository.findAllByCustomQueryAndStream()) {
  stream.forEach(…);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Not all Spring Data modules currently support <code>Stream&lt;T&gt;</code> as a return type.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="repositories.query-async"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-async"></a>4.4.9. Asynchronous Query Results</h4>
<div class="paragraph">
<p>You can run repository queries asynchronously by using <a href="https://docs.spring.io/spring/docs/5.3.0/spring-framework-reference/integration.html#scheduling">Spring’s asynchronous method running capability</a>. This means the method returns immediately upon invocation while the actual query occurs in a task that has been submitted to a Spring <code>TaskExecutor</code>. Asynchronous queries differ from reactive queries and should not be mixed. See the store-specific documentation for more details on reactive support. The following example shows a number of asynchronous queries:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Async</span>
<span class="hljs-function">Future&lt;User&gt; <span class="hljs-title">findByFirstname</span><span class="hljs-params">(String firstname)</span></span>;               <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>

<span class="hljs-meta">@Async</span>
<span class="hljs-function">CompletableFuture&lt;User&gt; <span class="hljs-title">findOneByFirstname</span><span class="hljs-params">(String firstname)</span></span>; <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>

<span class="hljs-meta">@Async</span>
<span class="hljs-function">ListenableFuture&lt;User&gt; <span class="hljs-title">findOneByLastname</span><span class="hljs-params">(String lastname)</span></span>;    <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>java.util.concurrent.Future</code> as the return type.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use a Java 8 <code>java.util.concurrent.CompletableFuture</code> as the return type.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use a <code>org.springframework.util.concurrent.ListenableFuture</code> as the return type.</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repositories.create-instances"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances"></a>4.5. Creating Repository Instances</h3>
<div class="paragraph">
<p>This section covers how to create instances and bean definitions for the defined repository interfaces. One way to do so is by using the Spring namespace that is shipped with each Spring Data module that supports the repository mechanism, although we generally recommend using Java configuration.</p>
</div>
<div class="sect3">
<h4 id="repositories.create-instances.spring"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances.spring"></a>4.5.1. XML Configuration</h4>
<div class="paragraph">
<p>Each Spring Data module includes a <code>repositories</code> element that lets you define a base package that Spring scans for you, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 25. Enabling Spring Data repositories via XML</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans:beans</span> <span class="hljs-attr">xmlns:beans</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/data/jpa"</span>
  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans
    https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/data/jpa
    https://www.springframework.org/schema/data/jpa/spring-jpa.xsd"</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repositories"</span> /&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">beans:beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, Spring is instructed to scan <code>com.acme.repositories</code> and all its sub-packages for interfaces extending <code>Repository</code> or one of its sub-interfaces.
For each interface found, the infrastructure registers the persistence technology-specific <code>FactoryBean</code> to create the appropriate proxies that handle invocations of the query methods.
Each bean is registered under a bean name that is derived from the interface name, so an interface of <code>UserRepository</code> would be registered under <code>userRepository</code>.
Bean names for nested repository interfaces are prefixed with their enclosing type name.
The <code>base-package</code> attribute allows wildcards so that you can define a pattern of scanned packages.</p>
</div>
<div class="sect4">
<h5 id="repositories.using-filters"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.using-filters"></a>Using Filters</h5>
<div class="paragraph">
<p>By default, the infrastructure picks up every interface that extends the persistence technology-specific <code>Repository</code> sub-interface located under the configured base package and creates a bean instance for it. However, you might want more fine-grained control over which interfaces have bean instances created for them. To do so, use <code>&lt;include-filter /&gt;</code> and <code>&lt;exclude-filter /&gt;</code> elements inside the <code>&lt;repositories /&gt;</code> element. The semantics are exactly equivalent to the elements in Spring’s context namespace. For details, see the <a href="https://docs.spring.io/spring/docs/5.3.0/spring-framework-reference/core.html#beans-scanning-filters">Spring reference documentation</a> for these elements.</p>
</div>
<div class="paragraph">
<p>For example, to exclude certain interfaces from instantiation as repository beans, you could use the following configuration:</p>
</div>
<div class="exampleblock">
<div class="title">Example 26. Using exclude-filter element</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repositories"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">context:exclude-filter</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"regex"</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">".*SomeRepository"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">repositories</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The preceding example excludes all interfaces ending in <code>SomeRepository</code> from being instantiated.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="repositories.create-instances.java-config"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances.java-config"></a>4.5.2. Java Configuration</h4>
<div class="paragraph">
<p>You can also trigger the repository infrastructure by using a store-specific <code>@Enable${store}Repositories</code> annotation on a Java configuration class. For an introduction to Java-based configuration of the Spring container, see <a href="https://docs.spring.io/spring/docs/5.3.0/spring-framework-reference/core.html#beans-java">JavaConfig in the Spring reference documentation</a>.</p>
</div>
<div class="paragraph">
<p>A sample configuration to enable Spring Data repositories resembles the following:</p>
</div>
<div class="exampleblock">
<div class="title">Example 27. Sample annotation-based repository configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableJpaRepositories</span>(<span class="hljs-string">"com.acme.repositories"</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationConfiguration</span> </span>{

  <span class="hljs-meta">@Bean</span>
  <span class="hljs-function">EntityManagerFactory <span class="hljs-title">entityManagerFactory</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// …</span>
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The preceding example uses the JPA-specific annotation, which you would change according to the store module you actually use. The same applies to the definition of the <code>EntityManagerFactory</code> bean. See the sections covering the store-specific configuration.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="repositories.create-instances.standalone"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances.standalone"></a>4.5.3. Standalone Usage</h4>
<div class="paragraph">
<p>You can also use the repository infrastructure outside of a Spring container — for example, in CDI environments. You still need some Spring libraries in your classpath, but, generally, you can set up repositories programmatically as well. The Spring Data modules that provide repository support ship with a persistence technology-specific <code>RepositoryFactory</code> that you can use, as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 28. Standalone usage of the repository factory</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">RepositoryFactorySupport factory = … <span class="hljs-comment">// Instantiate factory here</span>
UserRepository repository = factory.getRepository(UserRepository.class);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repositories.custom-implementations"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.custom-implementations"></a>4.6. Custom Implementations for Spring Data Repositories</h3>
<div class="paragraph">
<p>This section covers repository customization and how fragments form a composite repository.</p>
</div>
<div class="paragraph">
<p>When a query method requires a different behavior or cannot be implemented by query derivation, you need to provide a custom implementation. Spring Data repositories let you provide custom repository code and integrate it with generic CRUD abstraction and query method functionality.</p>
</div>
<div class="sect3">
<h4 id="repositories.single-repository-behavior"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.single-repository-behavior"></a>4.6.1. Customizing Individual Repositories</h4>
<div class="paragraph">
<p>To enrich a repository with custom functionality, you must first define a fragment interface and an implementation for the custom functionality, as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 29. Interface for custom repository functionality</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CustomizedUserRepository</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">someCustomMethod</span><span class="hljs-params">(User user)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 30. Implementation of custom repository functionality</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomizedUserRepositoryImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CustomizedUserRepository</span> </span>{

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">someCustomMethod</span><span class="hljs-params">(User user)</span> </span>{
    <span class="hljs-comment">// Your custom implementation</span>
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The most important part of the class name that corresponds to the fragment interface is the <code>Impl</code> postfix.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The implementation itself does not depend on Spring Data and can be a regular Spring bean. Consequently, you can use standard dependency injection behavior to inject references to other beans (such as a <code>JdbcTemplate</code>), take part in aspects, and so on.</p>
</div>
<div class="paragraph">
<p>Then you can let your repository interface extend the fragment interface, as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 31. Changes to your repository interface</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt;, <span class="hljs-title">CustomizedUserRepository</span> </span>{

  <span class="hljs-comment">// Declare query methods here</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Extending the fragment interface with your repository interface combines the CRUD and custom functionality and makes it available to clients.</p>
</div>
<div class="paragraph">
<p>Spring Data repositories are implemented by using fragments that form a repository composition. Fragments are the base repository, functional aspects (such as <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.extensions.querydsl">QueryDsl</a>), and custom interfaces along with their implementations. Each time you add an interface to your repository interface, you enhance the composition by adding a fragment. The base repository and repository aspect implementations are provided by each Spring Data module.</p>
</div>
<div class="paragraph">
<p>The following example shows custom interfaces and their implementations:</p>
</div>
<div class="exampleblock">
<div class="title">Example 32. Fragments with their implementations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">HumanRepository</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">someHumanMethod</span><span class="hljs-params">(User user)</span></span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HumanRepositoryImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HumanRepository</span> </span>{

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">someHumanMethod</span><span class="hljs-params">(User user)</span> </span>{
    <span class="hljs-comment">// Your custom implementation</span>
  }
}

<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ContactRepository</span> </span>{

  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">someContactMethod</span><span class="hljs-params">(User user)</span></span>;

  <span class="hljs-function">User <span class="hljs-title">anotherContactMethod</span><span class="hljs-params">(User user)</span></span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContactRepositoryImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ContactRepository</span> </span>{

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">someContactMethod</span><span class="hljs-params">(User user)</span> </span>{
    <span class="hljs-comment">// Your custom implementation</span>
  }

  <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">anotherContactMethod</span><span class="hljs-params">(User user)</span> </span>{
    <span class="hljs-comment">// Your custom implementation</span>
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example shows the interface for a custom repository that extends <code>CrudRepository</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 33. Changes to your repository interface</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt;, <span class="hljs-title">HumanRepository</span>, <span class="hljs-title">ContactRepository</span> </span>{

  <span class="hljs-comment">// Declare query methods here</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Repositories may be composed of multiple custom implementations that are imported in the order of their declaration. Custom implementations have a higher priority than the base implementation and repository aspects. This ordering lets you override base repository and aspect methods and resolves ambiguity if two fragments contribute the same method signature. Repository fragments are not limited to use in a single repository interface. Multiple repositories may use a fragment interface, letting you reuse customizations across different repositories.</p>
</div>
<div class="paragraph">
<p>The following example shows a repository fragment and its implementation:</p>
</div>
<div class="exampleblock">
<div class="title">Example 34. Fragments overriding <code>save(…)</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CustomizedSave</span>&lt;<span class="hljs-title">T</span>&gt; </span>{
  &lt;S extends T&gt; <span class="hljs-function">S <span class="hljs-title">save</span><span class="hljs-params">(S entity)</span></span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomizedSaveImpl</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">CustomizedSave</span>&lt;<span class="hljs-title">T</span>&gt; </span>{

  <span class="hljs-keyword">public</span> &lt;S extends T&gt; <span class="hljs-function">S <span class="hljs-title">save</span><span class="hljs-params">(S entity)</span> </span>{
    <span class="hljs-comment">// Your custom implementation</span>
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example shows a repository that uses the preceding repository fragment:</p>
</div>
<div class="exampleblock">
<div class="title">Example 35. Customized repository interfaces</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt;, <span class="hljs-title">CustomizedSave</span>&lt;<span class="hljs-title">User</span>&gt; </span>{
}

<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt;, <span class="hljs-title">CustomizedSave</span>&lt;<span class="hljs-title">Person</span>&gt; </span>{
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="repositories.configuration"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.configuration"></a>Configuration</h5>
<div class="paragraph">
<p>If you use namespace configuration, the repository infrastructure tries to autodetect custom implementation fragments by scanning for classes below the package in which it found a repository. These classes need to follow the naming convention of appending the namespace element’s <code>repository-impl-postfix</code> attribute to the fragment interface name. This postfix defaults to <code>Impl</code>. The following example shows a repository that uses the default postfix and a repository that sets a custom value for the postfix:</p>
</div>
<div class="exampleblock">
<div class="title">Example 36. Configuration example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repository"</span> /&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repository"</span> <span class="hljs-attr">repository-impl-postfix</span>=<span class="hljs-string">"MyPostfix"</span> /&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The first configuration in the preceding example tries to look up a class called <code>com.acme.repository.CustomizedUserRepositoryImpl</code> to act as a custom repository implementation. The second example tries to look up <code>com.acme.repository.CustomizedUserRepositoryMyPostfix</code>.</p>
</div>
<div class="sect5">
<h6 id="repositories.single-repository-behaviour.ambiguity"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.single-repository-behaviour.ambiguity"></a>Resolution of Ambiguity</h6>
<div class="paragraph">
<p>If multiple implementations with matching class names are found in different packages, Spring Data uses the bean names to identify which one to use.</p>
</div>
<div class="paragraph">
<p>Given the following two custom implementations for the <code>CustomizedUserRepository</code> shown earlier, the first implementation is used.
Its bean name is <code>customizedUserRepositoryImpl</code>, which matches that of the fragment interface (<code>CustomizedUserRepository</code>) plus the postfix <code>Impl</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 37. Resolution of ambiguous implementations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">package</span> com.acme.impl.one;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomizedUserRepositoryImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CustomizedUserRepository</span> </span>{

  <span class="hljs-comment">// Your custom implementation</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">package</span> com.acme.impl.two;

<span class="hljs-meta">@Component</span>(<span class="hljs-string">"specialCustomImpl"</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomizedUserRepositoryImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CustomizedUserRepository</span> </span>{

  <span class="hljs-comment">// Your custom implementation</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you annotate the <code>UserRepository</code> interface with <code>@Component("specialCustom")</code>, the bean name plus <code>Impl</code> then matches the one defined for the repository implementation in <code>com.acme.impl.two</code>, and it is used instead of the first one.</p>
</div>
</div>
<div class="sect5">
<h6 id="repositories.manual-wiring"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.manual-wiring"></a>Manual Wiring</h6>
<div class="paragraph">
<p>If your custom implementation uses annotation-based configuration and autowiring only, the preceding approach shown works well, because it is treated as any other Spring bean. If your implementation fragment bean needs special wiring, you can declare the bean and name it according to the conventions described in the <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.single-repository-behaviour.ambiguity">preceding section</a>. The infrastructure then refers to the manually defined bean definition by name instead of creating one itself. The following example shows how to manually wire a custom implementation:</p>
</div>
<div class="exampleblock">
<div class="title">Example 38. Manual wiring of custom implementations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repository"</span> /&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">beans:bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userRepositoryImpl"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"…"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- further configuration --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans:bean</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="repositories.customize-base-repository"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.customize-base-repository"></a>4.6.2. Customize the Base Repository</h4>
<div class="paragraph">
<p>The approach described in the <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.manual-wiring">preceding section</a> requires customization of each repository interfaces when you want to customize the base repository behavior so that all repositories are affected. To instead change behavior for all repositories, you can create an implementation that extends the persistence technology-specific repository base class. This class then acts as a custom base class for the repository proxies, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 39. Custom repository base class</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyRepositoryImpl</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt;
  <span class="hljs-keyword">extends</span> <span class="hljs-title">SimpleJpaRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; </span>{

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> EntityManager entityManager;

  MyRepositoryImpl(JpaEntityInformation entityInformation,
                          EntityManager entityManager) {
    <span class="hljs-keyword">super</span>(entityInformation, entityManager);

    <span class="hljs-comment">// Keep the EntityManager around to used from the newly introduced methods.</span>
    <span class="hljs-keyword">this</span>.entityManager = entityManager;
  }

  <span class="hljs-meta">@Transactional</span>
  <span class="hljs-keyword">public</span> &lt;S extends T&gt; <span class="hljs-function">S <span class="hljs-title">save</span><span class="hljs-params">(S entity)</span> </span>{
    <span class="hljs-comment">// implementation goes here</span>
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
The class needs to have a constructor of the super class which the store-specific repository factory implementation uses. If the repository base class has multiple constructors, override the one taking an <code>EntityInformation</code> plus a store specific infrastructure object (such as an <code>EntityManager</code> or a template class).
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The final step is to make the Spring Data infrastructure aware of the customized repository base class. In Java configuration, you can do so by using the <code>repositoryBaseClass</code> attribute of the <code>@Enable${store}Repositories</code> annotation, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 40. Configuring a custom repository base class using JavaConfig</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableJpaRepositories</span>(repositoryBaseClass = MyRepositoryImpl.class)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationConfiguration</span> </span>{ … }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A corresponding attribute is available in the XML namespace, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 41. Configuring a custom repository base class using XML</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repository"</span>
     <span class="hljs-attr">base-class</span>=<span class="hljs-string">"….MyRepositoryImpl"</span> /&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="core.domain-events"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.domain-events"></a>4.7. Publishing Events from Aggregate Roots</h3>
<div class="paragraph">
<p>Entities managed by repositories are aggregate roots.
In a Domain-Driven Design application, these aggregate roots usually publish domain events.
Spring Data provides an annotation called <code>@DomainEvents</code> that you can use on a method of your aggregate root to make that publication as easy as possible, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 42. Exposing domain events from an aggregate root</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnAggregateRoot</span> </span>{

    <span class="hljs-meta">@DomainEvents</span> <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
    <span class="hljs-function">Collection&lt;Object&gt; <span class="hljs-title">domainEvents</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// … return events you want to get published here</span>
    }

    <span class="hljs-meta">@AfterDomainEventPublication</span> <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">callbackMethod</span><span class="hljs-params">()</span> </span>{
       <span class="hljs-comment">// … potentially clean up domain events list</span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method that uses <code>@DomainEvents</code> can return either a single event instance or a collection of events. It must not take any arguments.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>After all events have been published, we have a method annotated with <code>@AfterDomainEventPublication</code>. You can use it to potentially clean the list of events to be published (among other uses).</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="paragraph">
<p>The methods are called every time one of a Spring Data repository’s <code>save(…)</code>, <code>saveAll(…)</code>, <code>delete(…)</code> or <code>deleteAll(…)</code> methods are called.</p>
</div>
</div>
<div class="sect2">
<h3 id="core.extensions"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.extensions"></a>4.8. Spring Data Extensions</h3>
<div class="paragraph">
<p>This section documents a set of Spring Data extensions that enable Spring Data usage in a variety of contexts. Currently, most of the integration is targeted towards Spring MVC.</p>
</div>
<div class="sect3">
<h4 id="core.extensions.querydsl"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.extensions.querydsl"></a>4.8.1. Querydsl Extension</h4>
<div class="paragraph">
<p><a href="http://www.querydsl.com/">Querydsl</a> is a framework that enables the construction of statically typed SQL-like queries through its fluent API.</p>
</div>
<div class="paragraph">
<p>Several Spring Data modules offer integration with Querydsl through <code>QuerydslPredicateExecutor</code>, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 43. QuerydslPredicateExecutor interface</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">QuerydslPredicateExecutor</span>&lt;<span class="hljs-title">T</span>&gt; </span>{

  <span class="hljs-function">Optional&lt;T&gt; <span class="hljs-title">findById</span><span class="hljs-params">(Predicate predicate)</span></span>;  <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>

  <span class="hljs-function">Iterable&lt;T&gt; <span class="hljs-title">findAll</span><span class="hljs-params">(Predicate predicate)</span></span>;   <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>

  <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">count</span><span class="hljs-params">(Predicate predicate)</span></span>;            <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>

  <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">exists</span><span class="hljs-params">(Predicate predicate)</span></span>;        <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b>

  <span class="hljs-comment">// … more functionality omitted.</span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Finds and returns a single entity matching the <code>Predicate</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Finds and returns all entities matching the <code>Predicate</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Returns the number of entities matching the <code>Predicate</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Returns whether an entity that matches the <code>Predicate</code> exists.</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="paragraph">
<p>To use the Querydsl support, extend <code>QuerydslPredicateExecutor</code> on your repository interface, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 44. Querydsl integration on repositories</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt;, <span class="hljs-title">QuerydslPredicateExecutor</span>&lt;<span class="hljs-title">User</span>&gt; </span>{
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The preceding example lets you write type-safe queries by using Querydsl <code>Predicate</code> instances, as the following example shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Predicate predicate = user.firstname.equalsIgnoreCase(<span class="hljs-string">"dave"</span>)
	.and(user.lastname.startsWithIgnoreCase(<span class="hljs-string">"mathews"</span>));

userRepository.findAll(predicate);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="core.web"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web"></a>4.8.2. Web support</h4>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This section contains the documentation for the Spring Data web support as it is implemented in the current versions of Spring Data Commons. As the newly introduced support changes many things, we kept the documentation of the former behavior in <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#web.legacy">[web.legacy]</a>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Spring Data modules that support the repository programming model ship with a variety of web support. The web related components require Spring MVC JARs to be on the classpath. Some of them even provide integration with <a href="https://github.com/spring-projects/spring-hateoas">Spring HATEOAS</a>. In general, the integration support is enabled by using the <code>@EnableSpringDataWebSupport</code> annotation in your JavaConfig configuration class, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 45. Enabling Spring Data web support</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebMvc</span>
<span class="hljs-meta">@EnableSpringDataWebSupport</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebConfiguration</span> </span>{}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>@EnableSpringDataWebSupport</code> annotation registers a few components. We discuss those later in this section. It also detects Spring HATEOAS on the classpath and registers integration components (if present) for it as well.</p>
</div>
<div class="paragraph">
<p>Alternatively, if you use XML configuration, register either <code>SpringDataWebConfiguration</code> or <code>HateoasAwareSpringDataWebConfiguration</code> as Spring beans, as the following example shows (for <code>SpringDataWebConfiguration</code>):</p>
</div>
<div class="exampleblock">
<div class="title">Example 46. Enabling Spring Data web support in XML</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.data.web.config.SpringDataWebConfiguration"</span> /&gt;</span>

<span class="hljs-comment">&lt;!-- If you use Spring HATEOAS, register this one *instead* of the former --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.data.web.config.HateoasAwareSpringDataWebConfiguration"</span> /&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="core.web.basic"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web.basic"></a>Basic Web Support</h5>
<div class="paragraph">
<p>The configuration shown in the <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web">previous section</a> registers a few basic components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web.basic.domain-class-converter">Using the <code>DomainClassConverter</code> Class</a> to let Spring MVC resolve instances of repository-managed domain classes from request parameters or path variables.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web.basic.paging-and-sorting"><code>HandlerMethodArgumentResolver</code></a> implementations to let Spring MVC resolve <code>Pageable</code> and <code>Sort</code> instances from request parameters.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="core.web.basic.domain-class-converter"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web.basic.domain-class-converter"></a>Using the <code>DomainClassConverter</code> Class</h6>
<div class="paragraph">
<p>The <code>DomainClassConverter</code> class lets you use domain types in your Spring MVC controller method signatures directly so that you need not manually lookup the instances through the repository, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 47. A Spring MVC controller using domain types in method signatures</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/users"</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>{

  <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/{id}"</span>)
  <span class="hljs-function">String <span class="hljs-title">showUserForm</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> User user, Model model) </span>{

    model.addAttribute(<span class="hljs-string">"user"</span>, user);
    <span class="hljs-keyword">return</span> <span class="hljs-string">"userForm"</span>;
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The method receives a <code>User</code> instance directly, and no further lookup is necessary. The instance can be resolved by letting Spring MVC convert the path variable into the <code>id</code> type of the domain class first and eventually access the instance through calling <code>findById(…)</code> on the repository instance registered for the domain type.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently, the repository has to implement <code>CrudRepository</code> to be eligible to be discovered for conversion.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="core.web.basic.paging-and-sorting"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web.basic.paging-and-sorting"></a>HandlerMethodArgumentResolvers for Pageable and Sort</h6>
<div class="paragraph">
<p>The configuration snippet shown in the <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web.basic.domain-class-converter">previous section</a> also registers a <code>PageableHandlerMethodArgumentResolver</code> as well as an instance of <code>SortHandlerMethodArgumentResolver</code>. The registration enables <code>Pageable</code> and <code>Sort</code> as valid controller method arguments, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 48. Using Pageable as a controller method argument</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/users"</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>{

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserRepository repository;

  UserController(UserRepository repository) {
    <span class="hljs-keyword">this</span>.repository = repository;
  }

  <span class="hljs-meta">@RequestMapping</span>
  <span class="hljs-function">String <span class="hljs-title">showUsers</span><span class="hljs-params">(Model model, Pageable pageable)</span> </span>{

    model.addAttribute(<span class="hljs-string">"users"</span>, repository.findAll(pageable));
    <span class="hljs-keyword">return</span> <span class="hljs-string">"users"</span>;
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The preceding method signature causes Spring MVC try to derive a <code>Pageable</code> instance from the request parameters by using the following default configuration:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 1. Request parameters evaluated for <code>Pageable</code> instances</caption>
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>page</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Page you want to retrieve. 0-indexed and defaults to 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size of the page you want to retrieve. Defaults to 20.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties that should be sorted by in the format <code>property,property(,ASC|DESC)(,IgnoreCase)</code>. The default sort direction is case-sensitive ascending. Use multiple <code>sort</code> parameters if you want to switch direction or case sensitivity — for example, <code>?sort=firstname&amp;sort=lastname,asc&amp;sort=city,ignorecase</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To customize this behavior, register a bean that implements the <code>PageableHandlerMethodArgumentResolverCustomizer</code> interface or the <code>SortHandlerMethodArgumentResolverCustomizer</code> interface, respectively. Its <code>customize()</code> method gets called, letting you change settings, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Bean</span> <span class="hljs-function">SortHandlerMethodArgumentResolverCustomizer <span class="hljs-title">sortCustomizer</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> s -&gt; s.setPropertyDelimiter(<span class="hljs-string">"&lt;--&gt;"</span>);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If setting the properties of an existing <code>MethodArgumentResolver</code> is not sufficient for your purpose, extend either <code>SpringDataWebConfiguration</code> or the HATEOAS-enabled equivalent, override the <code>pageableResolver()</code> or <code>sortResolver()</code> methods, and import your customized configuration file instead of using the <code>@Enable</code> annotation.</p>
</div>
<div class="paragraph">
<p>If you need multiple <code>Pageable</code> or <code>Sort</code> instances to be resolved from the request (for multiple tables, for example), you can use Spring’s <code>@Qualifier</code> annotation to distinguish one from another. The request parameters then have to be prefixed with <code>${qualifier}_</code>. The following example shows the resulting method signature:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function">String <span class="hljs-title">showUsers</span><span class="hljs-params">(Model model,
      @Qualifier(<span class="hljs-string">"thing1"</span>)</span> Pageable first,
      @<span class="hljs-title">Qualifier</span><span class="hljs-params">(<span class="hljs-string">"thing2"</span>)</span> Pageable second) </span>{ … }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You have to populate <code>thing1_page</code>, <code>thing2_page</code>, and so on.</p>
</div>
<div class="paragraph">
<p>The default <code>Pageable</code> passed into the method is equivalent to a <code>PageRequest.of(0, 20)</code>, but you can customize it by using the <code>@PageableDefault</code> annotation on the <code>Pageable</code> parameter.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="core.web.pageables"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web.pageables"></a>Hypermedia Support for Pageables</h5>
<div class="paragraph">
<p>Spring HATEOAS ships with a representation model class (<code>PagedResources</code>) that allows enriching the content of a <code>Page</code> instance with the necessary <code>Page</code> metadata as well as links to let the clients easily navigate the pages. The conversion of a <code>Page</code> to a <code>PagedResources</code> is done by an implementation of the Spring HATEOAS <code>ResourceAssembler</code> interface, called the <code>PagedResourcesAssembler</code>. The following example shows how to use a <code>PagedResourcesAssembler</code> as a controller method argument:</p>
</div>
<div class="exampleblock">
<div class="title">Example 49. Using a PagedResourcesAssembler as controller method argument</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Controller</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonController</span> </span>{

  <span class="hljs-meta">@Autowired</span> PersonRepository repository;

  <span class="hljs-meta">@RequestMapping</span>(value = <span class="hljs-string">"/persons"</span>, method = RequestMethod.GET)
  HttpEntity&lt;PagedResources&lt;Person&gt;&gt; persons(Pageable pageable,
    PagedResourcesAssembler assembler) {

    Page&lt;Person&gt; persons = repository.findAll(pageable);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseEntity&lt;&gt;(assembler.toResources(persons), HttpStatus.OK);
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Enabling the configuration, as shown in the preceding example, lets the <code>PagedResourcesAssembler</code> be used as a controller method argument. Calling <code>toResources(…)</code> on it has the following effects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The content of the <code>Page</code> becomes the content of the <code>PagedResources</code> instance.</p>
</li>
<li>
<p>The <code>PagedResources</code> object gets a <code>PageMetadata</code> instance attached, and it is populated with information from the <code>Page</code> and the underlying <code>PageRequest</code>.</p>
</li>
<li>
<p>The <code>PagedResources</code> may get <code>prev</code> and <code>next</code> links attached, depending on the page’s state. The links point to the URI to which the method maps. The pagination parameters added to the method match the setup of the <code>PageableHandlerMethodArgumentResolver</code> to make sure the links can be resolved later.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Assume we have 30 <code>Person</code> instances in the database. You can now trigger a request (<code>GET <a href="http://localhost:8080/persons" class="bare">http://localhost:8080/persons</a></code>) and see output similar to the following:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">{ <span class="hljs-string">"links"</span> : [ { <span class="hljs-string">"rel"</span> : <span class="hljs-string">"next"</span>,
                <span class="hljs-string">"href"</span> : <span class="hljs-string">"http://localhost:8080/persons?page=1&amp;size=20"</span> }
  ],
  <span class="hljs-string">"content"</span> : [
     … <span class="hljs-comment">// 20 Person instances rendered here</span>
  ],
  <span class="hljs-string">"pageMetadata"</span> : {
    <span class="hljs-string">"size"</span> : <span class="hljs-number">20</span>,
    <span class="hljs-string">"totalElements"</span> : <span class="hljs-number">30</span>,
    <span class="hljs-string">"totalPages"</span> : <span class="hljs-number">2</span>,
    <span class="hljs-string">"number"</span> : <span class="hljs-number">0</span>
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The assembler produced the correct URI and also picked up the default configuration to resolve the parameters into a <code>Pageable</code> for an upcoming request. This means that, if you change that configuration, the links automatically adhere to the change. By default, the assembler points to the controller method it was invoked in, but you can customize that by passing a custom <code>Link</code> to be used as base to build the pagination links, which overloads the <code>PagedResourcesAssembler.toResource(…)</code> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="core.web.binding"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web.binding"></a>Web Databinding Support</h5>
<div class="paragraph">
<p>You can use Spring Data projections (described in <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#projections">Projections</a>) to bind incoming request payloads by using either <a href="https://goessner.net/articles/JsonPath/">JSONPath</a> expressions (requires <a href="https://github.com/json-path/JsonPath">Jayway JsonPath</a> or <a href="https://www.w3.org/TR/xpath-31/">XPath</a> expressions (requires <a href="https://xmlbeam.org/">XmlBeam</a>), as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 50. HTTP payload binding using JSONPath or XPath expressions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@ProjectedPayload</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserPayload</span> </span>{

  <span class="hljs-meta">@XBRead</span>(<span class="hljs-string">"//firstname"</span>)
  <span class="hljs-meta">@JsonPath</span>(<span class="hljs-string">"$..firstname"</span>)
  <span class="hljs-function">String <span class="hljs-title">getFirstname</span><span class="hljs-params">()</span></span>;

  <span class="hljs-meta">@XBRead</span>(<span class="hljs-string">"/lastname"</span>)
  <span class="hljs-meta">@JsonPath</span>({ <span class="hljs-string">"$.lastname"</span>, <span class="hljs-string">"$.user.lastname"</span> })
  <span class="hljs-function">String <span class="hljs-title">getLastname</span><span class="hljs-params">()</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can use the type shown in the preceding example as a Spring MVC handler method argument or by using <code>ParameterizedTypeReference</code> on one of methods of the <code>RestTemplate</code>.
The preceding method declarations would try to find <code>firstname</code> anywhere in the given document.
The <code>lastname</code> XML lookup is performed on the top-level of the incoming document.
The JSON variant of that tries a top-level <code>lastname</code> first but also tries <code>lastname</code> nested in a <code>user</code> sub-document if the former does not return a value.
That way, changes in the structure of the source document can be mitigated easily without having clients calling the exposed methods (usually a drawback of class-based payload binding).</p>
</div>
<div class="paragraph">
<p>Nested projections are supported as described in <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#projections">Projections</a>.
If the method returns a complex, non-interface type, a Jackson <code>ObjectMapper</code> is used to map the final value.</p>
</div>
<div class="paragraph">
<p>For Spring MVC, the necessary converters are registered automatically as soon as <code>@EnableSpringDataWebSupport</code> is active and the required dependencies are available on the classpath.
For usage with <code>RestTemplate</code>, register a <code>ProjectingJackson2HttpMessageConverter</code> (JSON) or <code>XmlBeamHttpMessageConverter</code> manually.</p>
</div>
<div class="paragraph">
<p>For more information, see the <a href="https://github.com/spring-projects/spring-data-examples/tree/master/web/projection">web projection example</a> in the canonical <a href="https://github.com/spring-projects/spring-data-examples">Spring Data Examples repository</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="core.web.type-safe"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.web.type-safe"></a>Querydsl Web Support</h5>
<div class="paragraph">
<p>For those stores that have <a href="http://www.querydsl.com/">QueryDSL</a> integration, you can derive queries from the attributes contained in a <code>Request</code> query string.</p>
</div>
<div class="paragraph">
<p>Consider the following query string:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">?firstname=Dave&amp;lastname=Matthews</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Given the <code>User</code> object from the previous examples, you can resolve a query string to the following value by using the <code>QuerydslPredicateArgumentResolver</code>, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">QUser.user.firstname.eq("Dave").and(QUser.user.lastname.eq("Matthews"))</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The feature is automatically enabled, along with <code>@EnableSpringDataWebSupport</code>, when Querydsl is found on the classpath.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Adding a <code>@QuerydslPredicate</code> to the method signature provides a ready-to-use <code>Predicate</code>, which you can run by using the <code>QuerydslPredicateExecutor</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Type information is typically resolved from the method’s return type. Since that information does not necessarily match the domain type, it might be a good idea to use the <code>root</code> attribute of <code>QuerydslPredicate</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The following example shows how to use <code>@QuerydslPredicate</code> in a method signature:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Controller</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>{

  <span class="hljs-meta">@Autowired</span> UserRepository repository;

  <span class="hljs-meta">@RequestMapping</span>(value = <span class="hljs-string">"/"</span>, method = RequestMethod.GET)
  <span class="hljs-function">String <span class="hljs-title">index</span><span class="hljs-params">(Model model, @QuerydslPredicate(root = User.class)</span> Predicate predicate,    </span><i class="conum" data-value="1"></i><b><span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">1</span>)</span></span></b><span class="hljs-function">
          Pageable pageable, @RequestParam MultiValueMap&lt;String, String&gt; parameters) </span>{

    model.addAttribute(<span class="hljs-string">"users"</span>, repository.findAll(predicate, pageable));

    <span class="hljs-keyword">return</span> <span class="hljs-string">"index"</span>;
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Resolve query string arguments to matching <code>Predicate</code> for <code>User</code>.</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="paragraph">
<p>The default binding is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Object</code> on simple properties as <code>eq</code>.</p>
</li>
<li>
<p><code>Object</code> on collection like properties as <code>contains</code>.</p>
</li>
<li>
<p><code>Collection</code> on simple properties as <code>in</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can customize those bindings through the <code>bindings</code> attribute of <code>@QuerydslPredicate</code> or by making use of Java 8 <code>default methods</code> and adding the <code>QuerydslBinderCustomizer</code> method to the repository interface, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">String</span>&gt;,
                                 <span class="hljs-title">QuerydslPredicateExecutor</span>&lt;<span class="hljs-title">User</span>&gt;,                </span><i class="conum" data-value="1"></i><b><span class="hljs-class">(1)</span></b><span class="hljs-class">
                                 <span class="hljs-title">QuerydslBinderCustomizer</span>&lt;<span class="hljs-title">QUser</span>&gt; </span>{               <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title">customize</span><span class="hljs-params">(QuerydslBindings bindings, QUser user)</span> </span>{

    bindings.bind(user.username).first((path, value) -&gt; path.contains(value))    <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>
    bindings.bind(String.class)
      .first((StringPath path, String value) -&gt; path.containsIgnoreCase(value)); <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b>
    bindings.excluding(user.password);                                           <i class="conum" data-value="5"></i><b>(<span class="hljs-number">5</span>)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>QuerydslPredicateExecutor</code> provides access to specific finder methods for <code>Predicate</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>QuerydslBinderCustomizer</code> defined on the repository interface is automatically picked up and shortcuts <code>@QuerydslPredicate(bindings=…​)</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the binding for the <code>username</code> property to be a simple <code>contains</code> binding.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Define the default binding for <code>String</code> properties to be a case-insensitive <code>contains</code> match.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Exclude the <code>password</code> property from <code>Predicate</code> resolution.</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="core.repository-populators"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.repository-populators"></a>4.8.3. Repository Populators</h4>
<div class="paragraph">
<p>If you work with the Spring JDBC module, you are probably familiar with the support for populating a <code>DataSource</code> with SQL scripts. A similar abstraction is available on the repositories level, although it does not use SQL as the data definition language because it must be store-independent. Thus, the populators support XML (through Spring’s OXM abstraction) and JSON (through Jackson) to define data with which to populate the repositories.</p>
</div>
<div class="paragraph">
<p>Assume you have a file called <code>data.json</code> with the following content:</p>
</div>
<div class="exampleblock">
<div class="title">Example 51. Data defined in JSON</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">[ { <span class="hljs-string">"_class"</span> : <span class="hljs-string">"com.acme.Person"</span>,
 <span class="hljs-string">"firstname"</span> : <span class="hljs-string">"Dave"</span>,
  <span class="hljs-string">"lastname"</span> : <span class="hljs-string">"Matthews"</span> },
  { <span class="hljs-string">"_class"</span> : <span class="hljs-string">"com.acme.Person"</span>,
 <span class="hljs-string">"firstname"</span> : <span class="hljs-string">"Carter"</span>,
  <span class="hljs-string">"lastname"</span> : <span class="hljs-string">"Beauford"</span> } ]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can populate your repositories by using the populator elements of the repository namespace provided in Spring Data Commons. To populate the preceding data to your <code>PersonRepository</code>, declare a populator similar to the following:</p>
</div>
<div class="exampleblock">
<div class="title">Example 52. Declaring a Jackson repository populator</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hljs-attr">xmlns:repository</span>=<span class="hljs-string">"http://www.springframework.org/schema/data/repository"</span>
  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans
    https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/data/repository
    https://www.springframework.org/schema/data/repository/spring-repository.xsd"</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">repository:jackson2-populator</span> <span class="hljs-attr">locations</span>=<span class="hljs-string">"classpath:data.json"</span> /&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The preceding declaration causes the <code>data.json</code> file to
be read and deserialized by a Jackson <code>ObjectMapper</code>.</p>
</div>
<div class="paragraph">
<p>The type to which the JSON object is unmarshalled is determined by inspecting the <code>_class</code> attribute of the JSON document. The infrastructure eventually selects the appropriate repository to handle the object that was deserialized.</p>
</div>
<div class="paragraph">
<p>To instead use XML to define the data the repositories should be populated with, you can use the <code>unmarshaller-populator</code> element. You configure it to use one of the XML marshaller options available in Spring OXM. See the <a href="https://docs.spring.io/spring/docs/5.3.0/spring-framework-reference/data-access.html#oxm">Spring reference documentation</a> for details. The following example shows how to unmarshall a repository populator with JAXB:</p>
</div>
<div class="exampleblock">
<div class="title">Example 53. Declaring an unmarshalling repository populator (using JAXB)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hljs-attr">xmlns:repository</span>=<span class="hljs-string">"http://www.springframework.org/schema/data/repository"</span>
  <span class="hljs-attr">xmlns:oxm</span>=<span class="hljs-string">"http://www.springframework.org/schema/oxm"</span>
  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans
    https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/data/repository
    https://www.springframework.org/schema/data/repository/spring-repository.xsd
    http://www.springframework.org/schema/oxm
    https://www.springframework.org/schema/oxm/spring-oxm.xsd"</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">repository:unmarshaller-populator</span> <span class="hljs-attr">locations</span>=<span class="hljs-string">"classpath:data.json"</span>
    <span class="hljs-attr">unmarshaller-ref</span>=<span class="hljs-string">"unmarshaller"</span> /&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">oxm:jaxb2-marshaller</span> <span class="hljs-attr">contextPath</span>=<span class="hljs-string">"com.acme"</span> /&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reference"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#reference"></a>5. Reference Documentation</h2>
<div class="sectionbody">
</div>
</div>
<div class="sect1">
<h2 id="jpa.repositories"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.repositories"></a>6. JPA Repositories</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter points out the specialties for repository support for JPA. This builds on the core repository support explained in “<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories">Working with Spring Data Repositories</a>”. Make sure you have a sound understanding of the basic concepts explained there.</p>
</div>
<div class="sect2">
<h3 id="jpa.introduction"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.introduction"></a>6.1. Introduction</h3>
<div class="paragraph">
<p>This section describes the basics of configuring Spring Data JPA through either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>“<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.namespace">Spring Namespace</a>” (XML configuration)</p>
</li>
<li>
<p>“<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.java-config">Annotation-based Configuration</a>” (Java configuration)</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="jpa.namespace"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.namespace"></a>6.1.1. Spring Namespace</h4>
<div class="paragraph">
<p>The JPA module of Spring Data contains a custom namespace that allows defining repository beans. It also contains certain features and element attributes that are special to JPA. Generally, the JPA repositories can be set up by using the <code>repositories</code> element, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 54. Setting up JPA repositories by using the namespace</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hljs-attr">xmlns:jpa</span>=<span class="hljs-string">"http://www.springframework.org/schema/data/jpa"</span>
  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans
    https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/data/jpa
    https://www.springframework.org/schema/data/jpa/spring-jpa.xsd"</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">jpa:repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repositories"</span> /&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Using the <code>repositories</code> element looks up Spring Data repositories as described in “<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances">Creating Repository Instances</a>”. Beyond that, it activates persistence exception translation for all beans annotated with <code>@Repository</code>, to let exceptions being thrown by the JPA persistence providers be converted into Spring’s <code>DataAccessException</code> hierarchy.</p>
</div>
<div class="sect4">
<h5>Custom Namespace Attributes</h5>
<div class="paragraph">
<p>Beyond the default attributes of the <code>repositories</code> element, the JPA namespace offers additional attributes to let you gain more detailed control over the setup of the repositories:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 2. Custom JPA-specific attributes of the <code>repositories</code> element</caption>
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entity-manager-factory-ref</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Explicitly wire the <code>EntityManagerFactory</code> to be used with the repositories being detected by the <code>repositories</code> element. Usually used if multiple <code>EntityManagerFactory</code> beans are used within the application. If not configured, Spring Data automatically looks up the <code>EntityManagerFactory</code> bean with the name <code>entityManagerFactory</code> in the <code>ApplicationContext</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>transaction-manager-ref</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Explicitly wire the <code>PlatformTransactionManager</code> to be used with the repositories being detected by the <code>repositories</code> element. Usually only necessary if multiple transaction managers or <code>EntityManagerFactory</code> beans have been configured. Default to a single defined <code>PlatformTransactionManager</code> inside the current <code>ApplicationContext</code>.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring Data JPA requires a <code>PlatformTransactionManager</code> bean named <code>transactionManager</code> to be present if no explicit <code>transaction-manager-ref</code> is defined.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jpa.java-config"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.java-config"></a>6.1.2. Annotation-based Configuration</h4>
<div class="paragraph">
<p>The Spring Data JPA repositories support can be activated not only through an XML namespace but also by using an annotation through JavaConfig, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 55. Spring Data JPA repositories using JavaConfig</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableJpaRepositories</span>
<span class="hljs-meta">@EnableTransactionManagement</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationConfig</span> </span>{

  <span class="hljs-meta">@Bean</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> DataSource <span class="hljs-title">dataSource</span><span class="hljs-params">()</span> </span>{

    EmbeddedDatabaseBuilder builder = <span class="hljs-keyword">new</span> EmbeddedDatabaseBuilder();
    <span class="hljs-keyword">return</span> builder.setType(EmbeddedDatabaseType.HSQL).build();
  }

  <span class="hljs-meta">@Bean</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> LocalContainerEntityManagerFactoryBean <span class="hljs-title">entityManagerFactory</span><span class="hljs-params">()</span> </span>{

    HibernateJpaVendorAdapter vendorAdapter = <span class="hljs-keyword">new</span> HibernateJpaVendorAdapter();
    vendorAdapter.setGenerateDdl(<span class="hljs-keyword">true</span>);

    LocalContainerEntityManagerFactoryBean factory = <span class="hljs-keyword">new</span> LocalContainerEntityManagerFactoryBean();
    factory.setJpaVendorAdapter(vendorAdapter);
    factory.setPackagesToScan(<span class="hljs-string">"com.acme.domain"</span>);
    factory.setDataSource(dataSource());
    <span class="hljs-keyword">return</span> factory;
  }

  <span class="hljs-meta">@Bean</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> PlatformTransactionManager <span class="hljs-title">transactionManager</span><span class="hljs-params">(EntityManagerFactory entityManagerFactory)</span> </span>{

    JpaTransactionManager txManager = <span class="hljs-keyword">new</span> JpaTransactionManager();
    txManager.setEntityManagerFactory(entityManagerFactory);
    <span class="hljs-keyword">return</span> txManager;
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You must create <code>LocalContainerEntityManagerFactoryBean</code> and not <code>EntityManagerFactory</code> directly, since the former also participates in exception translation mechanisms in addition to creating <code>EntityManagerFactory</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The preceding configuration class sets up an embedded HSQL database by using the <code>EmbeddedDatabaseBuilder</code> API of <code>spring-jdbc</code>. Spring Data then sets up an <code>EntityManagerFactory</code> and uses Hibernate as the sample persistence provider. The last infrastructure component declared here is the <code>JpaTransactionManager</code>. Finally, the example activates Spring Data JPA repositories by using the <code>@EnableJpaRepositories</code> annotation, which essentially carries the same attributes as the XML namespace. If no base package is configured, it uses the one in which the configuration class resides.</p>
</div>
</div>
<div class="sect3">
<h4 id="jpa.bootstrap-mode"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.bootstrap-mode"></a>6.1.3. Bootstrap Mode</h4>
<div class="paragraph">
<p>By default, Spring Data JPA repositories are default Spring beans.
They are singleton scoped and eagerly initialized.
During startup, they already interact with the JPA <code>EntityManager</code> for verification and metadata analysis purposes.
Spring Framework supports the initialization of the JPA <code>EntityManagerFactory</code> in a background thread because that process usually takes up a significant amount of startup time in a Spring application.
To make use of that background initialization effectively, we need to make sure that JPA repositories are initialized as late as possible.</p>
</div>
<div class="paragraph">
<p>As of Spring Data JPA 2.1 you can now configure a <code>BootstrapMode</code> (either via the <code>@EnableJpaRepositories</code> annotation or the XML namespace) that takes the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DEFAULT</code> (default) — Repositories are instantiated eagerly unless explicitly annotated with <code>@Lazy</code>.
The lazification only has effect if no client bean needs an instance of the repository as that will require the initialization of the repository bean.</p>
</li>
<li>
<p><code>LAZY</code> — Implicitly declares all repository beans lazy and also causes lazy initialization proxies to be created to be injected into client beans.
That means, that repositories will not get instantiated if the client bean is simply storing the instance in a field and not making use of the repository during initialization.
Repository instances will be initialized and verified upon first interaction with the repository.</p>
</li>
<li>
<p><code>DEFERRED</code> — Fundamentally the same mode of operation as <code>LAZY</code>, but triggering repository initialization in response to an <code>ContextRefreshedEvent</code> so that repositories are verified before the application has completely started.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5>Recommendations</h5>
<div class="paragraph">
<p>If you’re not using asynchronous JPA bootstrap stick with the default bootstrap mode.</p>
</div>
<div class="paragraph">
<p>In case you bootstrap JPA asynchronously, <code>DEFERRED</code> is a reasonable default as it will make sure the Spring Data JPA bootstrap only waits for the <code>EntityManagerFactory</code> setup if that itself takes longer than initializing all other application components.
Still, it makes sure that repositories are properly initialized and validated before the application signals it’s up.</p>
</div>
<div class="paragraph">
<p><code>LAZY</code> is a decent choice for testing scenarios and local development.
Once you are pretty sure that repositories can properly bootstrap, or in cases where you are testing other parts of the application, running verification for all repositories might unnecessarily increase the startup time.
The same applies to local development in which you only access parts of the application that might need to have a single repository initialized.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jpa.entity-persistence"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.entity-persistence"></a>6.2. Persisting Entities</h3>
<div class="paragraph">
<p>This section describes how to persist (save) entities with Spring Data JPA.</p>
</div>
<div class="sect3">
<h4 id="jpa.entity-persistence.saving-entites"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.entity-persistence.saving-entites"></a>6.2.1. Saving Entities</h4>
<div class="paragraph">
<p>Saving an entity can be performed with the <code>CrudRepository.save(…)</code> method. It persists or merges the given entity by using the underlying JPA <code>EntityManager</code>. If the entity has not yet been persisted, Spring Data JPA saves the entity with a call to the <code>entityManager.persist(…)</code> method. Otherwise, it calls the <code>entityManager.merge(…)</code> method.</p>
</div>
<div class="sect4">
<h5 id="jpa.entity-persistence.saving-entites.strategies"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.entity-persistence.saving-entites.strategies"></a>Entity State-detection Strategies</h5>
<div class="paragraph">
<p>Spring Data JPA offers the following strategies to detect whether an entity is new or not:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Version-Property and Id-Property inspection (<strong>default</strong>):
By default Spring Data JPA inspects first if there is a Version-property of non-primitive type.
If there is, the entity is considered new if the value of that property is <code>null</code>.
Without such a Version-property Spring Data JPA inspects the identifier property of the given entity.
If the identifier property is <code>null</code>, then the entity is assumed to be new.
Otherwise, it is assumed to be not new.</p>
</li>
<li>
<p>Implementing <code>Persistable</code>: If an entity implements <code>Persistable</code>, Spring Data JPA delegates the new detection to the <code>isNew(…)</code> method of the entity. See the <a href="https://docs.spring.io/spring-data/data-commons/docs/current/api/index.html?org/springframework/data/domain/Persistable.html">JavaDoc</a> for details.</p>
</li>
<li>
<p>Implementing <code>EntityInformation</code>: You can customize the <code>EntityInformation</code> abstraction used in the <code>SimpleJpaRepository</code> implementation by creating a subclass of <code>JpaRepositoryFactory</code> and overriding the <code>getEntityInformation(…)</code> method accordingly. You then have to register the custom implementation of <code>JpaRepositoryFactory</code> as a Spring bean. Note that this should be rarely necessary. See the <a href="https://docs.spring.io/spring-data/data-jpa/docs/current/api/index.html?org/springframework/data/jpa/repository/support/JpaRepositoryFactory.html">JavaDoc</a> for details.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Option 1 is not an option for entities that use manually assigned identifiers as with those the identifier will always be non-<code>null</code>.
A common pattern in that scenario is to use a common base class with a transient flag defaulting to indicate a new instance and using JPA lifecycle callbacks to flip that flag on persistence operations:</p>
</div>
<div class="exampleblock">
<div class="title">Example 56. A base class for entities with manually assigned identifiers</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@MappedSuperclass</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AbstractEntity</span>&lt;<span class="hljs-title">ID</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">Persistable</span>&lt;<span class="hljs-title">ID</span>&gt; </span>{

  <span class="hljs-meta">@Transient</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> isNew = <span class="hljs-keyword">true</span>; <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isNew</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> isNew; <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
  }

  <span class="hljs-meta">@PrePersist</span> <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>
  <span class="hljs-meta">@PostLoad</span>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">markNotNew</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>.isNew = <span class="hljs-keyword">false</span>;
  }

  <span class="hljs-comment">// More code…</span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declare a flag to hold the new state. Transient so that it’s not persisted to the database.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Return the flag in the implementation of <code>Persistable.isNew()</code> so that Spring Data repositories know whether to call <code>EntityManager.persist()</code> or <code>….merge()</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Declare a method using JPA entity callbacks so that the flag is switched to indicate an existing entity after a repository call to <code>save(…)</code> or an instance creation by the persistence provider.</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jpa.query-methods"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods"></a>6.3. Query Methods</h3>
<div class="paragraph">
<p>This section describes the various ways to create a query with Spring Data JPA.</p>
</div>
<div class="sect3">
<h4 id="jpa.sample-app.finders.strategies"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.sample-app.finders.strategies"></a>6.3.1. Query Lookup Strategies</h4>
<div class="paragraph">
<p>The JPA module supports defining a query manually as a String or having it being derived from the method name.</p>
</div>
<div class="paragraph">
<p>Derived queries with the predicates <code>IsStartingWith</code>, <code>StartingWith</code>, <code>StartsWith</code>, <code>IsEndingWith</code>, <code>EndingWith</code>, <code>EndsWith</code>,
<code>IsNotContaining</code>, <code>NotContaining</code>, <code>NotContains</code>, <code>IsContaining</code>, <code>Containing</code>, <code>Contains</code> the respective arguments for these queries will get sanitized.
This means if the arguments actually contain characters recognized by <code>LIKE</code> as wildcards these will get escaped so they match only as literals.
The escape character used can be configured by setting the <code>escapeCharacter</code> of the <code>@EnableJpaRepositories</code> annotation.
Compare with <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query.spel-expressions">Using SpEL Expressions</a>.</p>
</div>
<div class="sect4">
<h5>Declared Queries</h5>
<div class="paragraph">
<p>Although getting a query derived from the method name is quite convenient, one might face the situation in which either the method name parser does not support the keyword one wants to use or the method name would get unnecessarily ugly. So you can either use JPA named queries through a naming convention (see <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.named-queries">Using JPA Named Queries</a> for more information) or rather annotate your query method with <code>@Query</code> (see <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.at-query">Using <code>@Query</code></a> for details).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jpa.query-methods.query-creation"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.query-creation"></a>6.3.2. Query Creation</h4>
<div class="paragraph">
<p>Generally, the query creation mechanism for JPA works as described in “<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods">Query Methods</a>”. The following example shows what a JPA query method translates into:</p>
</div>
<div class="exampleblock">
<div class="title">Example 57. Query creation from method names</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>public interface UserRepository extends Repository&lt;User, Long&gt; {

  List&lt;User&gt; findByEmailAddressAndLastname(String emailAddress, String lastname);
}</pre>
</div>
</div>
<div class="paragraph">
<p>We create a query using the JPA criteria API from this, but, essentially, this translates into the following query: <code>select u from User u where u.emailAddress = ?1 and u.lastname = ?2</code>. Spring Data JPA does a property check and traverses nested properties, as described in “<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.query-property-expressions">Property Expressions</a>”.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The following table describes the keywords supported for JPA and what a method containing that keyword translates to:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 3. Supported keywords inside method names</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Sample</th>
<th class="tableblock halign-left valign-top">JPQL snippet</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Distinct</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findDistinctByLastnameAndFirstname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>select distinct …​ where x.lastname = ?1 and x.firstname = ?2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>And</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByLastnameAndFirstname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.lastname = ?1 and x.firstname = ?2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Or</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByLastnameOrFirstname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.lastname = ?1 or x.firstname = ?2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Is</code>, <code>Equals</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstname</code>,<code>findByFirstnameIs</code>,<code>findByFirstnameEquals</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.firstname = ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Between</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByStartDateBetween</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.startDate between ?1 and ?2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeLessThan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age &lt; ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThanEqual</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeLessThanEqual</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age &lt;= ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeGreaterThan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age &gt; ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThanEqual</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeGreaterThanEqual</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age &gt;= ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>After</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByStartDateAfter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.startDate &gt; ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Before</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByStartDateBefore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.startDate &lt; ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsNull</code>, <code>Null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAge(Is)Null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age is null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsNotNull</code>, <code>NotNull</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAge(Is)NotNull</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age not null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Like</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameLike</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.firstname like ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotLike</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameNotLike</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.firstname not like ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StartingWith</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameStartingWith</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.firstname like ?1</code> (parameter bound with appended <code>%</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EndingWith</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameEndingWith</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.firstname like ?1</code> (parameter bound with prepended <code>%</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Containing</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameContaining</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.firstname like ?1</code> (parameter bound wrapped in <code>%</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OrderBy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeOrderByLastnameDesc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age = ?1 order by x.lastname desc</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Not</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByLastnameNot</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.lastname &lt;&gt; ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>In</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeIn(Collection&lt;Age&gt; ages)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age in ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotIn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeNotIn(Collection&lt;Age&gt; ages)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age not in ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>True</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByActiveTrue()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.active = true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>False</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByActiveFalse()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.active = false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IgnoreCase</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameIgnoreCase</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where UPPER(x.firstname) = UPPER(?1)</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>In</code> and <code>NotIn</code> also take any subclass of <code>Collection</code> as a parameter as well as arrays or varargs. For other syntactical versions of the same logical operator, check “<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repository-query-keywords">Repository query keywords</a>”.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="jpa.query-methods.named-queries"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.named-queries"></a>6.3.3. Using JPA Named Queries</h4>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The examples use the <code>&lt;named-query /&gt;</code> element and <code>@NamedQuery</code> annotation. The queries for these configuration elements have to be defined in the JPA query language. Of course, you can use <code>&lt;named-native-query /&gt;</code> or <code>@NamedNativeQuery</code> too. These elements let you define the query in native SQL by losing the database platform independence.
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5>XML Named Query Definition</h5>
<div class="paragraph">
<p>To use XML configuration, add the necessary <code>&lt;named-query /&gt;</code> element to the <code>orm.xml</code> JPA configuration file located in the <code>META-INF</code> folder of your classpath. Automatic invocation of named queries is enabled by using some defined naming convention. For more details, see below.</p>
</div>
<div class="exampleblock">
<div class="title">Example 58. XML named query configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">named-query</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"User.findByLastname"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">query</span>&gt;</span>select u from User u where u.lastname = ?1<span class="hljs-tag">&lt;/<span class="hljs-name">query</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">named-query</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The query has a special name that is used to resolve it at runtime.</p>
</div>
</div>
<div class="sect4">
<h5>Annotation-based Configuration</h5>
<div class="paragraph">
<p>Annotation-based configuration has the advantage of not needing another configuration file to be edited, lowering maintenance effort. You pay for that benefit by the need to recompile your domain class for every new query declaration.</p>
</div>
<div class="exampleblock">
<div class="title">Example 59. Annotation-based named query configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@NamedQuery</span>(name = <span class="hljs-string">"User.findByEmailAddress"</span>,
  query = <span class="hljs-string">"select u from User u where u.emailAddress = ?1"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{

}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5>Declaring Interfaces</h5>
<div class="paragraph">
<p>To allow these named queries, specify the <code>UserRepository</code> as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 60. Query method declaration in UserRepository</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{

  <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname)</span></span>;

  <span class="hljs-function">User <span class="hljs-title">findByEmailAddress</span><span class="hljs-params">(String emailAddress)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Spring Data tries to resolve a call to these methods to a named query, starting with the simple name of the configured domain class, followed by the method name separated by a dot.
So the preceding example would use the named queries defined earlier instead of trying to create a query from the method name.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jpa.query-methods.at-query"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.at-query"></a>6.3.4. Using <code>@Query</code></h4>
<div class="paragraph">
<p>Using named queries to declare queries for entities is a valid approach and works fine for a small number of queries. As the queries themselves are tied to the Java method that runs them, you can actually bind them directly by using the Spring Data JPA <code>@Query</code> annotation rather than annotating them to the domain class. This frees the domain class from persistence specific information and co-locates the query to the repository interface.</p>
</div>
<div class="paragraph">
<p>Queries annotated to the query method take precedence over queries defined using <code>@NamedQuery</code> or named queries declared in <code>orm.xml</code>.</p>
</div>
<div class="paragraph">
<p>The following example shows a query created with the <code>@Query</code> annotation:</p>
</div>
<div class="exampleblock">
<div class="title">Example 61. Declare query at the query method using <code>@Query</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{

  <span class="hljs-meta">@Query</span>(<span class="hljs-string">"select u from User u where u.emailAddress = ?1"</span>)
  <span class="hljs-function">User <span class="hljs-title">findByEmailAddress</span><span class="hljs-params">(String emailAddress)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5>Using Advanced <code>LIKE</code> Expressions</h5>
<div class="paragraph">
<p>The query running mechanism for manually defined queries created with <code>@Query</code> allows the definition of advanced <code>LIKE</code> expressions inside the query definition, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 62. Advanced <code>like</code> expressions in @Query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{

  <span class="hljs-meta">@Query</span>(<span class="hljs-string">"select u from User u where u.firstname like %?1"</span>)
  <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByFirstnameEndsWith</span><span class="hljs-params">(String firstname)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, the <code>LIKE</code> delimiter character (<code>%</code>) is recognized, and the query is transformed into a valid JPQL query (removing the <code>%</code>). Upon running the query, the parameter passed to the method call gets augmented with the previously recognized <code>LIKE</code> pattern.</p>
</div>
</div>
<div class="sect4">
<h5>Native Queries</h5>
<div class="paragraph">
<p>The <code>@Query</code> annotation allows for running native queries by setting the <code>nativeQuery</code> flag to true, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 63. Declare a native query at the query method using @Query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{

  <span class="hljs-meta">@Query</span>(value = <span class="hljs-string">"SELECT * FROM USERS WHERE EMAIL_ADDRESS = ?1"</span>, nativeQuery = <span class="hljs-keyword">true</span>)
  <span class="hljs-function">User <span class="hljs-title">findByEmailAddress</span><span class="hljs-params">(String emailAddress)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring Data JPA does not currently support dynamic sorting for native queries, because it would have to manipulate the actual query declared, which it cannot do reliably for native SQL. You can, however, use native queries for pagination by specifying the count query yourself, as shown in the following example:
</td>
</tr>
</tbody></table>
</div>
<div class="exampleblock">
<div class="title">Example 64. Declare native count queries for pagination at the query method by using <code>@Query</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{

  <span class="hljs-meta">@Query</span>(value = <span class="hljs-string">"SELECT * FROM USERS WHERE LASTNAME = ?1"</span>,
    countQuery = <span class="hljs-string">"SELECT count(*) FROM USERS WHERE LASTNAME = ?1"</span>,
    nativeQuery = <span class="hljs-keyword">true</span>)
  <span class="hljs-function">Page&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A similar approach also works with named native queries, by adding the <code>.count</code> suffix to a copy of your query. You probably need to register a result set mapping for your count query, though.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jpa.query-methods.sorting"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.sorting"></a>6.3.5. Using Sort</h4>
<div class="paragraph">
<p>Sorting can be done by either providing a <code>PageRequest</code> or by using <code>Sort</code> directly. The properties actually used within the <code>Order</code> instances of <code>Sort</code> need to match your domain model, which means they need to resolve to either a property or an alias used within the query. The JPQL defines this as a state field path expression.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using any non-referenceable path expression leads to an <code>Exception</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>However, using <code>Sort</code> together with <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.at-query"><code>@Query</code></a> lets you sneak in non-path-checked <code>Order</code> instances containing functions within the <code>ORDER BY</code> clause. This is possible because the <code>Order</code> is appended to the given query string. By default, Spring Data JPA rejects any <code>Order</code> instance containing function calls, but you can use <code>JpaSort.unsafe</code> to add potentially unsafe ordering.</p>
</div>
<div class="paragraph">
<p>The following example uses <code>Sort</code> and <code>JpaSort</code>, including an unsafe option on <code>JpaSort</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 65. Using <code>Sort</code> and <code>JpaSort</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{

  <span class="hljs-meta">@Query</span>(<span class="hljs-string">"select u from User u where u.lastname like ?1%"</span>)
  <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByAndSort</span><span class="hljs-params">(String lastname, Sort sort)</span></span>;

  <span class="hljs-meta">@Query</span>(<span class="hljs-string">"select u.id, LENGTH(u.firstname) as fn_len from User u where u.lastname like ?1%"</span>)
  List&lt;Object[]&gt; findByAsArrayAndSort(String lastname, Sort sort);
}

repo.findByAndSort(<span class="hljs-string">"lannister"</span>, Sort.by(<span class="hljs-string">"firstname"</span>));                <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
repo.findByAndSort(<span class="hljs-string">"stark"</span>, Sort.by(<span class="hljs-string">"LENGTH(firstname)"</span>));            <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
repo.findByAndSort(<span class="hljs-string">"targaryen"</span>, JpaSort.unsafe(<span class="hljs-string">"LENGTH(firstname)"</span>)); <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>
repo.findByAsArrayAndSort(<span class="hljs-string">"bolton"</span>, Sort.by(<span class="hljs-string">"fn_len"</span>));               <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Valid <code>Sort</code> expression pointing to property in domain model.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Invalid <code>Sort</code> containing function call. Throws Exception.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Valid <code>Sort</code> containing explicitly <em>unsafe</em> <code>Order</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Valid <code>Sort</code> expression pointing to aliased function.</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jpa.named-parameters"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.named-parameters"></a>6.3.6. Using Named Parameters</h4>
<div class="paragraph">
<p>By default, Spring Data JPA uses position-based parameter binding, as described in all the preceding examples. This makes query methods a little error-prone when refactoring regarding the parameter position. To solve this issue, you can use <code>@Param</code> annotation to give a method parameter a concrete name and bind the name in the query, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 66. Using named parameters</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{

  <span class="hljs-meta">@Query</span>(<span class="hljs-string">"select u from User u where u.firstname = :firstname or u.lastname = :lastname"</span>)
  <span class="hljs-function">User <span class="hljs-title">findByLastnameOrFirstname</span><span class="hljs-params">(@Param(<span class="hljs-string">"lastname"</span>)</span> String lastname,
                                 @<span class="hljs-title">Param</span><span class="hljs-params">(<span class="hljs-string">"firstname"</span>)</span> String firstname)</span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The method parameters are switched according to their order in the defined query.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As of version 4, Spring fully supports Java 8’s parameter name discovery based on the <code>-parameters</code> compiler flag. By using this flag in your build as an alternative to debug information, you can omit the <code>@Param</code> annotation for named parameters.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="jpa.query.spel-expressions"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query.spel-expressions"></a>6.3.7. Using SpEL Expressions</h4>
<div class="paragraph">
<p>As of Spring Data JPA release 1.4, we support the usage of restricted SpEL template expressions in manually defined queries that are defined with <code>@Query</code>. Upon the query being run, these expressions are evaluated against a predefined set of variables. Spring Data JPA supports a variable called <code>entityName</code>. Its usage is <code>select x from #{#entityName} x</code>. It inserts the <code>entityName</code> of the domain type associated with the given repository. The <code>entityName</code> is resolved as follows: If the domain type has set the name property on the <code>@Entity</code> annotation, it is used. Otherwise, the simple class-name of the domain type is used.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates one use case for the <code>#{#entityName}</code> expression in a query string where you want to define a repository interface with a query method and a manually defined query:</p>
</div>
<div class="exampleblock">
<div class="title">Example 67. Using SpEL expressions in repository query methods - entityName</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{

  <span class="hljs-meta">@Id</span>
  <span class="hljs-meta">@GeneratedValue</span>
  Long id;

  String lastname;
}

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>,<span class="hljs-title">Long</span>&gt; </span>{

  <span class="hljs-meta">@Query</span>(<span class="hljs-string">"select u from #{#entityName} u where u.lastname = ?1"</span>)
  <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To avoid stating the actual entity name in the query string of a <code>@Query</code> annotation, you can use the <code>#{#entityName}</code> variable.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>entityName</code> can be customized by using the <code>@Entity</code> annotation. Customizations in <code>orm.xml</code> are not supported for the SpEL expressions.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Of course, you could have just used <code>User</code> in the query declaration directly, but that would require you to change the query as well. The reference to <code>#entityName</code> picks up potential future remappings of the <code>User</code> class to a different entity name (for example, by using <code>@Entity(name = "MyUser")</code>.</p>
</div>
<div class="paragraph">
<p>Another use case for the <code>#{#entityName}</code> expression in a query string is if you want to define a generic repository interface with specialized repository interfaces for a concrete domain type. To not repeat the definition of custom query methods on the concrete interfaces, you can use the entity name expression in the query string of the <code>@Query</code> annotation in the generic repository interface, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 68. Using SpEL expressions in repository query methods - entityName with inheritance</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@MappedSuperclass</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AbstractMappedType</span> </span>{
  …
  String attribute
}

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConcreteType</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractMappedType</span> </span>{ … }

<span class="hljs-meta">@NoRepositoryBean</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MappedTypeRepository</span>&lt;<span class="hljs-title">T</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractMappedType</span>&gt;
  <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">Long</span>&gt; </span>{

  <span class="hljs-meta">@Query</span>(<span class="hljs-string">"select t from #{#entityName} t where t.attribute = ?1"</span>)
  <span class="hljs-function">List&lt;T&gt; <span class="hljs-title">findAllByAttribute</span><span class="hljs-params">(String attribute)</span></span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ConcreteRepository</span>
  <span class="hljs-keyword">extends</span> <span class="hljs-title">MappedTypeRepository</span>&lt;<span class="hljs-title">ConcreteType</span>&gt; </span>{ … }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, the <code>MappedTypeRepository</code> interface is the common parent interface for a few domain types extending <code>AbstractMappedType</code>. It also defines the generic <code>findAllByAttribute(…)</code> method, which can be used on instances of the specialized repository interfaces. If you now invoke <code>findByAllAttribute(…)</code> on <code>ConcreteRepository</code>, the query becomes <code>select t from ConcreteType t where t.attribute = ?1</code>.</p>
</div>
<div class="paragraph">
<p>SpEL expressions to manipulate arguments may also be used to manipulate method arguments.
In these SpEL expressions the entity name is not available, but the arguments are.
They can be accessed by name or index as demonstrated in the following example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 69. Using SpEL expressions in repository query methods - accessing arguments.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Query</span>(<span class="hljs-string">"select u from User u where u.firstname = ?1 and u.firstname=?#{[0]} and u.emailAddress = ?#{principal.emailAddress}"</span>)
<span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByFirstnameAndCurrentUserWithCustomQuery</span><span class="hljs-params">(String firstname)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For <code>like</code>-conditions one often wants to append <code>%</code> to the beginning or the end of a String valued parameter.
This can be done by appending or prefixing a bind parameter marker or a SpEL expression with <code>%</code>.
Again the following example demonstrates this.</p>
</div>
<div class="exampleblock">
<div class="title">Example 70. Using SpEL expressions in repository query methods - wildcard shortcut.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Query</span>(<span class="hljs-string">"select u from User u where u.lastname like %:#{[0]}% and u.lastname like %:lastname%"</span>)
<span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByLastnameWithSpelExpression</span><span class="hljs-params">(@Param(<span class="hljs-string">"lastname"</span>)</span> String lastname)</span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When using <code>like</code>-conditions with values that are coming from a not secure source the values should be sanitized so they can’t contain any wildcards and thereby allow attackers to select more data than they should be able to.
For this purpose the <code>escape(String)</code> method is made available in the SpEL context.
It prefixes all instances of <code>_</code> and <code>%</code> in the first argument with the single character from the second argument.
In combination with the <code>escape</code> clause of the <code>like</code> expression available in JPQL and standard SQL this allows easy cleaning of bind parameters.</p>
</div>
<div class="exampleblock">
<div class="title">Example 71. Using SpEL expressions in repository query methods - sanitizing input values.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Query</span>(<span class="hljs-string">"select u from User u where u.firstname like %?#{escape([0])}% escape ?#{escapeCharacter()}"</span>)
<span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findContainingEscaped</span><span class="hljs-params">(String namePart)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Given this method declaration in a repository interface <code>findContainingEscaped("Peter_")</code> will find <code>Peter_Parker</code> but not <code>Peter Parker</code>.
The escape character used can be configured by setting the <code>escapeCharacter</code> of the <code>@EnableJpaRepositories</code> annotation.
Note that the method <code>escape(String)</code> available in the SpEL context will only escape the SQL and JPQL standard wildcards <code>_</code> and <code>%</code>.
If the underlying database or the JPA implementation supports additional wildcards these will not get escaped.</p>
</div>
</div>
<div class="sect3">
<h4 id="jpa.modifying-queries"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.modifying-queries"></a>6.3.8. Modifying Queries</h4>
<div class="paragraph">
<p>All the previous sections describe how to declare queries to access a given entity or collection of entities.
You can add custom modifying behavior by using the custom method facilities described in “<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.custom-implementations">Custom Implementations for Spring Data Repositories</a>”.
As this approach is feasible for comprehensive custom functionality, you can modify queries that only need parameter binding by annotating the query method with <code>@Modifying</code>, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 72. Declaring manipulating queries</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Modifying</span>
<span class="hljs-meta">@Query</span>(<span class="hljs-string">"update User u set u.firstname = ?1 where u.lastname = ?2"</span>)
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">setFixedFirstnameFor</span><span class="hljs-params">(String firstname, String lastname)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Doing so triggers the query annotated to the method as an updating query instead of a selecting one. As the <code>EntityManager</code> might contain outdated entities after the execution of the modifying query, we do not automatically clear it (see the <a href="https://docs.oracle.com/javaee/7/api/javax/persistence/EntityManager.html">JavaDoc</a> of <code>EntityManager.clear()</code> for details), since this effectively drops all non-flushed changes still pending in the <code>EntityManager</code>.
If you wish the <code>EntityManager</code> to be cleared automatically, you can set the <code>@Modifying</code> annotation’s <code>clearAutomatically</code> attribute to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>The <code>@Modifying</code> annotation is only relevant in combination with the <code>@Query</code> annotation.
Derived query methods or custom methods do not require this annotation.</p>
</div>
<div class="sect4">
<h5 id="jpa.modifying-queries.derived-delete"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.modifying-queries.derived-delete"></a>Derived Delete Queries</h5>
<div class="paragraph">
<p>Spring Data JPA also supports derived delete queries that let you avoid having to declare the JPQL query explicitly, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 73. Using a derived delete query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{

  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteByRoleId</span><span class="hljs-params">(<span class="hljs-keyword">long</span> roleId)</span></span>;

  <span class="hljs-meta">@Modifying</span>
  <span class="hljs-meta">@Query</span>(<span class="hljs-string">"delete from User u where u.role.id = ?1"</span>)
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteInBulkByRoleId</span><span class="hljs-params">(<span class="hljs-keyword">long</span> roleId)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Although the <code>deleteByRoleId(…)</code> method looks like it basically produces the same result as the <code>deleteInBulkByRoleId(…)</code>, there is an important difference between the two method declarations in terms of the way they are run.
As the name suggests, the latter method issues a single JPQL query (the one defined in the annotation) against the database.
This means even currently loaded instances of <code>User</code> do not see lifecycle callbacks invoked.</p>
</div>
<div class="paragraph">
<p>To make sure lifecycle queries are actually invoked, an invocation of <code>deleteByRoleId(…)</code> runs a query and then deletes the returned instances one by one, so that the persistence provider can actually invoke <code>@PreRemove</code> callbacks on those entities.</p>
</div>
<div class="paragraph">
<p>In fact, a derived delete query is a shortcut for running the query and then calling <code>CrudRepository.delete(Iterable&lt;User&gt; users)</code> on the result and keeping behavior in sync with the implementations of other <code>delete(…)</code> methods in <code>CrudRepository</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jpa.query-hints"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-hints"></a>6.3.9. Applying Query Hints</h4>
<div class="paragraph">
<p>To apply JPA query hints to the queries declared in your repository interface, you can use the <code>@QueryHints</code> annotation. It takes an array of JPA <code>@QueryHint</code> annotations plus a boolean flag to potentially disable the hints applied to the additional count query triggered when applying pagination, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 74. Using QueryHints with a repository method</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{

  <span class="hljs-meta">@QueryHints</span>(value = { <span class="hljs-meta">@QueryHint</span>(name = <span class="hljs-string">"name"</span>, value = <span class="hljs-string">"value"</span>)},
              forCounting = <span class="hljs-keyword">false</span>)
  <span class="hljs-function">Page&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The preceding declaration would apply the configured <code>@QueryHint</code> for that actually query but omit applying it to the count query triggered to calculate the total number of pages.</p>
</div>
</div>
<div class="sect3">
<h4 id="jpa.entity-graph"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.entity-graph"></a>6.3.10. Configuring Fetch- and LoadGraphs</h4>
<div class="paragraph">
<p>The JPA 2.1 specification introduced support for specifying Fetch- and LoadGraphs that we also support with the <code>@EntityGraph</code> annotation, which lets you reference a <code>@NamedEntityGraph</code> definition. You can use that annotation on an entity to configure the fetch plan of the resulting query. The type (<code>Fetch</code> or <code>Load</code>) of the fetching can be configured by using the <code>type</code> attribute on the <code>@EntityGraph</code> annotation. See the JPA 2.1 Spec 3.7.4 for further reference.</p>
</div>
<div class="paragraph">
<p>The following example shows how to define a named entity graph on an entity:</p>
</div>
<div class="exampleblock">
<div class="title">Example 75. Defining a named entity graph on an entity.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@NamedEntityGraph</span>(name = <span class="hljs-string">"GroupInfo.detail"</span>,
  attributeNodes = <span class="hljs-meta">@NamedAttributeNode</span>(<span class="hljs-string">"members"</span>))
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GroupInfo</span> </span>{

  <span class="hljs-comment">// default fetch mode is lazy.</span>
  <span class="hljs-meta">@ManyToMany</span>
  List&lt;GroupMember&gt; members = <span class="hljs-keyword">new</span> ArrayList&lt;GroupMember&gt;();

  …
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to reference a named entity graph on a repository query method:</p>
</div>
<div class="exampleblock">
<div class="title">Example 76. Referencing a named entity graph definition on a repository query method.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">GroupRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">GroupInfo</span>, <span class="hljs-title">String</span>&gt; </span>{

  <span class="hljs-meta">@EntityGraph</span>(value = <span class="hljs-string">"GroupInfo.detail"</span>, type = EntityGraphType.LOAD)
  <span class="hljs-function">GroupInfo <span class="hljs-title">getByGroupName</span><span class="hljs-params">(String name)</span></span>;

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is also possible to define ad hoc entity graphs by using <code>@EntityGraph</code>. The provided <code>attributePaths</code> are translated into the according <code>EntityGraph</code> without needing to explicitly add <code>@NamedEntityGraph</code> to your domain types, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 77. Using AD-HOC entity graph definition on an repository query method.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">GroupRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">GroupInfo</span>, <span class="hljs-title">String</span>&gt; </span>{

  <span class="hljs-meta">@EntityGraph</span>(attributePaths = { <span class="hljs-string">"members"</span> })
  <span class="hljs-function">GroupInfo <span class="hljs-title">getByGroupName</span><span class="hljs-params">(String name)</span></span>;

}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="projections"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#projections"></a>6.3.11. Projections</h4>
<div class="paragraph">
<p>Spring Data query methods usually return one or multiple instances of the aggregate root managed by the repository.
However, it might sometimes be desirable to create projections based on certain attributes of those types.
Spring Data allows modeling dedicated return types, to more selectively retrieve partial views of the managed aggregates.</p>
</div>
<div class="paragraph">
<p>Imagine a repository and aggregate root type such as the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 78. A sample aggregate and repository</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{

  <span class="hljs-meta">@Id</span> UUID id;
  String firstname, lastname;
  Address address;

  <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Address</span> </span>{
    String zipCode, city, street;
  }
}

<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">UUID</span>&gt; </span>{

  <span class="hljs-function">Collection&lt;Person&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now imagine that we want to retrieve the person’s name attributes only.
What means does Spring Data offer to achieve this? The rest of this chapter answers that question.</p>
</div>
<div class="sect4">
<h5 id="projections.interfaces"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#projections.interfaces"></a>Interface-based Projections</h5>
<div class="paragraph">
<p>The easiest way to limit the result of the queries to only the name attributes is by declaring an interface that exposes accessor methods for the properties to be read, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 79. A projection interface to retrieve a subset of attributes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">NamesOnly</span> </span>{

  <span class="hljs-function">String <span class="hljs-title">getFirstname</span><span class="hljs-params">()</span></span>;
  <span class="hljs-function">String <span class="hljs-title">getLastname</span><span class="hljs-params">()</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The important bit here is that the properties defined here exactly match properties in the aggregate root.
Doing so lets a query method be added as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 80. A repository using an interface based projection with a query method</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">UUID</span>&gt; </span>{

  <span class="hljs-function">Collection&lt;NamesOnly&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The query execution engine creates proxy instances of that interface at runtime for each element returned and forwards calls to the exposed methods to the target object.</p>
</div>
<div id="projections.interfaces.nested" class="paragraph">
<p>Projections can be used recursively. If you want to include some of the <code>Address</code> information as well, create a projection interface for that and return that interface from the declaration of <code>getAddress()</code>, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 81. A projection interface to retrieve a subset of attributes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonSummary</span> </span>{

  <span class="hljs-function">String <span class="hljs-title">getFirstname</span><span class="hljs-params">()</span></span>;
  <span class="hljs-function">String <span class="hljs-title">getLastname</span><span class="hljs-params">()</span></span>;
  <span class="hljs-function">AddressSummary <span class="hljs-title">getAddress</span><span class="hljs-params">()</span></span>;

  <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AddressSummary</span> </span>{
    <span class="hljs-function">String <span class="hljs-title">getCity</span><span class="hljs-params">()</span></span>;
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>On method invocation, the <code>address</code> property of the target instance is obtained and wrapped into a projecting proxy in turn.</p>
</div>
<div class="sect5">
<h6 id="projections.interfaces.closed"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#projections.interfaces.closed"></a>Closed Projections</h6>
<div class="paragraph">
<p>A projection interface whose accessor methods all match properties of the target aggregate is considered to be a closed projection. The following example (which we used earlier in this chapter, too) is a closed projection:</p>
</div>
<div class="exampleblock">
<div class="title">Example 82. A closed projection</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">NamesOnly</span> </span>{

  <span class="hljs-function">String <span class="hljs-title">getFirstname</span><span class="hljs-params">()</span></span>;
  <span class="hljs-function">String <span class="hljs-title">getLastname</span><span class="hljs-params">()</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you use a closed projection, Spring Data can optimize the query execution, because we know about all the attributes that are needed to back the projection proxy.
For more details on that, see the module-specific part of the reference documentation.</p>
</div>
</div>
<div class="sect5">
<h6 id="projections.interfaces.open"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#projections.interfaces.open"></a>Open Projections</h6>
<div class="paragraph">
<p>Accessor methods in projection interfaces can also be used to compute new values by using the <code>@Value</code> annotation, as shown in the following example:</p>
</div>
<div id="projections.interfaces.open.simple" class="exampleblock">
<div class="title">Example 83. An Open Projection</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">NamesOnly</span> </span>{

  <span class="hljs-meta">@Value</span>(<span class="hljs-string">"#{target.firstname + ' ' + target.lastname}"</span>)
  <span class="hljs-function">String <span class="hljs-title">getFullName</span><span class="hljs-params">()</span></span>;
  …
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The aggregate root backing the projection is available in the <code>target</code> variable.
A projection interface using <code>@Value</code> is an open projection.
Spring Data cannot apply query execution optimizations in this case, because the SpEL expression could use any attribute of the aggregate root.</p>
</div>
<div class="paragraph">
<p>The expressions used in <code>@Value</code> should not be too complex — you want to avoid programming in <code>String</code> variables.
For very simple expressions, one option might be to resort to default methods (introduced in Java 8), as shown in the following example:</p>
</div>
<div id="projections.interfaces.open.default" class="exampleblock">
<div class="title">Example 84. A projection interface using a default method for custom logic</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">NamesOnly</span> </span>{

  <span class="hljs-function">String <span class="hljs-title">getFirstname</span><span class="hljs-params">()</span></span>;
  <span class="hljs-function">String <span class="hljs-title">getLastname</span><span class="hljs-params">()</span></span>;

  <span class="hljs-function"><span class="hljs-keyword">default</span> String <span class="hljs-title">getFullName</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> getFirstname().concat(<span class="hljs-string">" "</span>).concat(getLastname());
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This approach requires you to be able to implement logic purely based on the other accessor methods exposed on the projection interface.
A second, more flexible, option is to implement the custom logic in a Spring bean and then invoke that from the SpEL expression, as shown in the following example:</p>
</div>
<div id="projections.interfaces.open.bean-reference" class="exampleblock">
<div class="title">Example 85. Sample Person object</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Component</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBean</span> </span>{

  <span class="hljs-function">String <span class="hljs-title">getFullName</span><span class="hljs-params">(Person person)</span> </span>{
    …
  }
}

<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">NamesOnly</span> </span>{

  <span class="hljs-meta">@Value</span>(<span class="hljs-string">"#{@myBean.getFullName(target)}"</span>)
  <span class="hljs-function">String <span class="hljs-title">getFullName</span><span class="hljs-params">()</span></span>;
  …
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Notice how the SpEL expression refers to <code>myBean</code> and invokes the <code>getFullName(…)</code> method and forwards the projection target as a method parameter.
Methods backed by SpEL expression evaluation can also use method parameters, which can then be referred to from the expression.
The method parameters are available through an <code>Object</code> array named <code>args</code>. The following example shows how to get a method parameter from the <code>args</code> array:</p>
</div>
<div class="exampleblock">
<div class="title">Example 86. Sample Person object</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">NamesOnly</span> </span>{

  <span class="hljs-meta">@Value</span>(<span class="hljs-string">"#{args[0] + ' ' + target.firstname + '!'}"</span>)
  <span class="hljs-function">String <span class="hljs-title">getSalutation</span><span class="hljs-params">(String prefix)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Again, for more complex expressions, you should use a Spring bean and let the expression invoke a method, as described <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#projections.interfaces.open.bean-reference">earlier</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="projections.interfaces.nullable-wrappers"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#projections.interfaces.nullable-wrappers"></a>Nullable Wrappers</h6>
<div class="paragraph">
<p>Getters in projection interfaces can make use of nullable wrappers for improved null-safety. Currently supported wrapper types are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.util.Optional</code></p>
</li>
<li>
<p><code>com.google.common.base.Optional</code></p>
</li>
<li>
<p><code>scala.Option</code></p>
</li>
<li>
<p><code>io.vavr.control.Option</code></p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 87. A projection interface using nullable wrappers</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">NamesOnly</span> </span>{

  <span class="hljs-function">Optional&lt;String&gt; <span class="hljs-title">getFirstname</span><span class="hljs-params">()</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the underlying projection value is not <code>null</code>, then values are returned using the present-representation of the wrapper type.
In case the backing value is <code>null</code>, then the getter method returns the empty representation of the used wrapper type.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="projections.dtos"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#projections.dtos"></a>Class-based Projections (DTOs)</h5>
<div class="paragraph">
<p>Another way of defining projections is by using value type DTOs (Data Transfer Objects) that hold properties for the fields that are supposed to be retrieved.
These DTO types can be used in exactly the same way projection interfaces are used, except that no proxying happens and no nested projections can be applied.</p>
</div>
<div class="paragraph">
<p>If the store optimizes the query execution by limiting the fields to be loaded, the fields to be loaded are determined from the parameter names of the constructor that is exposed.</p>
</div>
<div class="paragraph">
<p>The following example shows a projecting DTO:</p>
</div>
<div class="exampleblock">
<div class="title">Example 88. A projecting DTO</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NamesOnly</span> </span>{

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String firstname, lastname;

  NamesOnly(String firstname, String lastname) {

    <span class="hljs-keyword">this</span>.firstname = firstname;
    <span class="hljs-keyword">this</span>.lastname = lastname;
  }

  <span class="hljs-function">String <span class="hljs-title">getFirstname</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.firstname;
  }

  <span class="hljs-function">String <span class="hljs-title">getLastname</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.lastname;
  }

  <span class="hljs-comment">// equals(…) and hashCode() implementations</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Avoid boilerplate code for projection DTOs</div>
<div class="paragraph">
<p>You can dramatically simplify the code for a DTO by using <a href="https://projectlombok.org/">Project Lombok</a>, which provides an <code>@Value</code> annotation (not to be confused with Spring’s <code>@Value</code> annotation shown in the earlier interface examples).
If you use Project Lombok’s <code>@Value</code> annotation, the sample DTO shown earlier would become the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Value</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NamesOnly</span> </span>{
	String firstname, lastname;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Fields are <code>private final</code> by default, and the class exposes a constructor that takes all fields and automatically gets <code>equals(…)</code> and <code>hashCode()</code> methods implemented.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="projection.dynamic"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#projection.dynamic"></a>Dynamic Projections</h5>
<div class="paragraph">
<p>So far, we have used the projection type as the return type or element type of a collection.
However, you might want to select the type to be used at invocation time (which makes it dynamic).
To apply dynamic projections, use a query method such as the one shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 89. A repository using a dynamic projection parameter</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">UUID</span>&gt; </span>{

  &lt;T&gt; <span class="hljs-function">Collection&lt;T&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname, Class&lt;T&gt; type)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This way, the method can be used to obtain the aggregates as is or with a projection applied, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 90. Using a repository with dynamic projections</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">someMethod</span><span class="hljs-params">(PersonRepository people)</span> </span>{

  Collection&lt;Person&gt; aggregates =
    people.findByLastname(<span class="hljs-string">"Matthews"</span>, Person.class);

  Collection&lt;NamesOnly&gt; aggregates =
    people.findByLastname(<span class="hljs-string">"Matthews"</span>, NamesOnly.class);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jpa.stored-procedures"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.stored-procedures"></a>6.4. Stored Procedures</h3>
<div class="paragraph">
<p>The JPA 2.1 specification introduced support for calling stored procedures by using the JPA criteria query API.
We Introduced the <code>@Procedure</code> annotation for declaring stored procedure metadata on a repository method.</p>
</div>
<div class="paragraph">
<p>The examples to follow use the following stored procedure:</p>
</div>
<div class="exampleblock">
<div class="title">Example 91. The definition of the <code>plus1inout</code> procedure in HSQL DB.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sql" class="language-sql hljs">/;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">procedure</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> plus1inout
/;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">procedure</span> plus1inout (<span class="hljs-keyword">IN</span> arg <span class="hljs-built_in">int</span>, <span class="hljs-keyword">OUT</span> res <span class="hljs-built_in">int</span>)
<span class="hljs-keyword">BEGIN</span> ATOMIC
 <span class="hljs-keyword">set</span> res = arg + <span class="hljs-number">1</span>;
<span class="hljs-keyword">END</span>
/;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Metadata for stored procedures can be configured by using the <code>NamedStoredProcedureQuery</code> annotation on an entity type.</p>
</div>
<div id="jpa.stored-procedure-entity-metadata" class="exampleblock">
<div class="title">Example 92. StoredProcedure metadata definitions on an entity.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@NamedStoredProcedureQuery</span>(name = <span class="hljs-string">"User.plus1"</span>, procedureName = <span class="hljs-string">"plus1inout"</span>, parameters = {
  <span class="hljs-meta">@StoredProcedureParameter</span>(mode = ParameterMode.IN, name = <span class="hljs-string">"arg"</span>, type = Integer.class),
  <span class="hljs-meta">@StoredProcedureParameter</span>(mode = ParameterMode.OUT, name = <span class="hljs-string">"res"</span>, type = Integer.class) })
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that <code>@NamedStoredProcedureQuery</code> has two different names for the stored procedure.
<code>name</code> is the name JPA uses. <code>procedureName</code> is the name the stored procedure has in the database.</p>
</div>
<div class="paragraph">
<p>You can reference stored procedures from a repository method in multiple ways.
The stored procedure to be called can either be defined directly by using the <code>value</code> or <code>procedureName</code> attribute of the <code>@Procedure</code> annotation.
This refers directly to the stored procedure in the database and ignores any configuration via <code>@NamedStoredProcedureQuery</code>.</p>
</div>
<div class="paragraph">
<p>Alternatively you may specify the <code>@NamedStoredProcedureQuery.name</code> attribute as the <code>@Procedure.name</code> attribute.
If neither <code>value</code>, <code>procedureName</code> nor <code>name</code> is configured, the name of the repository method is used as the <code>name</code> attribute.</p>
</div>
<div class="paragraph">
<p>The following example shows how to reference an explicitly mapped procedure:</p>
</div>
<div id="jpa.stored-procedure-reference" class="exampleblock">
<div class="title">Example 93. Referencing explicitly mapped procedure with name "plus1inout" in database.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Procedure</span>(<span class="hljs-string">"plus1inout"</span>)
<span class="hljs-function">Integer <span class="hljs-title">explicitlyNamedPlus1inout</span><span class="hljs-params">(Integer arg)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example is equivalent to the previous one but uses the <code>procedureName</code> alias:</p>
</div>
<div class="exampleblock">
<div class="title">Example 94. Referencing implicitly mapped procedure with name "plus1inout" in database via <code>procedureName</code> alias.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Procedure</span>(procedureName = <span class="hljs-string">"plus1inout"</span>)
<span class="hljs-function">Integer <span class="hljs-title">callPlus1InOut</span><span class="hljs-params">(Integer arg)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following is again equivalent to the previous two but using the method name instead of an explicite annotation attribute.</p>
</div>
<div class="exampleblock">
<div class="title">Example 95. Referencing implicitly mapped named stored procedure "User.plus1" in <code>EntityManager</code> by using the method name.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Procedure</span>
<span class="hljs-function">Integer <span class="hljs-title">plus1inout</span><span class="hljs-params">(@Param(<span class="hljs-string">"arg"</span>)</span> Integer arg)</span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to reference a stored procedure by referencing the <code>@NamedStoredProcedureQuery.name</code> attribute.</p>
</div>
<div class="exampleblock">
<div class="title">Example 96. Referencing explicitly mapped named stored procedure "User.plus1IO" in <code>EntityManager</code>.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Procedure</span>(name = <span class="hljs-string">"User.plus1IO"</span>)
<span class="hljs-function">Integer <span class="hljs-title">entityAnnotatedCustomNamedProcedurePlus1IO</span><span class="hljs-params">(@Param(<span class="hljs-string">"arg"</span>)</span> Integer arg)</span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the stored procedure getting called has a single out parameter that parameter may be returned as the return value of the method.
If there are multiple out parameters specified in a <code>@NamedStoredProcedureQuery</code> annotation those can be returned as a <code>Map</code> with the key being the parameter name given in the <code>@NamedStoredProcedureQuery</code> annotation.</p>
</div>
</div>
<div class="sect2">
<h3 id="specifications"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#specifications"></a>6.5. Specifications</h3>
<div class="paragraph">
<p>JPA 2 introduces a criteria API that you can use to build queries programmatically. By writing a <code>criteria</code>, you define the where clause of a query for a domain class. Taking another step back, these criteria can be regarded as a predicate over the entity that is described by the JPA criteria API constraints.</p>
</div>
<div class="paragraph">
<p>Spring Data JPA takes the concept of a specification from Eric Evans' book, “Domain Driven Design”, following the same semantics and providing an API to define such specifications with the JPA criteria API. To support specifications, you can extend your repository interface with the <code>JpaSpecificationExecutor</code> interface, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CustomerRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">Customer</span>, <span class="hljs-title">Long</span>&gt;, <span class="hljs-title">JpaSpecificationExecutor</span> </span>{
 …
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The additional interface has methods that let you run specifications in a variety of ways. For example, the <code>findAll</code> method returns all entities that match the specification, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function">List&lt;T&gt; <span class="hljs-title">findAll</span><span class="hljs-params">(Specification&lt;T&gt; spec)</span></span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Specification</code> interface is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Specification</span>&lt;<span class="hljs-title">T</span>&gt; </span>{
  <span class="hljs-function">Predicate <span class="hljs-title">toPredicate</span><span class="hljs-params">(Root&lt;T&gt; root, CriteriaQuery&lt;?&gt; query,
            CriteriaBuilder builder)</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Specifications can easily be used to build an extensible set of predicates on top of an entity that then can be combined and used with <code>JpaRepository</code> without the need to declare a query (method) for every needed combination, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 97. Specifications for a Customer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomerSpecs</span> </span>{


  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Specification&lt;Customer&gt; <span class="hljs-title">isLongTermCustomer</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> (root, query, builder) -&gt; {
      LocalDate date = LocalDate.now().minusYears(<span class="hljs-number">2</span>);
      <span class="hljs-keyword">return</span> builder.lessThan(root.get(Customer_.createdAt), date);
    };
  }

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Specification&lt;Customer&gt; <span class="hljs-title">hasSalesOfMoreThan</span><span class="hljs-params">(MonetaryAmount value)</span> </span>{
    <span class="hljs-keyword">return</span> (root, query, builder) -&gt; {
      <span class="hljs-comment">// build query here</span>
    };
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>Customer_</code> type is a metamodel type generated using the JPA Metamodel generator (see the <a href="https://docs.jboss.org/hibernate/jpamodelgen/1.0/reference/en-US/html_single/#whatisit">Hibernate implementation’s documentation for an example</a>).
So the expression, <code>Customer_.createdAt</code>, assumes the <code>Customer</code> has a <code>createdAt</code> attribute of type <code>Date</code>.
Besides that, we have expressed some criteria on a business requirement abstraction level and created executable <code>Specifications</code>.
So a client might use a <code>Specification</code> as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 98. Using a simple Specification</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">List&lt;Customer&gt; customers = customerRepository.findAll(isLongTermCustomer());</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Why not create a query for this kind of data access? Using a single <code>Specification</code> does not gain a lot of benefit over a plain query declaration. The power of specifications really shines when you combine them to create new <code>Specification</code> objects. You can achieve this through the default methods of <code>Specification</code> we provide to build expressions similar to the following:</p>
</div>
<div class="exampleblock">
<div class="title">Example 99. Combined Specifications</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">MonetaryAmount amount = <span class="hljs-keyword">new</span> MonetaryAmount(<span class="hljs-number">200.0</span>, Currencies.DOLLAR);
List&lt;Customer&gt; customers = customerRepository.findAll(
  isLongTermCustomer().or(hasSalesOfMoreThan(amount)));</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Specification</code> offers some “glue-code” default methods to chain and combine <code>Specification</code> instances. These methods let you extend your data access layer by creating new <code>Specification</code> implementations and combining them with already existing implementations.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="query-by-example"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#query-by-example"></a>6.6. Query by Example</h3>
<div class="sect3">
<h4 id="query-by-example.introduction"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#query-by-example.introduction"></a>6.6.1. Introduction</h4>
<div class="paragraph">
<p>This chapter provides an introduction to Query by Example and explains how to use it.</p>
</div>
<div class="paragraph">
<p>Query by Example (QBE) is a user-friendly querying technique with a simple interface.
It allows dynamic query creation and does not require you to write queries that contain field names.
In fact, Query by Example does not require you to write queries by using store-specific query languages at all.</p>
</div>
</div>
<div class="sect3">
<h4 id="query-by-example.usage"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#query-by-example.usage"></a>6.6.2. Usage</h4>
<div class="paragraph">
<p>The Query by Example API consists of three parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Probe: The actual example of a domain object with populated fields.</p>
</li>
<li>
<p><code>ExampleMatcher</code>: The <code>ExampleMatcher</code> carries details on how to match particular fields.
It can be reused across multiple Examples.</p>
</li>
<li>
<p><code>Example</code>: An <code>Example</code> consists of the probe and the <code>ExampleMatcher</code>.
It is used to create the query.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Query by Example is well suited for several use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Querying your data store with a set of static or dynamic constraints.</p>
</li>
<li>
<p>Frequent refactoring of the domain objects without worrying about breaking existing queries.</p>
</li>
<li>
<p>Working independently from the underlying data store API.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Query by Example also has several limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No support for nested or grouped property constraints, such as <code>firstname = ?0 or (firstname = ?1 and lastname = ?2)</code>.</p>
</li>
<li>
<p>Only supports starts/contains/ends/regex matching for strings and exact matching for other property types.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before getting started with Query by Example, you need to have a domain object.
To get started, create an interface for your repository, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 100. Sample Person object</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{

  <span class="hljs-meta">@Id</span>
  <span class="hljs-keyword">private</span> String id;
  <span class="hljs-keyword">private</span> String firstname;
  <span class="hljs-keyword">private</span> String lastname;
  <span class="hljs-keyword">private</span> Address address;

  <span class="hljs-comment">// … getters and setters omitted</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The preceding example shows a simple domain object.
You can use it to create an <code>Example</code>.
By default, fields having <code>null</code> values are ignored, and strings are matched by using the store specific defaults.
Examples can be built by either using the <code>of</code> factory method or by using <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#query-by-example.matchers"><code>ExampleMatcher</code></a>. <code>Example</code> is immutable.
The following listing shows a simple Example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 101. Simple Example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Person person = <span class="hljs-keyword">new</span> Person();                         <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
person.setFirstname(<span class="hljs-string">"Dave"</span>);                          <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>

Example&lt;Person&gt; example = Example.of(person);         <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a new instance of the domain object.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the properties to query.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create the <code>Example</code>.</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="paragraph">
<p>You can run the example queries by using repositories.
To do so, let your repository interface extend <code>QueryByExampleExecutor&lt;T&gt;</code>.
The following listing shows an excerpt from the <code>QueryByExampleExecutor</code> interface:</p>
</div>
<div class="exampleblock">
<div class="title">Example 102. The <code>QueryByExampleExecutor</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">QueryByExampleExecutor</span>&lt;<span class="hljs-title">T</span>&gt; </span>{

  &lt;S extends T&gt; <span class="hljs-function">S <span class="hljs-title">findOne</span><span class="hljs-params">(Example&lt;S&gt; example)</span></span>;

  &lt;S extends T&gt; <span class="hljs-function">Iterable&lt;S&gt; <span class="hljs-title">findAll</span><span class="hljs-params">(Example&lt;S&gt; example)</span></span>;

  <span class="hljs-comment">// … more functionality omitted.</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="query-by-example.matchers"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#query-by-example.matchers"></a>6.6.3. Example Matchers</h4>
<div class="paragraph">
<p>Examples are not limited to default settings.
You can specify your own defaults for string matching, null handling, and property-specific settings by using the <code>ExampleMatcher</code>, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 103. Example matcher with customized matching</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Person person = <span class="hljs-keyword">new</span> Person();                          <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
person.setFirstname(<span class="hljs-string">"Dave"</span>);                           <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>

ExampleMatcher matcher = ExampleMatcher.matching()     <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>
  .withIgnorePaths(<span class="hljs-string">"lastname"</span>)                         <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b>
  .withIncludeNullValues()                             <i class="conum" data-value="5"></i><b>(<span class="hljs-number">5</span>)</b>
  .withStringMatcherEnding();                          <i class="conum" data-value="6"></i><b>(<span class="hljs-number">6</span>)</b>

Example&lt;Person&gt; example = Example.of(person, matcher); <i class="conum" data-value="7"></i><b>(<span class="hljs-number">7</span>)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a new instance of the domain object.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set properties.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create an <code>ExampleMatcher</code> to expect all values to match.
It is usable at this stage even without further configuration.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Construct a new <code>ExampleMatcher</code> to ignore the <code>lastname</code> property path.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Construct a new <code>ExampleMatcher</code> to ignore the <code>lastname</code> property path and to include null values.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Construct a new <code>ExampleMatcher</code> to ignore the <code>lastname</code> property path, to include null values, and to perform suffix string matching.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Create a new <code>Example</code> based on the domain object and the configured <code>ExampleMatcher</code>.</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="paragraph">
<p>By default, the <code>ExampleMatcher</code> expects all values set on the probe to match.
If you want to get results matching any of the predicates defined implicitly, use <code>ExampleMatcher.matchingAny()</code>.</p>
</div>
<div class="paragraph">
<p>You can specify behavior for individual properties (such as "firstname" and "lastname" or, for nested properties, "address.city").
You can tune it with matching options and case sensitivity, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 104. Configuring matcher options</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">ExampleMatcher matcher = ExampleMatcher.matching()
  .withMatcher(<span class="hljs-string">"firstname"</span>, endsWith())
  .withMatcher(<span class="hljs-string">"lastname"</span>, startsWith().ignoreCase());
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Another way to configure matcher options is to use lambdas (introduced in Java 8).
This approach creates a callback that asks the implementor to modify the matcher.
You need not return the matcher, because configuration options are held within the matcher instance.
The following example shows a matcher that uses lambdas:</p>
</div>
<div class="exampleblock">
<div class="title">Example 105. Configuring matcher options with lambdas</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">ExampleMatcher matcher = ExampleMatcher.matching()
  .withMatcher(<span class="hljs-string">"firstname"</span>, match -&gt; match.endsWith())
  .withMatcher(<span class="hljs-string">"firstname"</span>, match -&gt; match.startsWith());
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Queries created by <code>Example</code> use a merged view of the configuration.
Default matching settings can be set at the <code>ExampleMatcher</code> level, while individual settings can be applied to particular property paths.
Settings that are set on <code>ExampleMatcher</code> are inherited by property path settings unless they are defined explicitly.
Settings on a property patch have higher precedence than default settings.
The following table describes the scope of the various <code>ExampleMatcher</code> settings:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Scope of <code>ExampleMatcher</code> settings</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Scope</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Null-handling</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ExampleMatcher</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String matching</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ExampleMatcher</code> and property path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ignoring properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Case sensitivity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ExampleMatcher</code> and property path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value transformation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property path</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="query-by-example.running"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#query-by-example.running"></a>6.6.4. Running an Example</h4>
<div class="paragraph">
<p>In Spring Data JPA, you can use Query by Example with Repositories, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 106. Query by Example using a Repository</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">String</span>&gt; </span>{ … }

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonService</span> </span>{

  <span class="hljs-meta">@Autowired</span> PersonRepository personRepository;

  <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Person&gt; <span class="hljs-title">findPeople</span><span class="hljs-params">(Person probe)</span> </span>{
    <span class="hljs-keyword">return</span> personRepository.findAll(Example.of(probe));
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently, only <code>SingularAttribute</code> properties can be used for property matching.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The property specifier accepts property names (such as <code>firstname</code> and <code>lastname</code>). You can navigate by chaining properties together with dots (<code>address.city</code>). You can also tune it with matching options and case sensitivity.</p>
</div>
<div class="paragraph">
<p>The following table shows the various <code>StringMatcher</code> options that you can use and the result of using them on a field named <code>firstname</code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. <code>StringMatcher</code> options</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Matching</th>
<th class="tableblock halign-left valign-top">Logical result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEFAULT</code> (case-sensitive)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname = ?0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEFAULT</code> (case-insensitive)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOWER(firstname) = LOWER(?0)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXACT</code> (case-sensitive)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname = ?0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXACT</code> (case-insensitive)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOWER(firstname) = LOWER(?0)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STARTING</code> (case-sensitive)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname like ?0 + '%'</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STARTING</code> (case-insensitive)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOWER(firstname) like LOWER(?0) + '%'</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ENDING</code> (case-sensitive)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname like '%' + ?0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ENDING</code> (case-insensitive)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOWER(firstname) like '%' + LOWER(?0)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONTAINING</code> (case-sensitive)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname like '%' + ?0 + '%'</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONTAINING</code> (case-insensitive)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOWER(firstname) like '%' + LOWER(?0) + '%'</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="transactions"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#transactions"></a>6.7. Transactionality</h3>
<div class="paragraph">
<p>By default, CRUD methods on repository instances are transactional. For read operations, the transaction configuration <code>readOnly</code> flag is set to <code>true</code>. All others are configured with a plain <code>@Transactional</code> so that default transaction configuration applies. For details, see JavaDoc of <a href="https://docs.spring.io/spring-data/data-jpa/docs/current/api/index.html?org/springframework/data/jpa/repository/support/SimpleJpaRepository.html"><code>SimpleJpaRepository</code></a>. If you need to tweak transaction configuration for one of the methods declared in a repository, redeclare the method in your repository interface, as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 107. Custom transaction configuration for CRUD</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{

  <span class="hljs-meta">@Override</span>
  <span class="hljs-meta">@Transactional</span>(timeout = <span class="hljs-number">10</span>)
  <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;

  <span class="hljs-comment">// Further query method declarations</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Doing so causes the <code>findAll()</code> method to run with a timeout of 10 seconds and without the <code>readOnly</code> flag.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Another way to alter transactional behaviour is to use a facade or service implementation that (typically) covers more than one repository. Its purpose is to define transactional boundaries for non-CRUD operations. The following example shows how to use such a facade for more than one repository:</p>
</div>
<div class="exampleblock">
<div class="title">Example 108. Using a facade to define transactions for multiple repository calls</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Service</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserManagementImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserManagement</span> </span>{

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserRepository userRepository;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RoleRepository roleRepository;

  <span class="hljs-meta">@Autowired</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserManagementImpl</span><span class="hljs-params">(UserRepository userRepository,
    RoleRepository roleRepository)</span> </span>{
    <span class="hljs-keyword">this</span>.userRepository = userRepository;
    <span class="hljs-keyword">this</span>.roleRepository = roleRepository;
  }

  <span class="hljs-meta">@Transactional</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addRoleToAllUsers</span><span class="hljs-params">(String roleName)</span> </span>{

    Role role = roleRepository.findByName(roleName);

    <span class="hljs-keyword">for</span> (User user : userRepository.findAll()) {
      user.addRole(role);
      userRepository.save(user);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example causes call to <code>addRoleToAllUsers(…)</code> to run inside a transaction (participating in an existing one or creating a new one if none are already running). The transaction configuration at the repositories is then neglected, as the outer transaction configuration determines the actual one used. Note that you must activate <code>&lt;tx:annotation-driven /&gt;</code> or use <code>@EnableTransactionManagement</code> explicitly to get annotation-based configuration of facades to work.
This example assumes you use component scanning.</p>
</div>
<div class="paragraph">
<p>Note that the call to <code>save</code> is not strictly necessary from a JPA point of view, but should still be there in order to stay consistent to the repository abstraction offered by Spring Data.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="transactional-query-methods"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#transactional-query-methods"></a>6.7.1. Transactional query methods</h4>
<div class="paragraph">
<p>To let your query methods be transactional, use <code>@Transactional</code> at the repository interface you define, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 109. Using @Transactional at query methods</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Transactional</span>(readOnly = <span class="hljs-keyword">true</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{

  <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname)</span></span>;

  <span class="hljs-meta">@Modifying</span>
  <span class="hljs-meta">@Transactional</span>
  <span class="hljs-meta">@Query</span>(<span class="hljs-string">"delete from User u where u.active = false"</span>)
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteInactiveUsers</span><span class="hljs-params">()</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Typically, you want the <code>readOnly</code> flag to be set to <code>true</code>, as most of the query methods only read data. In contrast to that, <code>deleteInactiveUsers()</code> makes use of the <code>@Modifying</code> annotation and overrides the transaction configuration. Thus, the method runs with the <code>readOnly</code> flag set to <code>false</code>.</p>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use transactions for read-only queries and mark them as such by setting the <code>readOnly</code> flag. Doing so does not, however, act as a check that you do not trigger a manipulating query (although some databases reject <code>INSERT</code> and <code>UPDATE</code> statements inside a read-only transaction). The <code>readOnly</code> flag is instead propagated as a hint to the underlying JDBC driver for performance optimizations. Furthermore, Spring performs some optimizations on the underlying JPA provider. For example, when used with Hibernate, the flush mode is set to <code>NEVER</code> when you configure a transaction as <code>readOnly</code>, which causes Hibernate to skip dirty checks (a noticeable improvement on large object trees).</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="locking"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#locking"></a>6.8. Locking</h3>
<div class="paragraph">
<p>To specify the lock mode to be used, you can use the <code>@Lock</code> annotation on query methods, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 110. Defining lock metadata on query methods</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{

  <span class="hljs-comment">// Plain query method</span>
  <span class="hljs-meta">@Lock</span>(LockModeType.READ)
  <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This method declaration causes the query being triggered to be equipped with a <code>LockModeType</code> of <code>READ</code>. You can also define locking for CRUD methods by redeclaring them in your repository interface and adding the <code>@Lock</code> annotation, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 111. Defining lock metadata on CRUD methods</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{

  <span class="hljs-comment">// Redeclaration of a CRUD method</span>
  <span class="hljs-meta">@Lock</span>(LockModeType.READ)
  <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="auditing"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#auditing"></a>6.9. Auditing</h3>
<div class="sect3">
<h4 id="auditing.basics"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#auditing.basics"></a>6.9.1. Basics</h4>
<div class="paragraph">
<p>Spring Data provides sophisticated support to transparently keep track of who created or changed an entity and when the change happened. To benefit from that functionality, you have to equip your entity classes with auditing metadata that can be defined either using annotations or by implementing an interface.</p>
</div>
<div class="sect4">
<h5 id="auditing.annotations"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#auditing.annotations"></a>Annotation-based Auditing Metadata</h5>
<div class="paragraph">
<p>We provide <code>@CreatedBy</code> and <code>@LastModifiedBy</code> to capture the user who created or modified the entity as well as <code>@CreatedDate</code> and <code>@LastModifiedDate</code> to capture when the change happened.</p>
</div>
<div class="exampleblock">
<div class="title">Example 112. An audited entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Customer</span> </span>{

  <span class="hljs-meta">@CreatedBy</span>
  <span class="hljs-keyword">private</span> User user;

  <span class="hljs-meta">@CreatedDate</span>
  <span class="hljs-keyword">private</span> DateTime createdDate;

  <span class="hljs-comment">// … further properties omitted</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, the annotations can be applied selectively, depending on which information you want to capture. The annotations capturing when changes were made can be used on properties of type Joda-Time, <code>DateTime</code>, legacy Java <code>Date</code> and <code>Calendar</code>, JDK8 date and time types, and <code>long</code> or <code>Long</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="auditing.interfaces"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#auditing.interfaces"></a>Interface-based Auditing Metadata</h5>
<div class="paragraph">
<p>In case you do not want to use annotations to define auditing metadata, you can let your domain class implement the <code>Auditable</code> interface. It exposes setter methods for all of the auditing properties.</p>
</div>
<div class="paragraph">
<p>There is also a convenience base class, <code>AbstractAuditable</code>, which you can extend to avoid the need to manually implement the interface methods. Doing so increases the coupling of your domain classes to Spring Data, which might be something you want to avoid. Usually, the annotation-based way of defining auditing metadata is preferred as it is less invasive and more flexible.</p>
</div>
</div>
<div class="sect4">
<h5 id="auditing.auditor-aware"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#auditing.auditor-aware"></a><code>AuditorAware</code></h5>
<div class="paragraph">
<p>In case you use either <code>@CreatedBy</code> or <code>@LastModifiedBy</code>, the auditing infrastructure somehow needs to become aware of the current principal. To do so, we provide an <code>AuditorAware&lt;T&gt;</code> SPI interface that you have to implement to tell the infrastructure who the current user or system interacting with the application is. The generic type <code>T</code> defines what type the properties annotated with <code>@CreatedBy</code> or <code>@LastModifiedBy</code> have to be.</p>
</div>
<div class="paragraph">
<p>The following example shows an implementation of the interface that uses Spring Security’s <code>Authentication</code> object:</p>
</div>
<div class="exampleblock">
<div class="title">Example 113. Implementation of <code>AuditorAware</code> based on Spring Security</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringSecurityAuditorAware</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AuditorAware</span>&lt;<span class="hljs-title">User</span>&gt; </span>{

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> Optional&lt;User&gt; <span class="hljs-title">getCurrentAuditor</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-keyword">return</span> Optional.ofNullable(SecurityContextHolder.getContext())
            .map(SecurityContext::getAuthentication)
            .filter(Authentication::isAuthenticated)
            .map(Authentication::getPrincipal)
            .map(User.class::cast);
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The implementation accesses the <code>Authentication</code> object provided by Spring Security and looks up the custom <code>UserDetails</code> instance that you have created in your <code>UserDetailsService</code> implementation. We assume here that you are exposing the domain user through the <code>UserDetails</code> implementation but that, based on the <code>Authentication</code> found, you could also look it up from anywhere.</p>
</div>
</div>
<div class="sect4">
<h5 id="auditing.reactive-auditor-aware"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#auditing.reactive-auditor-aware"></a><code>ReactiveAuditorAware</code></h5>
<div class="paragraph">
<p>When using reactive infrastructure you might want to make use of contextual information to provide <code>@CreatedBy</code> or <code>@LastModifiedBy</code> information.
We provide an <code>ReactiveAuditorAware&lt;T&gt;</code> SPI interface that you have to implement to tell the infrastructure who the current user or system interacting with the application is. The generic type <code>T</code> defines what type the properties annotated with <code>@CreatedBy</code> or <code>@LastModifiedBy</code> have to be.</p>
</div>
<div class="paragraph">
<p>The following example shows an implementation of the interface that uses reactive Spring Security’s <code>Authentication</code> object:</p>
</div>
<div class="exampleblock">
<div class="title">Example 114. Implementation of <code>ReactiveAuditorAware</code> based on Spring Security</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringSecurityAuditorAware</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ReactiveAuditorAware</span>&lt;<span class="hljs-title">User</span>&gt; </span>{

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title">getCurrentAuditor</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-keyword">return</span> ReactiveSecurityContextHolder.getContext()
                .map(SecurityContext::getAuthentication)
                .filter(Authentication::isAuthenticated)
                .map(Authentication::getPrincipal)
                .map(User.class::cast);
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The implementation accesses the <code>Authentication</code> object provided by Spring Security and looks up the custom <code>UserDetails</code> instance that you have created in your <code>UserDetailsService</code> implementation. We assume here that you are exposing the domain user through the <code>UserDetails</code> implementation but that, based on the <code>Authentication</code> found, you could also look it up from anywhere.
:leveloffset: -1</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jpa.auditing"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.auditing"></a>6.9.2. JPA Auditing</h4>
<div class="sect4">
<h5 id="jpa.auditing.configuration"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.auditing.configuration"></a>General Auditing Configuration</h5>
<div class="paragraph">
<p>Spring Data JPA ships with an entity listener that can be used to trigger the capturing of auditing information. First, you must register the <code>AuditingEntityListener</code> to be used for all entities in your persistence contexts inside your <code>orm.xml</code> file, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 115. Auditing configuration orm.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">persistence-unit-metadata</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">persistence-unit-defaults</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">entity-listeners</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">entity-listener</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"….data.jpa.domain.support.AuditingEntityListener"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">entity-listeners</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">persistence-unit-defaults</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">persistence-unit-metadata</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also enable the <code>AuditingEntityListener</code> on a per-entity basis by using the <code>@EntityListeners</code> annotation, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@EntityListeners</span>(AuditingEntityListener.class)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyEntity</span> </span>{

}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The auditing feature requires <code>spring-aspects.jar</code> to be on the classpath.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>With <code>orm.xml</code> suitably modified and <code>spring-aspects.jar</code> on the classpath, activating auditing functionality is a matter of adding the Spring Data JPA <code>auditing</code> namespace element to your configuration, as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 116. Activating auditing using XML configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">jpa:auditing</span> <span class="hljs-attr">auditor-aware-ref</span>=<span class="hljs-string">"yourAuditorAwareBean"</span> /&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As of Spring Data JPA 1.5, you can enable auditing by annotating a configuration class with the <code>@EnableJpaAuditing</code> annotation. You must still modify the <code>orm.xml</code> file and have <code>spring-aspects.jar</code> on the classpath. The following example shows how to use the <code>@EnableJpaAuditing</code> annotation:</p>
</div>
<div class="exampleblock">
<div class="title">Example 117. Activating auditing with Java configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableJpaAuditing</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>{

  <span class="hljs-meta">@Bean</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> AuditorAware&lt;AuditableUser&gt; <span class="hljs-title">auditorProvider</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AuditorAwareImpl();
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you expose a bean of type <code>AuditorAware</code> to the <code>ApplicationContext</code>, the auditing infrastructure automatically picks it up and uses it to determine the current user to be set on domain types. If you have multiple implementations registered in the <code>ApplicationContext</code>, you can select the one to be used by explicitly setting the <code>auditorAwareRef</code> attribute of <code>@EnableJpaAuditing</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jpa.misc"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.misc"></a>6.10. Miscellaneous Considerations</h3>
<div class="sect3">
<h4 id="jpa.misc.jpa-context"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.misc.jpa-context"></a>6.10.1. Using <code>JpaContext</code> in Custom Implementations</h4>
<div class="paragraph">
<p>When working with multiple <code>EntityManager</code> instances and <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.custom-implementations">custom repository implementations</a>, you need to wire the correct <code>EntityManager</code> into the repository implementation class. You can do so by explicitly naming the <code>EntityManager</code> in the <code>@PersistenceContext</code> annotation or, if the <code>EntityManager</code> is <code>@Autowired</code>, by using <code>@Qualifier</code>.</p>
</div>
<div class="paragraph">
<p>As of Spring Data JPA 1.9, Spring Data JPA includes a class called <code>JpaContext</code> that lets you obtain the <code>EntityManager</code> by managed domain class, assuming it is managed by only one of the <code>EntityManager</code> instances in the application. The following example shows how to use <code>JpaContext</code> in a custom repository:</p>
</div>
<div class="exampleblock">
<div class="title">Example 118. Using <code>JpaContext</code> in a custom repository implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserRepositoryImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserRepositoryCustom</span> </span>{

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> EntityManager em;

  <span class="hljs-meta">@Autowired</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserRepositoryImpl</span><span class="hljs-params">(JpaContext context)</span> </span>{
    <span class="hljs-keyword">this</span>.em = context.getEntityManagerByManagedType(User.class);
  }

  …
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The advantage of this approach is that, if the domain type gets assigned to a different persistence unit, the repository does not have to be touched to alter the reference to the persistence unit.</p>
</div>
</div>
<div class="sect3">
<h4 id="jpa.misc.merging-persistence-units"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.misc.merging-persistence-units"></a>6.10.2. Merging persistence units</h4>
<div class="paragraph">
<p>Spring supports having multiple persistence units. Sometimes, however, you might want to modularize your application but still make sure that all these modules run inside a single persistence unit. To enable that behavior, Spring Data JPA offers a <code>PersistenceUnitManager</code> implementation that automatically merges persistence units based on their name, as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 119. Using MergingPersistenceUnitmanager</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"….LocalContainerEntityManagerFactoryBean"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"persistenceUnitManager"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"….MergingPersistenceUnitManager"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jpa.misc.entity-scanning"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.misc.entity-scanning"></a>Classpath Scanning for @Entity Classes and JPA Mapping Files</h5>
<div class="paragraph">
<p>A plain JPA setup requires all annotation-mapped entity classes to be listed in <code>orm.xml</code>. The same applies to XML mapping files. Spring Data JPA provides a <code>ClasspathScanningPersistenceUnitPostProcessor</code> that gets a base package configured and optionally takes a mapping filename pattern. It then scans the given package for classes annotated with <code>@Entity</code> or <code>@MappedSuperclass</code>, loads the configuration files that match the filename pattern, and hands them to the JPA configuration. The post-processor must be configured as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 120. Using ClasspathScanningPersistenceUnitPostProcessor</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"….LocalContainerEntityManagerFactoryBean"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"persistenceUnitPostProcessors"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.data.jpa.support.ClasspathScanningPersistenceUnitPostProcessor"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"com.acme.domain"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"mappingFileNamePattern"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"**/*Mapping.xml"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As of Spring 3.1, a package to scan can be configured on the <code>LocalContainerEntityManagerFactoryBean</code> directly to enable classpath scanning for entity classes. See the <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/orm/jpa/LocalContainerEntityManagerFactoryBean.html#setPackagesToScan(java.lang.String...)">JavaDoc</a> for details.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jpd.misc.cdi-integration"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpd.misc.cdi-integration"></a>6.10.3. CDI Integration</h4>
<div class="paragraph">
<p>Instances of the repository interfaces are usually created by a container, for which Spring is the most natural choice when working with Spring Data. Spring offers sophisticated support for creating bean instances, as documented in <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances">Creating Repository Instances</a>. As of version 1.1.0, Spring Data JPA ships with a custom CDI extension that allows using the repository abstraction in CDI environments. The extension is part of the JAR. To activate it, include the Spring Data JPA JAR on your classpath.</p>
</div>
<div class="paragraph">
<p>You can now set up the infrastructure by implementing a CDI Producer for the <code>EntityManagerFactory</code> and <code>EntityManager</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EntityManagerFactoryProducer</span> </span>{

  <span class="hljs-meta">@Produces</span>
  <span class="hljs-meta">@ApplicationScoped</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> EntityManagerFactory <span class="hljs-title">createEntityManagerFactory</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> Persistence.createEntityManagerFactory(<span class="hljs-string">"my-persistence-unit"</span>);
  }

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">(@Disposes EntityManagerFactory entityManagerFactory)</span> </span>{
    entityManagerFactory.close();
  }

  <span class="hljs-meta">@Produces</span>
  <span class="hljs-meta">@RequestScoped</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> EntityManager <span class="hljs-title">createEntityManager</span><span class="hljs-params">(EntityManagerFactory entityManagerFactory)</span> </span>{
    <span class="hljs-keyword">return</span> entityManagerFactory.createEntityManager();
  }

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">(@Disposes EntityManager entityManager)</span> </span>{
    entityManager.close();
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The necessary setup can vary depending on the JavaEE environment. You may need to do nothing more than redeclare a <code>EntityManager</code> as a CDI bean, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CdiConfig</span> </span>{

  <span class="hljs-meta">@Produces</span>
  <span class="hljs-meta">@RequestScoped</span>
  <span class="hljs-meta">@PersistenceContext</span>
  <span class="hljs-keyword">public</span> EntityManager entityManager;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, the container has to be capable of creating JPA <code>EntityManagers</code> itself. All the configuration does is re-export the JPA <code>EntityManager</code> as a CDI bean.</p>
</div>
<div class="paragraph">
<p>The Spring Data JPA CDI extension picks up all available <code>EntityManager</code> instances as CDI beans and creates a proxy for a Spring Data repository whenever a bean of a repository type is requested by the container. Thus, obtaining an instance of a Spring Data repository is a matter of declaring an <code>@Injected</code> property, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RepositoryClient</span> </span>{

  <span class="hljs-meta">@Inject</span>
  PersonRepository repository;

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">businessMethod</span><span class="hljs-params">()</span> </span>{
    List&lt;Person&gt; people = repository.findAll();
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#appendix"></a>7. Appendix</h2>
<div class="sectionbody">
</div>
</div>
<div class="sect1">
<h2 id="repositories.namespace-reference"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.namespace-reference"></a>Appendix A: Namespace reference</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="populator.namespace-dao-config"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#populator.namespace-dao-config"></a>The <code>&lt;repositories /&gt;</code> Element</h3>
<div class="paragraph">
<p>The <code>&lt;repositories /&gt;</code> element triggers the setup of the Spring Data repository infrastructure. The most important attribute is <code>base-package</code>, which defines the package to scan for Spring Data repository interfaces. See “<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances.spring">XML Configuration</a>”. The following table describes the attributes of the <code>&lt;repositories /&gt;</code> element:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>base-package</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the package to be scanned for repository interfaces that extend <code>*Repository</code> (the actual interface is determined by the specific Spring Data module) in auto-detection mode. All packages below the configured package are scanned, too. Wildcards are allowed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repository-impl-postfix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the postfix to autodetect custom repository implementations. Classes whose names end with the configured postfix are considered as candidates. Defaults to <code>Impl</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>query-lookup-strategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines the strategy to be used to create finder queries. See “<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.query-lookup-strategies">Query Lookup Strategies</a>” for details. Defaults to <code>create-if-not-found</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>named-queries-location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the location to search for a Properties file containing externally defined queries.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>consider-nested-repositories</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether nested repository interface definitions should be considered. Defaults to <code>false</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="populator.namespace-reference"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#populator.namespace-reference"></a>Appendix B: Populators namespace reference</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="namespace-dao-config"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#namespace-dao-config"></a>The &lt;populator /&gt; element</h3>
<div class="paragraph">
<p>The <code>&lt;populator /&gt;</code> element allows to populate the a data store via the Spring Data repository infrastructure.<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>locations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where to find the files to read the objects from the repository shall be populated with.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="repository-query-keywords"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repository-query-keywords"></a>Appendix C: Repository query keywords</h2>
<div class="sectionbody">
<div class="sect2">
<h3>Supported query keywords</h3>
<div class="paragraph">
<p>The following table lists the keywords generally supported by the Spring Data repository query derivation mechanism. However, consult the store-specific documentation for the exact list of supported keywords, because some keywords listed here might not be supported in a particular store.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Query keywords</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Logical keyword</th>
<th class="tableblock halign-left valign-top">Keyword expressions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AND</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>And</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Or</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AFTER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>After</code>, <code>IsAfter</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BEFORE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Before</code>, <code>IsBefore</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONTAINING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Containing</code>, <code>IsContaining</code>, <code>Contains</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BETWEEN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Between</code>, <code>IsBetween</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ENDING_WITH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EndingWith</code>, <code>IsEndingWith</code>, <code>EndsWith</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXISTS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Exists</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FALSE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>False</code>, <code>IsFalse</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GREATER_THAN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThan</code>, <code>IsGreaterThan</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GREATER_THAN_EQUALS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThanEqual</code>, <code>IsGreaterThanEqual</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>In</code>, <code>IsIn</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Is</code>, <code>Equals</code>, (or no keyword)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_EMPTY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsEmpty</code>, <code>Empty</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_NOT_EMPTY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsNotEmpty</code>, <code>NotEmpty</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_NOT_NULL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotNull</code>, <code>IsNotNull</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_NULL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Null</code>, <code>IsNull</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LESS_THAN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThan</code>, <code>IsLessThan</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LESS_THAN_EQUAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThanEqual</code>, <code>IsLessThanEqual</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIKE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Like</code>, <code>IsLike</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEAR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Near</code>, <code>IsNear</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Not</code>, <code>IsNot</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT_IN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotIn</code>, <code>IsNotIn</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT_LIKE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotLike</code>, <code>IsNotLike</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REGEX</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Regex</code>, <code>MatchesRegex</code>, <code>Matches</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STARTING_WITH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StartingWith</code>, <code>IsStartingWith</code>, <code>StartsWith</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRUE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>True</code>, <code>IsTrue</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WITHIN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Within</code>, <code>IsWithin</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="repository-query-return-types"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repository-query-return-types"></a>Appendix D: Repository query return types</h2>
<div class="sectionbody">
<div class="sect2">
<h3>Supported Query Return Types</h3>
<div class="paragraph">
<p>The following table lists the return types generally supported by Spring Data repositories. However, consult the store-specific documentation for the exact list of supported return types, because some types listed here might not be supported in a particular store.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Geospatial types (such as <code>GeoResult</code>, <code>GeoResults</code>, and <code>GeoPage</code>) are available only for data stores that support geospatial queries.
</td>
</tr>
</tbody></table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Query return types</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Return type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Denotes no return value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primitives</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java primitives.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wrapper types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java wrapper types.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A unique entity. Expects the query method to return one result at most. If no result is found, <code>null</code> is returned. More than one result triggers an <code>IncorrectResultSizeDataAccessException</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Iterator&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <code>Iterator</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Collection&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Collection</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>List</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Optional&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Java 8 or Guava <code>Optional</code>. Expects the query method to return one result at most. If no result is found, <code>Optional.empty()</code> or <code>Optional.absent()</code> is returned. More than one result triggers an <code>IncorrectResultSizeDataAccessException</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Option&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either a Scala or Vavr <code>Option</code> type. Semantically the same behavior as Java 8’s <code>Optional</code>, described earlier.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Stream&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Java 8 <code>Stream</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Streamable&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A convenience extension of <code>Iterable</code> that directy exposes methods to stream, map and filter results, concatenate them etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Types that implement <code>Streamable</code> and take a <code>Streamable</code> constructor or factory method argument</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Types that expose a constructor or <code>….of(…)</code>/<code>….valueOf(…)</code> factory method taking a <code>Streamable</code> as argument. See <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.collections-and-iterables.streamable-wrapper">Returning Custom Streamable Wrapper Types</a> for details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vavr <code>Seq</code>, <code>List</code>, <code>Map</code>, <code>Set</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vavr collection types. See <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.collections-and-iterables.vavr">Support for Vavr Collections</a> for details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Future&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Future</code>. Expects a method to be annotated with <code>@Async</code> and requires Spring’s asynchronous method execution capability to be enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompletableFuture&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Java 8 <code>CompletableFuture</code>. Expects a method to be annotated with <code>@Async</code> and requires Spring’s asynchronous method execution capability to be enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ListenableFuture</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>org.springframework.util.concurrent.ListenableFuture</code>. Expects a method to be annotated with <code>@Async</code> and requires Spring’s asynchronous method execution capability to be enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Slice</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A sized chunk of data with an indication of whether there is more data available. Requires a <code>Pageable</code> method parameter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Page&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Slice</code> with additional information, such as the total number of results. Requires a <code>Pageable</code> method parameter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GeoResult&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A result entry with additional information, such as the distance to a reference location.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GeoResults&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of <code>GeoResult&lt;T&gt;</code> with additional information, such as the average distance to a reference location.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GeoPage&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Page</code> with <code>GeoResult&lt;T&gt;</code>, such as the average distance to a reference location.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Mono&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Project Reactor <code>Mono</code> emitting zero or one element using reactive repositories. Expects the query method to return one result at most. If no result is found, <code>Mono.empty()</code> is returned. More than one result triggers an <code>IncorrectResultSizeDataAccessException</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flux&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Project Reactor <code>Flux</code> emitting zero, one, or many elements using reactive repositories. Queries returning <code>Flux</code> can emit also an infinite number of elements.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Single&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A RxJava <code>Single</code> emitting a single element using reactive repositories. Expects the query method to return one result at most. If no result is found, <code>Mono.empty()</code> is returned. More than one result triggers an <code>IncorrectResultSizeDataAccessException</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Maybe&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A RxJava <code>Maybe</code> emitting zero or one element using reactive repositories. Expects the query method to return one result at most. If no result is found, <code>Mono.empty()</code> is returned. More than one result triggers an <code>IncorrectResultSizeDataAccessException</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A RxJava <code>Flowable</code> emitting zero, one, or many elements using reactive repositories. Queries returning <code>Flowable</code> can emit also an infinite number of elements.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="faq"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#faq"></a>Appendix E: Frequently Asked Questions</h2>
<div class="sectionbody">
<div class="sect2">
<h3>Common</h3>
<div class="qlist qanda">
<ol>
<li>
<p><em>I’d like to get more detailed logging information on what methods are called inside <code>JpaRepository</code> for example. How can I gain them? </em></p>
<p>You can make use of <code>CustomizableTraceInterceptor</code> provided by Spring, as shown in the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"customizableTraceInterceptor"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"
  org.springframework.aop.interceptor.CustomizableTraceInterceptor"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"enterMessage"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Entering $[methodName]($[arguments])"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"exitMessage"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Leaving $[methodName](): $[returnValue]"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">aop:advisor</span> <span class="hljs-attr">advice-ref</span>=<span class="hljs-string">"customizableTraceInterceptor"</span>
    <span class="hljs-attr">pointcut</span>=<span class="hljs-string">"execution(public * org.springframework.data.jpa.repository.JpaRepository+.*(..))"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3>Infrastructure</h3>
<div class="qlist qanda">
<ol>
<li>
<p><em>Currently I have implemented a repository layer based on <code>HibernateDaoSupport</code>. I create a <code>SessionFactory</code> by using Spring’s <code>AnnotationSessionFactoryBean</code>. How do I get Spring Data repositories working in this environment? </em></p>
<p>You have to replace <code>AnnotationSessionFactoryBean</code> with the <code>HibernateJpaSessionFactoryBean</code>, as follows:</p>
<div class="exampleblock">
<div class="title">Example 121. Looking up a <code>SessionFactory</code> from a <code>HibernateEntityManagerFactory</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sessionFactory"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.orm.jpa.vendor.HibernateJpaSessionFactoryBean"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"entityManagerFactory"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"entityManagerFactory"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3>Auditing</h3>
<div class="qlist qanda">
<ol>
<li>
<p><em>I want to use Spring Data JPA auditing capabilities but have my database already configured to set modification and creation date on entities. How can I prevent Spring Data from setting the date programmatically? </em></p>
<p>Set the <code>set-dates</code> attribute of the <code>auditing</code> namespace element to <code>false</code>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="glossary"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#glossary"></a>Appendix F: Glossary</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">AOP </dt>
<dd>
<p>Aspect oriented programming</p>
</dd>
<dt class="hdlist1">Commons DBCP </dt>
<dd>
<p>Commons DataBase Connection Pools - a library from the Apache foundation that offers pooling implementations of the DataSource interface.</p>
</dd>
<dt class="hdlist1">CRUD </dt>
<dd>
<p>Create, Read, Update, Delete - Basic persistence operations.</p>
</dd>
<dt class="hdlist1">DAO </dt>
<dd>
<p>Data Access Object - Pattern to separate persisting logic from the object to be persisted</p>
</dd>
<dt class="hdlist1">Dependency Injection </dt>
<dd>
<p>Pattern to hand a component’s dependency to the component from outside, freeing the component to lookup the dependent itself. For more information, see <a href="https://en.wikipedia.org/wiki/Dependency_Injection"></a><a href="https://en.wikipedia.org/wiki/Dependency_Injection" class="bare">https://en.wikipedia.org/wiki/Dependency_Injection</a>.</p>
</dd>
<dt class="hdlist1">EclipseLink </dt>
<dd>
<p>Object relational mapper implementing JPA - <a href="https://www.eclipse.org/eclipselink/"></a><a href="https://www.eclipse.org/eclipselink/" class="bare">https://www.eclipse.org/eclipselink/</a></p>
</dd>
<dt class="hdlist1">Hibernate </dt>
<dd>
<p>Object relational mapper implementing JPA - <a href="https://hibernate.org/"></a><a href="https://hibernate.org/" class="bare">https://hibernate.org/</a></p>
</dd>
<dt class="hdlist1">JPA </dt>
<dd>
<p>Java Persistence API</p>
</dd>
<dt class="hdlist1">Spring </dt>
<dd>
<p>Java application framework - <a href="https://projects.spring.io/spring-framework"></a><a href="https://projects.spring.io/spring-framework" class="bare">https://projects.spring.io/spring-framework</a></p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#_footnoteref_1">1</a>. see <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances.spring">XML Configuration</a>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2.4.0<br>
Last updated 2020-10-28 16:21:03 +0100
</div>
</div>
<link rel="stylesheet" href="./Spring Data JPA - Reference Documentation_files/github.min.css">
<script async="" src="./Spring Data JPA - Reference Documentation_files/analytics.js.download"></script><script src="./Spring Data JPA - Reference Documentation_files/highlight.min.js.download"></script>
<script>hljs.initHighlighting()</script>
<script type="text/javascript" src="./Spring Data JPA - Reference Documentation_files/tocbot.min.js.download"></script>
<script type="text/javascript" src="./Spring Data JPA - Reference Documentation_files/toc.js.download"></script>
<script>if(window.parent==window){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-2728886-23','auto',{'siteSpeedSampleRate':100});ga('send','pageview');}</script>
</body></html>